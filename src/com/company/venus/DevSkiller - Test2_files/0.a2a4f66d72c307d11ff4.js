(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{"./node_modules/checklist-model/checklist-model.js":function(e,t,r){e.exports===t&&(e.exports="checklist-model"),angular.module("checklist-model",[]).directive("checklistModel",["$parse","$compile",function(e,t){function r(e,t,r){if(angular.isArray(e))for(var i=e.length;i--;)if(r(e[i],t))return!0;return!1}function i(e,t,i){return r(e=angular.isArray(e)?e:[],t,i)||e.push(t),e}function n(e,t,r){if(angular.isArray(e))for(var i=e.length;i--;)if(r(e[i],t)){e.splice(i,1);break}return e}function s(s,o,a){var c=a.checklistModel;a.$set("checklistModel",null),t(o)(s),a.$set("checklistModel",c);var d=e(c),h=e(a.checklistChange),l=e(a.checklistBeforeChange),u=e(a.ngModel),p=function(e,t){return isNaN(e)||isNaN(t)?angular.equals(e,t):String(e)===String(t)};if(a.hasOwnProperty("checklistComparator"))if("."==a.checklistComparator[0]){var f=a.checklistComparator.substring(1);p=function(e,t){return e[f]===t[f]}}else p=e(a.checklistComparator)(s.$parent);var _=s.$watch(a.ngModel,function(e,t){e!==t&&(l&&!1===l(s)?u.assign(s,r(d(s.$parent),v(),p)):(y(v(),e),h&&h(s)))}),g=s.$watch(v,function(e,t){if(e!=t&&angular.isDefined(t)&&!0===s[a.ngModel]){var r=d(s.$parent);d.assign(s.$parent,n(r,t,p)),d.assign(s.$parent,i(r,e,p))}},!0),m=s.$on("$destroy",function(){_(),g(),m()});function v(){return a.checklistValue?e(a.checklistValue)(s.$parent):a.value}function y(e,t){var r=d(s.$parent);angular.isFunction(d.assign)&&(!0===t?d.assign(s.$parent,i(r,e,p)):d.assign(s.$parent,n(r,e,p)))}function b(e,t){l&&!1===l(s)?y(v(),u(s)):u.assign(s,r(e,v(),p))}angular.isFunction(s.$parent.$watchCollection)?s.$parent.$watchCollection(c,b):s.$parent.$watch(c,b,!0)}return{restrict:"A",priority:1e3,terminal:!0,scope:!0,compile:function(e,t){if(!t.checklistValue&&!t.value)throw"You should provide `value` or `checklist-value`.";return t.ngModel||t.$set("ngModel","checked"),s}}}])},"./node_modules/firebase/app/dist/index.esm.js":function(e,t,r){"use strict";r.r(t);var i=r("./node_modules/@firebase/app/dist/esm/index.esm2017.js");r.d(t,"FirebaseError",function(){return i.FirebaseError}),r.d(t,"SDK_VERSION",function(){return i.SDK_VERSION}),r.d(t,"_DEFAULT_ENTRY_NAME",function(){return i._DEFAULT_ENTRY_NAME}),r.d(t,"_addComponent",function(){return i._addComponent}),r.d(t,"_addOrOverwriteComponent",function(){return i._addOrOverwriteComponent}),r.d(t,"_apps",function(){return i._apps}),r.d(t,"_clearComponents",function(){return i._clearComponents}),r.d(t,"_components",function(){return i._components}),r.d(t,"_getProvider",function(){return i._getProvider}),r.d(t,"_registerComponent",function(){return i._registerComponent}),r.d(t,"_removeServiceInstance",function(){return i._removeServiceInstance}),r.d(t,"deleteApp",function(){return i.deleteApp}),r.d(t,"getApp",function(){return i.getApp}),r.d(t,"getApps",function(){return i.getApps}),r.d(t,"initializeApp",function(){return i.initializeApp}),r.d(t,"onLog",function(){return i.onLog}),r.d(t,"registerVersion",function(){return i.registerVersion}),r.d(t,"setLogLevel",function(){return i.setLogLevel});Object(i.registerVersion)("firebase","9.6.7","app")},"./node_modules/firebase/database/dist/index.esm.js":function(e,t,r){"use strict";r.r(t);var i=r("./node_modules/@firebase/database/dist/index.esm2017.js");r.d(t,"DataSnapshot",function(){return i.a}),r.d(t,"Database",function(){return i.b}),r.d(t,"OnDisconnect",function(){return i.c}),r.d(t,"QueryConstraint",function(){return i.d}),r.d(t,"TransactionResult",function(){return i.e}),r.d(t,"_QueryImpl",function(){return i.f}),r.d(t,"_QueryParams",function(){return i.g}),r.d(t,"_ReferenceImpl",function(){return i.h}),r.d(t,"_TEST_ACCESS_forceRestClient",function(){return i.i}),r.d(t,"_TEST_ACCESS_hijackHash",function(){return i.j}),r.d(t,"_repoManagerDatabaseFromApp",function(){return i.k}),r.d(t,"_setSDKVersion",function(){return i.l}),r.d(t,"_validatePathString",function(){return i.m}),r.d(t,"_validateWritablePath",function(){return i.n}),r.d(t,"child",function(){return i.o}),r.d(t,"connectDatabaseEmulator",function(){return i.p}),r.d(t,"enableLogging",function(){return i.q}),r.d(t,"endAt",function(){return i.r}),r.d(t,"endBefore",function(){return i.s}),r.d(t,"equalTo",function(){return i.t}),r.d(t,"get",function(){return i.u}),r.d(t,"getDatabase",function(){return i.v}),r.d(t,"goOffline",function(){return i.w}),r.d(t,"goOnline",function(){return i.x}),r.d(t,"increment",function(){return i.y}),r.d(t,"limitToFirst",function(){return i.z}),r.d(t,"limitToLast",function(){return i.A}),r.d(t,"off",function(){return i.B}),r.d(t,"onChildAdded",function(){return i.C}),r.d(t,"onChildChanged",function(){return i.D}),r.d(t,"onChildMoved",function(){return i.E}),r.d(t,"onChildRemoved",function(){return i.F}),r.d(t,"onDisconnect",function(){return i.G}),r.d(t,"onValue",function(){return i.H}),r.d(t,"orderByChild",function(){return i.I}),r.d(t,"orderByKey",function(){return i.J}),r.d(t,"orderByPriority",function(){return i.K}),r.d(t,"orderByValue",function(){return i.L}),r.d(t,"push",function(){return i.M}),r.d(t,"query",function(){return i.N}),r.d(t,"ref",function(){return i.O}),r.d(t,"refFromURL",function(){return i.P}),r.d(t,"remove",function(){return i.Q}),r.d(t,"runTransaction",function(){return i.R}),r.d(t,"serverTimestamp",function(){return i.S}),r.d(t,"set",function(){return i.T}),r.d(t,"setPriority",function(){return i.U}),r.d(t,"setWithPriority",function(){return i.V}),r.d(t,"startAfter",function(){return i.W}),r.d(t,"startAt",function(){return i.X}),r.d(t,"update",function(){return i.Y})},"./node_modules/firepad/dist/firepad.js":function(e,t,r){var i,n,s,o;s=function(){function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,r){if(e){if("string"==typeof e)return t(e,r);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?t(e,r):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(n=n||{}).utils={},n.utils.makeEventEmitter=function(e,t){e.prototype.allowedEvents_=t,e.prototype.on=function(e,t,r){this.validateEventType_(e),this.eventListeners_=this.eventListeners_||{},this.eventListeners_[e]=this.eventListeners_[e]||[],this.eventListeners_[e].push({callback:t,context:r})},e.prototype.off=function(e,t){this.validateEventType_(e),this.eventListeners_=this.eventListeners_||{};for(var r=this.eventListeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t)return void r.splice(i,1)},e.prototype.trigger=function(e){this.eventListeners_=this.eventListeners_||{};for(var t=this.eventListeners_[e]||[],r=0;r<t.length;r++)t[r].callback.apply(t[r].context,Array.prototype.slice.call(arguments,1))},e.prototype.validateEventType_=function(e){if(this.allowedEvents_){for(var t=!1,r=0;r<this.allowedEvents_.length;r++)if(this.allowedEvents_[r]===e){t=!0;break}if(!t)throw new Error('Unknown event "'+e+'"')}}},n.utils.elt=function(e,t,r){var i=document.createElement(e);if("string"==typeof t)n.utils.setTextContent(i,t);else if(t)for(var s=0;s<t.length;++s)i.appendChild(t[s]);for(var o in r||{})i.setAttribute(o,r[o]);return i},n.utils.setTextContent=function(e,t){e.innerHTML="",e.appendChild(document.createTextNode(t))},n.utils.on=function(e,t,r,i){e.addEventListener?e.addEventListener(t,r,i||!1):e.attachEvent&&e.attachEvent("on"+t,r)},n.utils.off=function(e,t,r,i){e.removeEventListener?e.removeEventListener(t,r,i||!1):e.detachEvent&&e.detachEvent("on"+t,r)},n.utils.preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},n.utils.stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},n.utils.stopEvent=function(e){n.utils.preventDefault(e),n.utils.stopPropagation(e)},n.utils.stopEventAnd=function(e){return function(t){return e(t),n.utils.stopEvent(t),!1}},n.utils.trim=function(e){return e.replace(/^\s+/g,"").replace(/\s+$/g,"")},n.utils.stringEndsWith=function(e,t){for(var r="string"==typeof t?[t]:t,i=0;i<r.length;i++)if(t=r[i],-1!==e.indexOf(t,e.length-t.length))return!0;return!1},n.utils.assert=function(e,t){if(!e)throw new Error(t||"assertion error")},n.utils.log=function(){if("undefined"!=typeof console&&void 0!==console.log)for(var e=["Firepad:"],t=0;t<arguments.length;t++)e.push(arguments[t])},(n=n||{}).Span=function(){function e(e,t){this.pos=e,this.length=t}return e.prototype.end=function(){return this.pos+this.length},e}(),(n=n||{}).TextOp=function(){var e=n.utils;function t(t){this.type=t,this.chars=null,this.text=null,this.attributes=null,"insert"===t?(this.text=arguments[1],e.assert("string"==typeof this.text),this.attributes=arguments[2]||{},e.assert("object"==typeof this.attributes)):"delete"===t?(this.chars=arguments[1],e.assert("number"==typeof this.chars)):"retain"===t&&(this.chars=arguments[1],e.assert("number"==typeof this.chars),this.attributes=arguments[2]||{},e.assert("object"==typeof this.attributes))}return t.prototype.isInsert=function(){return"insert"===this.type},t.prototype.isDelete=function(){return"delete"===this.type},t.prototype.isRetain=function(){return"retain"===this.type},t.prototype.equals=function(e){return this.type===e.type&&this.text===e.text&&this.chars===e.chars&&this.attributesEqual(e.attributes)},t.prototype.attributesEqual=function(e){for(var t in this.attributes)if(this.attributes[t]!==e[t])return!1;for(t in e)if(this.attributes[t]!==e[t])return!1;return!0},t.prototype.hasEmptyAttributes=function(){var e=!0;for(var t in this.attributes){e=!1;break}return e},t}(),(n=n||{}).TextOperation=function(){"use strict";var e=n.TextOp,t=n.utils;function r(){if(!this||this.constructor!==r)return new r;this.ops=[],this.baseLength=0,this.targetLength=0}function i(e){var t=e.ops;switch(t.length){case 1:return t[0];case 2:return t[0].isRetain()?t[1]:t[1].isRetain()?t[0]:null;case 3:if(t[0].isRetain()&&t[2].isRetain())return t[1]}return null}function s(e){return e.ops[0].isRetain()?e.ops[0].chars:0}return r.prototype.equals=function(e){if(this.baseLength!==e.baseLength)return!1;if(this.targetLength!==e.targetLength)return!1;if(this.ops.length!==e.ops.length)return!1;for(var t=0;t<this.ops.length;t++)if(!this.ops[t].equals(e.ops[t]))return!1;return!0},r.prototype.retain=function(t,r){if("number"!=typeof t||t<0)throw new Error("retain expects a positive integer.");if(0===t)return this;this.baseLength+=t,this.targetLength+=t,r=r||{};var i=this.ops.length>0?this.ops[this.ops.length-1]:null;return i&&i.isRetain()&&i.attributesEqual(r)?i.chars+=t:this.ops.push(new e("retain",t,r)),this},r.prototype.insert=function(t,r){if("string"!=typeof t)throw new Error("insert expects a string");if(""===t)return this;r=r||{},this.targetLength+=t.length;var i=this.ops.length>0?this.ops[this.ops.length-1]:null,n=this.ops.length>1?this.ops[this.ops.length-2]:null;return i&&i.isInsert()&&i.attributesEqual(r)?i.text+=t:i&&i.isDelete()?n&&n.isInsert()&&n.attributesEqual(r)?n.text+=t:(this.ops[this.ops.length-1]=new e("insert",t,r),this.ops.push(i)):this.ops.push(new e("insert",t,r)),this},r.prototype.delete=function(t){if("string"==typeof t&&(t=t.length),"number"!=typeof t||t<0)throw new Error("delete expects a positive integer or a string");if(0===t)return this;this.baseLength+=t;var r=this.ops.length>0?this.ops[this.ops.length-1]:null;return r&&r.isDelete()?r.chars+=t:this.ops.push(new e("delete",t)),this},r.prototype.isNoop=function(){return 0===this.ops.length||1===this.ops.length&&this.ops[0].isRetain()&&this.ops[0].hasEmptyAttributes()},r.prototype.clone=function(){for(var e=new r,t=0;t<this.ops.length;t++)this.ops[t].isRetain()?e.retain(this.ops[t].chars,this.ops[t].attributes):this.ops[t].isInsert()?e.insert(this.ops[t].text,this.ops[t].attributes):e.delete(this.ops[t].chars);return e},r.prototype.toString=function(){return(Array.prototype.map||function(e){for(var t=[],r=0,i=this.length;r<i;r++)t[r]=e(this[r]);return t}).call(this.ops,function(e){return e.isRetain()?"retain "+e.chars:e.isInsert()?"insert '"+e.text+"'":"delete "+e.chars}).join(", ")},r.prototype.toJSON=function(){for(var e=[],t=0;t<this.ops.length;t++)this.ops[t].hasEmptyAttributes()||e.push(this.ops[t].attributes),"retain"===this.ops[t].type?e.push(this.ops[t].chars):"insert"===this.ops[t].type?e.push(this.ops[t].text):"delete"===this.ops[t].type&&e.push(-this.ops[t].chars);return 0===e.length&&e.push(0),e},r.fromJSON=function(e){for(var i=new r,n=0,s=e.length;n<s;n++){var o=e[n],a={};"object"==typeof o&&(a=o,o=e[++n]),"number"==typeof o?o>0?i.retain(o,a):i.delete(-o):(t.assert("string"==typeof o),i.insert(o,a))}return i},r.prototype.apply=function(e,r,i){if(r=r||[],i=i||[],e.length!==this.baseLength)throw new Error("The operation's base length must be equal to the string's length.");for(var n,s,o=[],a=0,c=0,d=this.ops,h=0,l=d.length;h<l;h++){var u=d[h];if(u.isRetain()){if(c+u.chars>e.length)throw new Error("Operation can't retain more characters than are left in the string.");for(o[a++]=e.slice(c,c+u.chars),n=0;n<u.chars;n++){var p=r[c+n]||{},f={};for(s in p)f[s]=p[s],t.assert(!1!==f[s]);for(s in u.attributes)!1===u.attributes[s]?delete f[s]:f[s]=u.attributes[s],t.assert(!1!==f[s]);i.push(f)}c+=u.chars}else if(u.isInsert())for(o[a++]=u.text,n=0;n<u.text.length;n++){var _={};for(s in u.attributes)_[s]=u.attributes[s],t.assert(!1!==_[s]);i.push(_)}else c+=u.chars}if(c!==e.length)throw new Error("The operation didn't operate on the whole string.");var g=o.join("");return t.assert(g.length===i.length),g},r.prototype.invert=function(e){for(var t=0,i=new r,n=this.ops,s=0,o=n.length;s<o;s++){var a=n[s];a.isRetain()?(i.retain(a.chars),t+=a.chars):a.isInsert()?i.delete(a.text.length):(i.insert(e.slice(t,t+a.chars)),t+=a.chars)}return i},r.prototype.compose=function(e){if(this.targetLength!==e.baseLength)throw new Error("The base length of the second operation has to be the target length of the first operation");function t(e,t,r){var i,n={};for(i in e)n[i]=e[i];for(i in t)r&&!1===t[i]?delete n[i]:n[i]=t[i];return n}for(var i,n=new r,s=this.clone().ops,o=e.clone().ops,a=0,c=0,d=s[a++],h=o[c++];void 0!==d||void 0!==h;)if(d&&d.isDelete())n.delete(d.chars),d=s[a++];else if(h&&h.isInsert())n.insert(h.text,h.attributes),h=o[c++];else{if(void 0===d)throw new Error("Cannot compose operations: first operation is too short.");if(void 0===h)throw new Error("Cannot compose operations: first operation is too long.");if(d.isRetain()&&h.isRetain())i=t(d.attributes,h.attributes),d.chars>h.chars?(n.retain(h.chars,i),d.chars-=h.chars,h=o[c++]):d.chars===h.chars?(n.retain(d.chars,i),d=s[a++],h=o[c++]):(n.retain(d.chars,i),h.chars-=d.chars,d=s[a++]);else if(d.isInsert()&&h.isDelete())d.text.length>h.chars?(d.text=d.text.slice(h.chars),h=o[c++]):d.text.length===h.chars?(d=s[a++],h=o[c++]):(h.chars-=d.text.length,d=s[a++]);else if(d.isInsert()&&h.isRetain())i=t(d.attributes,h.attributes,!0),d.text.length>h.chars?(n.insert(d.text.slice(0,h.chars),i),d.text=d.text.slice(h.chars),h=o[c++]):d.text.length===h.chars?(n.insert(d.text,i),d=s[a++],h=o[c++]):(n.insert(d.text,i),h.chars-=d.text.length,d=s[a++]);else{if(!d.isRetain()||!h.isDelete())throw new Error("This shouldn't happen: op1: "+JSON.stringify(d)+", op2: "+JSON.stringify(h));d.chars>h.chars?(n.delete(h.chars),d.chars-=h.chars,h=o[c++]):d.chars===h.chars?(n.delete(h.chars),d=s[a++],h=o[c++]):(n.delete(d.chars),h.chars-=d.chars,d=s[a++])}}return n},r.prototype.shouldBeComposedWith=function(e){if(this.isNoop()||e.isNoop())return!0;var t=s(this),r=s(e),n=i(this),o=i(e);return!(!n||!o||(n.isInsert()&&o.isInsert()?t+n.text.length!==r:!n.isDelete()||!o.isDelete()||r+o.chars!==t&&t!==r))},r.prototype.shouldBeComposedWithInverted=function(e){if(this.isNoop()||e.isNoop())return!0;var t=s(this),r=s(e),n=i(this),o=i(e);return!!(n&&o&&(n.isInsert()&&o.isInsert()?t+n.text.length===r||t===r:n.isDelete()&&o.isDelete()&&r+o.chars===t))},r.transformAttributes=function(e,r){var i,n={},s={},o={};for(i in e)o[i]=!0;for(i in r)o[i]=!0;for(i in o){var a=e[i],c=r[i];t.assert(null!=a||null!=c),null==a?s[i]=c:null==c?n[i]=a:a===c||(n[i]=a)}return[n,s]},r.transform=function(e,t){if(e.baseLength!==t.baseLength)throw new Error("Both operations have to have the same base length");for(var i=new r,n=new r,s=e.clone().ops,o=t.clone().ops,a=0,c=0,d=s[a++],h=o[c++];void 0!==d||void 0!==h;)if(d&&d.isInsert())i.insert(d.text,d.attributes),n.retain(d.text.length),d=s[a++];else if(h&&h.isInsert())i.retain(h.text.length),n.insert(h.text,h.attributes),h=o[c++];else{if(void 0===d)throw new Error("Cannot transform operations: first operation is too short.");if(void 0===h)throw new Error("Cannot transform operations: first operation is too long.");var l;if(d.isRetain()&&h.isRetain()){var u=r.transformAttributes(d.attributes,h.attributes);d.chars>h.chars?(l=h.chars,d.chars-=h.chars,h=o[c++]):d.chars===h.chars?(l=h.chars,d=s[a++],h=o[c++]):(l=d.chars,h.chars-=d.chars,d=s[a++]),i.retain(l,u[0]),n.retain(l,u[1])}else if(d.isDelete()&&h.isDelete())d.chars>h.chars?(d.chars-=h.chars,h=o[c++]):d.chars===h.chars?(d=s[a++],h=o[c++]):(h.chars-=d.chars,d=s[a++]);else if(d.isDelete()&&h.isRetain())d.chars>h.chars?(l=h.chars,d.chars-=h.chars,h=o[c++]):d.chars===h.chars?(l=h.chars,d=s[a++],h=o[c++]):(l=d.chars,h.chars-=d.chars,d=s[a++]),i.delete(l);else{if(!d.isRetain()||!h.isDelete())throw new Error("The two operations aren't compatible");d.chars>h.chars?(l=h.chars,d.chars-=h.chars,h=o[c++]):d.chars===h.chars?(l=d.chars,d=s[a++],h=o[c++]):(l=d.chars,h.chars-=d.chars,d=s[a++]),n.delete(l)}}return[i,n]},r.prototype.transform=function(e){return r.transform(this,e)},r}(),(n=n||{}).AnnotationList=function(){var e=n.Span;function t(e,t){if(!e)throw new Error("AnnotationList assertion failed"+(t?": "+t:""))}function r(e,t){this.pos=e,this.length=t.length,this.annotation=t.annotation,this.attachedObject_=t.attachedObject}function i(e,t){this.pos=e,this.length=t.length,this.annotation=t.annotation,this.node_=t}r.prototype.getAttachedObject=function(){return this.attachedObject_},i.prototype.attachObject=function(e){this.node_.attachedObject=e};var s={equals:function(){return!1}};function o(e){this.head_=new a(0,s),this.changeHandler_=e}function a(e,t){this.length=e,this.annotation=t,this.attachedObject=null,this.next=null}return o.prototype.insertAnnotatedSpan=function(r,i){this.wrapOperation_(new e(r.pos,0),function(e,n){t(!n||null===n.next);var o=new a(r.length,i);if(n){t(r.pos>e&&r.pos<e+n.length);var c=new a(0,s);return c.next=new a(r.pos-e,n.annotation),c.next.next=o,o.next=new a(e+n.length-r.pos,n.annotation),c.next}return o})},o.prototype.removeSpan=function(e){0!==e.length&&this.wrapOperation_(e,function(r,i){t(null!==i);var n=new a(0,s),o=n;for(e.pos>r&&(o.next=new a(e.pos-r,i.annotation),o=o.next);e.end()>r+i.length;)r+=i.length,i=i.next;var c=r+i.length-e.end();return c>0&&(o.next=new a(c,i.annotation)),n.next})},o.prototype.updateSpan=function(e,r){0!==e.length&&this.wrapOperation_(e,function(i,n){t(null!==n);var o=new a(0,s),c=o,d=i,h=e.pos-d;for(t(h<n.length),h>0&&(c.next=new a(h,n.annotation),d+=(c=c.next).length);null!==n&&e.end()>=i+n.length;){var l=i+n.length-d;c.next=new a(l,r(n.annotation,l)),c=c.next,i+=n.length,n=n.next,d=i}var u=e.end()-d;return u>0&&(t(u<n.length),c.next=new a(u,r(n.annotation,u)),d+=(c=c.next).length,c.next=new a(i+n.length-d,n.annotation)),o.next})},o.prototype.wrapOperation_=function(e,t){if(e.pos<0)throw new Error("Span start cannot be negative.");var n,s=[],o=[],c=this.getAffectedNodes_(e);null!==c.start?(n=c.end.next,c.end.next=null):n=c.succ;var d=t(c.startPos,c.start),h=!1,l=!1;if(d){var u;for(this.mergeNodesWithSameAnnotations_(d),c.pred&&c.pred.annotation.equals(d.annotation)?(h=!0,d.length+=c.pred.length,c.beforePred.next=d,u=c.predPos):(c.beforeStart.next=d,u=c.startPos);d.next;)o.push(new i(u,d)),u+=d.length,d=d.next;c.succ&&c.succ.annotation.equals(d.annotation)?(d.length+=c.succ.length,l=!0,d.next=c.succ.next):d.next=n,o.push(new i(u,d))}else c.pred&&c.succ&&c.pred.annotation.equals(c.succ.annotation)?(h=!0,l=!0,d=new a(c.pred.length+c.succ.length,c.pred.annotation),c.beforePred.next=d,d.next=c.succ.next,o.push(new i(c.startPos-c.pred.length,d))):c.beforeStart.next=n;h&&s.push(new r(c.predPos,c.pred));for(var p=c.startPos,f=c.start;null!==f;)s.push(new r(p,f)),p+=f.length,f=f.next;l&&s.push(new r(p,c.succ)),this.changeHandler_(s,o)},o.prototype.getAffectedNodes_=function(e){for(var t={},r=null,i=this.head_,n=i.next,s=0;null!==n&&e.pos>=s+n.length;)s+=n.length,r=i,i=n,n=n.next;if(null===n&&(0!==e.length||e.pos!==s))throw new Error("Span start exceeds the bounds of the AnnotationList.");for(t.startPos=s,0===e.length&&e.pos===s?t.start=null:t.start=n,t.beforeStart=i,s===e.pos&&s>0?(t.pred=i,t.predPos=s-i.length,t.beforePred=r):t.pred=null;null!==n&&e.end()>s;)s+=n.length,i=n,n=n.next;if(e.end()>s)throw new Error("Span end exceeds the bounds of the AnnotationList.");return 0===e.length&&e.end()===s?t.end=null:t.end=i,t.succ=s===e.end()?n:null,t},o.prototype.mergeNodesWithSameAnnotations_=function(e){if(e)for(var t=null,r=e;r;)t&&t.annotation.equals(r.annotation)?(t.length+=r.length,t.next=r.next):t=r,r=r.next},o.prototype.forEach=function(e){for(var t=this.head_.next;null!==t;)e(t.length,t.annotation,t.attachedObject),t=t.next},o.prototype.getAnnotatedSpansForPos=function(e){for(var t=0,i=this.head_.next,n=null;null!==i&&t+i.length<=e;)t+=i.length,n=i,i=i.next;if(null===i&&t!==e)throw new Error("pos exceeds the bounds of the AnnotationList");var s=[];return t===e&&n&&s.push(new r(t-n.length,n)),i&&s.push(new r(t,i)),s},o.prototype.getAnnotatedSpansForSpan=function(t){if(0===t.length)return[];for(var r=[],i=this.getAffectedNodes_(t),n=i.startPos,s=i.start;null!==s&&n<t.end();){var o=Math.max(n,t.pos),a=Math.min(n+s.length,t.end()),c=new e(o,a-o);c.annotation=s.annotation,r.push(c),n+=s.length,s=s.next}return r},o.prototype.count=function(){for(var e=0,r=this.head_.next,i=null;null!==r;)i&&t(!i.annotation.equals(r.annotation)),i=r,r=r.next,e++;return e},a.prototype.clone=function(){var e=new a(this.spanLength,this.annotation);return e.next=this.next,e},o}(),(n=n||{}).Cursor=function(){"use strict";function e(e,t){this.position=e,this.selectionEnd=t}return e.fromJSON=function(t){return new e(t.position,t.selectionEnd)},e.prototype.equals=function(e){return this.position===e.position&&this.selectionEnd===e.selectionEnd},e.prototype.compose=function(e){return e},e.prototype.transform=function(t){function r(e){for(var r=e,i=t.ops,n=0,s=t.ops.length;n<s&&(i[n].isRetain()?e-=i[n].chars:i[n].isInsert()?r+=i[n].text.length:(r-=Math.min(e,i[n].chars),e-=i[n].chars),!(e<0));n++);return r}var i=r(this.position);return this.position===this.selectionEnd?new e(i,i):new e(i,r(this.selectionEnd))},e}(),(n=n||{}).FirebaseAdapter=function(e){"undefined"==typeof firebase&&"function"!=typeof Firebase&&(firebase=r("./node_modules/firebase/app/dist/index.esm.js"),r("./node_modules/firebase/database/dist/index.esm.js"));var t=n.TextOperation,i=n.utils;function s(e,r,i){this.ref_=e,this.ready_=!1,this.firebaseCallbacks_=[],this.zombie_=!1,this.document_=new t,this.revision_=0,this.pendingReceivedRevisions_={};var n=this;if(r){this.setUserId(r),this.setColor(i);var s=e.root.child(".info/connected");this.firebaseOn_(s,"value",function(e){!0===e.val()&&n.initializeUserData_()},this),this.on("ready",function(){n.monitorCursors_()})}else this.userId_=e.push().key;setTimeout(function(){n.monitorHistory_()},0)}function o(e,t){if(!e)throw new Error(t||"assertion error")}i.makeEventEmitter(s,["ready","cursor","operation","ack","retry"]),s.prototype.dispose=function(){var e=this;this.removeFirebaseCallbacks_(),this.handleInitialRevisions_=()=>{},this.ready_?(this.userRef_&&(this.userRef_.child("cursor").remove(),this.userRef_.child("color").remove()),this.ref_=null,this.document_=null,this.zombie_=!0):this.on("ready",function(){e.dispose()})},s.prototype.setUserId=function(e){this.userRef_&&(this.userRef_.child("cursor").remove(),this.userRef_.child("cursor").onDisconnect().cancel(),this.userRef_.child("color").remove(),this.userRef_.child("color").onDisconnect().cancel()),this.userId_=e,this.userRef_=this.ref_.child("users").child(e),this.initializeUserData_()},s.prototype.isHistoryEmpty=function(){return o(this.ready_,"Not ready yet."),0===this.revision_},s.prototype.sendOperation=function(e,t){var r=this;if(this.ready_){o(this.document_.targetLength===e.baseLength,"sendOperation() called with invalid operation.");var n=c(this.revision_);this.sent_={id:n,op:e},function e(n,s){r.ref_.child("history").child(n).transaction(function(e){if(null===e)return s},function(o,a,c){if(o){if("disconnect"!==o.message)throw i.log("Transaction failure!",o),o;r.sent_&&r.sent_.id===n?setTimeout(function(){e(n,s)},0):t&&t(o,!1)}else t&&t(null,a)},!1)}(n,{a:r.userId_,o:e.toJSON(),t:firebase.database.ServerValue.TIMESTAMP})}else this.on("ready",function(){r.trigger("retry")})},s.prototype.sendCursor=function(e){this.userRef_.child("cursor").set(e),this.cursor_=e},s.prototype.setColor=function(e){this.userRef_.child("color").set(e),this.color_=e},s.prototype.getDocument=function(){return this.document_},s.prototype.registerCallbacks=function(e){for(var t in e)this.on(t,e[t])},s.prototype.initializeUserData_=function(){this.userRef_.child("cursor").onDisconnect().remove(),this.userRef_.child("color").onDisconnect().remove(),this.sendCursor(this.cursor_||null),this.setColor(this.color_||null)},s.prototype.monitorCursors_=function(){var e=this.ref_.child("users"),t=this;function r(e){var r=e.key,i=e.val();t.trigger("cursor",r,i.cursor,i.color)}this.firebaseOn_(e,"child_added",r),this.firebaseOn_(e,"child_changed",r),this.firebaseOn_(e,"child_removed",function(e){var r=e.key;t.trigger("cursor",r,null)})},s.prototype.monitorHistory_=function(){var e=this;this.ref_.child("checkpoint").once("value",function(t){if(!e.zombie_){var r=t.child("id").val(),i=t.child("o").val(),n=t.child("a").val();null!=i&&null!=r&&null!==n?(e.pendingReceivedRevisions_[r]={o:i,a:n},e.checkpointRevision_=function(e){o(e.length>0&&e[0]===a[e.length+8]);for(var t=0,r=1;r<e.length;r++)t*=a.length,t+=a.indexOf(e[r]);return t}(r),e.monitorHistoryStartingAt_(e.checkpointRevision_+1)):(e.checkpointRevision_=0,e.monitorHistoryStartingAt_(e.checkpointRevision_))}})},s.prototype.monitorHistoryStartingAt_=function(e){var t=this.ref_.child("history").startAt(null,c(e)),r=this;setTimeout(function(){r.firebaseOn_(t,"child_added",function(e){var t=e.key;r.pendingReceivedRevisions_[t]=e.val(),r.ready_&&r.handlePendingReceivedRevisions_()}),t.once("value",function(){r.handleInitialRevisions_()})},0)},s.prototype.handleInitialRevisions_=function(){o(!this.ready_,"Should not be called multiple times."),this.revision_=this.checkpointRevision_;for(var e=c(this.revision_),t=this.pendingReceivedRevisions_;null!=t[e];){var r=this.parseRevision_(t[e]);r?this.document_=this.document_.compose(r.operation):i.log("Invalid operation.",this.ref_.toString(),e,t[e]),delete t[e],this.revision_++,e=c(this.revision_)}this.trigger("operation",this.document_),this.ready_=!0;var n=this;setTimeout(function(){n.trigger("ready")},0)},s.prototype.handlePendingReceivedRevisions_=function(){for(var e=this.pendingReceivedRevisions_,t=c(this.revision_),r=!1;null!=e[t];){this.revision_++;var n=this.parseRevision_(e[t]);n?(this.document_=this.document_.compose(n.operation),this.sent_&&t===this.sent_.id?this.sent_.op.equals(n.operation)&&n.author===this.userId_?(this.revision_%100==0&&this.saveCheckpoint_(),this.sent_=null,this.trigger("ack")):(r=!0,this.trigger("operation",n.operation)):this.trigger("operation",n.operation)):i.log("Invalid operation.",this.ref_.toString(),t,e[t]),delete e[t],t=c(this.revision_)}r&&(this.sent_=null,this.trigger("retry"))},s.prototype.parseRevision_=function(e){if("object"!=typeof e)return null;if("string"!=typeof e.a||"object"!=typeof e.o)return null;var r=null;try{r=t.fromJSON(e.o)}catch(i){return null}return r.baseLength!==this.document_.targetLength?null:{author:e.a,operation:r}},s.prototype.saveCheckpoint_=function(){this.ref_.child("checkpoint").set({a:this.userId_,o:this.document_.toJSON(),id:c(this.revision_-1)})},s.prototype.firebaseOn_=function(e,t,r,i){return this.firebaseCallbacks_.push({ref:e,eventType:t,callback:r,context:i}),e.on(t,r,i),r},s.prototype.firebaseOff_=function(e,t,r,i){e.off(t,r,i);for(var n=0;n<this.firebaseCallbacks_.length;n++){var s=this.firebaseCallbacks_[n];if(s.ref===e&&s.eventType===t&&s.callback===r&&s.context===i){this.firebaseCallbacks_.splice(n,1);break}}},s.prototype.removeFirebaseCallbacks_=function(){for(var e=0;e<this.firebaseCallbacks_.length;e++){var t=this.firebaseCallbacks_[e];t.ref.off(t.eventType,t.callback,t.context)}this.firebaseCallbacks_=[]};var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(e){if(0===e)return"A0";for(var t="";e>0;){var r=e%a.length;t=a[r]+t,e-=r,e/=a.length}return a[t.length+9]+t}return s}(),(n=n||{}).RichTextToolbar=function(e){var t=n.utils;function r(e){this.imageInsertionUI=e,this.element_=this.makeElement_()}return t.makeEventEmitter(r,["bold","italic","underline","strike","font","font-size","color","left","center","right","unordered-list","ordered-list","todo-list","indent-increase","indent-decrease","undo","redo","insert-image"]),r.prototype.element=function(){return this.element_},r.prototype.makeButton_=function(e,r){var i=this;r=r||e;var n=t.elt("a",[t.elt("span","",{class:"firepad-tb-"+r})],{class:"firepad-btn"});return t.on(n,"click",t.stopEventAnd(function(){i.trigger(e)})),n},r.prototype.makeElement_=function(){var e=this,r=this.makeFontDropdown_(),i=this.makeFontSizeDropdown_(),n=this.makeColorDropdown_(),s=[t.elt("div",[r],{class:"firepad-btn-group"}),t.elt("div",[i],{class:"firepad-btn-group"}),t.elt("div",[n],{class:"firepad-btn-group"}),t.elt("div",[e.makeButton_("bold"),e.makeButton_("italic"),e.makeButton_("underline"),e.makeButton_("strike","strikethrough")],{class:"firepad-btn-group"}),t.elt("div",[e.makeButton_("unordered-list","list-2"),e.makeButton_("ordered-list","numbered-list"),e.makeButton_("todo-list","list")],{class:"firepad-btn-group"}),t.elt("div",[e.makeButton_("indent-decrease"),e.makeButton_("indent-increase")],{class:"firepad-btn-group"}),t.elt("div",[e.makeButton_("left","paragraph-left"),e.makeButton_("center","paragraph-center"),e.makeButton_("right","paragraph-right")],{class:"firepad-btn-group"}),t.elt("div",[e.makeButton_("undo"),e.makeButton_("redo")],{class:"firepad-btn-group"})];e.imageInsertionUI&&s.push(t.elt("div",[e.makeButton_("insert-image")],{class:"firepad-btn-group"}));var o=t.elt("div",s,{class:"firepad-toolbar-wrapper"}),a=t.elt("div",null,{class:"firepad-toolbar"});return a.appendChild(o),a},r.prototype.makeFontDropdown_=function(){for(var e=["Arial","Comic Sans MS","Courier New","Impact","Times New Roman","Verdana"],r=[],i=0;i<e.length;i++){var n=t.elt("span",e[i]);n.setAttribute("style","font-family:"+e[i]),r.push({content:n,value:e[i]})}return this.makeDropdown_("Font","font",r)},r.prototype.makeFontSizeDropdown_=function(){for(var e=[9,10,12,14,18,24,32,42],r=[],i=0;i<e.length;i++){var n=t.elt("span",e[i].toString());n.setAttribute("style","font-size:"+e[i]+"px; line-height:"+(e[i]-6)+"px;"),r.push({content:n,value:e[i]})}return this.makeDropdown_("Size","font-size",r,"px")},r.prototype.makeColorDropdown_=function(){for(var e=["black","red","green","blue","yellow","cyan","magenta","grey"],r=[],i=0;i<e.length;i++){var n=t.elt("div");n.className="firepad-color-dropdown-item",n.setAttribute("style","background-color:"+e[i]),r.push({content:n,value:e[i]})}return this.makeDropdown_("Color","color",r)},r.prototype.makeDropdown_=function(e,r,i,n){n=n||"";var s=this,o=t.elt("a",e+" ▾",{class:"firepad-btn firepad-dropdown"}),a=t.elt("ul",[],{class:"firepad-dropdown-menu"});o.appendChild(a);var c=!1,d=!1;function h(){c&&(a.style.display="",t.off(document,"click",h,!0),c=!1),d=!0,setTimeout(function(){d=!1},0)}function l(e,i){"object"!=typeof e&&(e=document.createTextNode(String(e)));var o=t.elt("a",[e]);t.on(o,"click",t.stopEventAnd(function(){h(),s.trigger(r,i+n)})),a.appendChild(o)}for(var u=0;u<i.length;u++)l(i[u].content,i[u].value);return t.on(o,"click",t.stopEventAnd(function(){d||c||(a.style.display="block",t.on(document,"click",h,!0),c=!0)})),o},r}(),(n=n||{}).WrappedOperation=function(e){"use strict";function t(e,t){this.wrapped=e,this.meta=t}function r(e,t){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])}function i(e,t){return e&&"object"==typeof e&&"function"==typeof e.transform?e.transform(t):e}return t.prototype.apply=function(){return this.wrapped.apply.apply(this.wrapped,arguments)},t.prototype.invert=function(){var e=this.meta;return new t(this.wrapped.invert.apply(this.wrapped,arguments),e&&"object"==typeof e&&"function"==typeof e.invert?e.invert.apply(e,arguments):e)},t.prototype.compose=function(e){return new t(this.wrapped.compose(e.wrapped),function(e,t){if(e&&"object"==typeof e){if("function"==typeof e.compose)return e.compose(t);var i={};return r(e,i),r(t,i),i}return t}(this.meta,e.meta))},t.transform=function(e,r){var n=e.wrapped.transform(r.wrapped);return[new t(n[0],i(e.meta,r.wrapped)),new t(n[1],i(r.meta,e.wrapped))]},t.prototype.transform=function(e){return t.transform(this,e)},t}(),(n=n||{}).UndoManager=function(){"use strict";var e="normal",t="undoing",r="redoing";function i(t){this.maxItems=t||50,this.state=e,this.dontCompose=!1,this.undoStack=[],this.redoStack=[]}function n(e,t){for(var r=[],i=t.constructor,n=e.length-1;n>=0;n--){var s=i.transform(e[n],t);"function"==typeof s[0].isNoop&&s[0].isNoop()||r.push(s[0]),t=s[1]}return r.reverse()}return i.prototype.add=function(e,i){if(this.state===t)this.redoStack.push(e),this.dontCompose=!0;else if(this.state===r)this.undoStack.push(e),this.dontCompose=!0;else{var n=this.undoStack;!this.dontCompose&&i&&n.length>0?n.push(e.compose(n.pop())):(n.push(e),n.length>this.maxItems&&n.shift()),this.dontCompose=!1,this.redoStack=[]}},i.prototype.transform=function(e){this.undoStack=n(this.undoStack,e),this.redoStack=n(this.redoStack,e)},i.prototype.performUndo=function(r){if(this.state=t,0===this.undoStack.length)throw new Error("undo not possible");r(this.undoStack.pop()),this.state=e},i.prototype.performRedo=function(t){if(this.state=r,0===this.redoStack.length)throw new Error("redo not possible");t(this.redoStack.pop()),this.state=e},i.prototype.canUndo=function(){return 0!==this.undoStack.length},i.prototype.canRedo=function(){return 0!==this.redoStack.length},i.prototype.isUndoing=function(){return this.state===t},i.prototype.isRedoing=function(){return this.state===r},i}(),(n=n||{}).Client=function(){"use strict";function e(){this.state=r}function t(){}e.prototype.setState=function(e){this.state=e},e.prototype.applyClient=function(e){this.setState(this.state.applyClient(this,e))},e.prototype.applyServer=function(e){this.setState(this.state.applyServer(this,e))},e.prototype.serverAck=function(){this.setState(this.state.serverAck(this))},e.prototype.serverRetry=function(){this.setState(this.state.serverRetry(this))},e.prototype.sendOperation=function(e){throw new Error("sendOperation must be defined in child class")},e.prototype.applyOperation=function(e){throw new Error("applyOperation must be defined in child class")},e.Synchronized=t,t.prototype.applyClient=function(e,t){return e.sendOperation(t),new i(t)},t.prototype.applyServer=function(e,t){return e.applyOperation(t),this},t.prototype.serverAck=function(e){throw new Error("There is no pending operation.")},t.prototype.serverRetry=function(e){throw new Error("There is no pending operation.")};var r=new t;function i(e){this.outstanding=e}function n(e,t){this.outstanding=e,this.buffer=t}return e.AwaitingConfirm=i,i.prototype.applyClient=function(e,t){return new n(this.outstanding,t)},i.prototype.applyServer=function(e,t){var r=this.outstanding.transform(t);return e.applyOperation(r[1]),new i(r[0])},i.prototype.serverAck=function(e){return r},i.prototype.serverRetry=function(e){return e.sendOperation(this.outstanding),this},e.AwaitingWithBuffer=n,n.prototype.applyClient=function(e,t){var r=this.buffer.compose(t);return new n(this.outstanding,r)},n.prototype.applyServer=function(e,t){var r=this.outstanding.transform(t),i=this.buffer.transform(r[1]);return e.applyOperation(i[1]),new n(r[0],i[0])},n.prototype.serverRetry=function(e){var t=this.outstanding.compose(this.buffer);return e.sendOperation(t),new i(t)},n.prototype.serverAck=function(e){return e.sendOperation(this.buffer),new i(this.buffer)},e}(),(n=n||{}).EditorClient=function(){"use strict";var e=n.Client,t=n.Cursor,r=n.UndoManager,i=n.WrappedOperation;function s(e,t){this.cursorBefore=e,this.cursorAfter=t}function o(e,t){this.id=e,this.editorAdapter=t}function a(i,n){e.call(this),this.serverAdapter=i,this.editorAdapter=n,this.undoManager=new r,this.clients={};var s=this;this.editorAdapter.registerCallbacks({change:function(e,t){s.onChange(e,t)},cursorActivity:function(){s.onCursorActivity()},blur:function(){s.onBlur()},focus:function(){s.onFocus()}}),this.editorAdapter.registerUndo(function(){s.undo()}),this.editorAdapter.registerRedo(function(){s.redo()}),this.serverAdapter.registerCallbacks({ack:function(){s.serverAck(),s.focused&&s.state instanceof e.Synchronized&&(s.updateCursor(),s.sendCursor(s.cursor)),s.emitStatus()},retry:function(){s.serverRetry()},operation:function(e){s.applyServer(e)},cursor:function(r,i,n){if(s.serverAdapter.userId_!==r&&s.state instanceof e.Synchronized){var o=s.getClientObject(r);i?(n&&o.setColor(n),o.updateCursor(t.fromJSON(i))):o.removeCursor()}}})}return s.prototype.invert=function(){return new s(this.cursorAfter,this.cursorBefore)},s.prototype.compose=function(e){return new s(this.cursorBefore,e.cursorAfter)},s.prototype.transform=function(e){return new s(this.cursorBefore?this.cursorBefore.transform(e):null,this.cursorAfter?this.cursorAfter.transform(e):null)},o.prototype.setColor=function(e){this.color=e},o.prototype.updateCursor=function(e){this.removeCursor(),this.cursor=e,this.mark=this.editorAdapter.setOtherCursor(e,this.color,this.id)},o.prototype.removeCursor=function(){this.mark&&this.mark.clear()},function(e,t){function r(){}r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}(a,e),a.prototype.getClientObject=function(e){var t=this.clients[e];return t||(this.clients[e]=new o(e,this.editorAdapter))},a.prototype.applyUnredo=function(e){this.undoManager.add(this.editorAdapter.invertOperation(e)),this.editorAdapter.applyOperation(e.wrapped),this.cursor=e.meta.cursorAfter,this.cursor&&this.editorAdapter.setCursor(this.cursor),this.applyClient(e.wrapped)},a.prototype.undo=function(){var e=this;this.undoManager.canUndo()&&this.undoManager.performUndo(function(t){e.applyUnredo(t)})},a.prototype.redo=function(){var e=this;this.undoManager.canRedo()&&this.undoManager.performRedo(function(t){e.applyUnredo(t)})},a.prototype.onChange=function(e,t){var r=this.cursor;this.updateCursor();var n,o=this.undoManager.undoStack.length>0&&t.shouldBeComposedWithInverted((n=this.undoManager.undoStack,n[n.length-1]).wrapped),a=new s(this.cursor,r);this.undoManager.add(new i(t,a),o),this.applyClient(e)},a.prototype.updateCursor=function(){this.cursor=this.editorAdapter.getCursor()},a.prototype.onCursorActivity=function(){var e=this.cursor;this.updateCursor(),!this.focused||e&&this.cursor.equals(e)||this.sendCursor(this.cursor)},a.prototype.onBlur=function(){this.cursor=null,this.sendCursor(null),this.focused=!1},a.prototype.onFocus=function(){this.focused=!0,this.onCursorActivity()},a.prototype.sendCursor=function(t){this.state instanceof e.AwaitingWithBuffer||this.serverAdapter.sendCursor(t)},a.prototype.sendOperation=function(e){this.serverAdapter.sendOperation(e),this.emitStatus()},a.prototype.applyOperation=function(e){this.editorAdapter.applyOperation(e),this.updateCursor(),this.undoManager.transform(new i(e,null))},a.prototype.emitStatus=function(){var t=this;setTimeout(function(){t.trigger("synced",t.state instanceof e.Synchronized)},0)},a}(),n.utils.makeEventEmitter(n.EditorClient,["synced"]),null==n&&(n={}),n.ACEAdapter=(function(){var t=function(){function t(e){var i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onCursorActivity=this.onCursorActivity.bind(this),this.ace=e,this.aceSession=this.ace.getSession(),this.aceDoc=this.aceSession.getDocument(),this.aceDoc.setNewLineMode("unix"),this.grabDocumentState(),this.ace.on("change",this.onChange),this.ace.on("blur",this.onBlur),this.ace.on("focus",this.onFocus),this.aceSession.selection.on("changeCursor",this.onCursorActivity),null==this.aceRange&&(this.aceRange=(null!=(i=ace.require)?i:r("./node_modules/firepad/dist sync recursive"))("ace/range").Range)}var s,o,a;return s=t,o=[{key:"grabDocumentState",value:function(){return this.lastDocLines=this.aceDoc.getAllLines(),this.lastCursorRange=this.aceSession.selection.getRange()}},{key:"detach",value:function(){return this.ace.removeListener("change",this.onChange),this.ace.removeListener("blur",this.onBlur),this.ace.removeListener("focus",this.onFocus),this.aceSession.selection.removeListener("changeCursor",this.onCursorActivity)}},{key:"onChange",value:function(t){var r;if(!this.ignoreChanges)return r=this.operationFromACEChange(t),this.trigger.apply(this,["change"].concat(e(r))),this.grabDocumentState()}},{key:"onBlur",value:function(){if(this.ace.selection.isEmpty())return this.trigger("blur")}},{key:"onFocus",value:function(){return this.trigger("focus")}},{key:"onCursorActivity",value:function(){var e=this;return setTimeout(function(){return e.trigger("cursorActivity")},0)}},{key:"operationFromACEChange",value:function(e){var t,r,i,s,o,a,c;return e.data?("insertLines"===(s=(r=e.data).action)||"removeLines"===s?(c=r.lines.join("\n")+"\n",r.action.replace("Lines","")):(c=r.text.replace(this.aceDoc.getNewLineCharacter(),"\n"),r.action.replace("Text","")),a=this.indexFromPos(r.range.start)):(c=e.lines.join("\n"),a=this.indexFromPos(e.start)),o=this.lastDocLines.join("\n").length-a,"remove"===e.action&&(o-=c.length),i=(new n.TextOperation).retain(a).insert(c).retain(o),t=(new n.TextOperation).retain(a).delete(c).retain(o),"remove"===e.action?[t,i]:[i,t]}},{key:"applyOperationToACE",value:function(e){var t,r,i,n,s,o,a,c;for(r=0,i=0,n=(a=e.ops).length;i<n;i++)(s=a[i]).isRetain()?r+=s.chars:s.isInsert()?(this.aceDoc.insert(this.posFromIndex(r),s.text),r+=s.text.length):s.isDelete()&&(t=this.posFromIndex(r),c=this.posFromIndex(r+s.chars),o=this.aceRange.fromPoints(t,c),this.aceDoc.remove(o));return this.grabDocumentState()}},{key:"posFromIndex",value:function(e){var t,r,i,n,s;for(s=t=0,r=(n=this.aceDoc.$lines).length;t<r&&!(e<=(i=n[s]).length);s=++t)e-=i.length+1;return{row:s,column:e}}},{key:"indexFromPos",value:function(e,t){var r,i,n,s;for(null==t&&(t=this.lastDocLines),i=0,r=n=0,s=e.row;0<=s?n<s:n>s;r=0<=s?++n:--n)i+=this.lastDocLines[r].length+1;return i+e.column}},{key:"getValue",value:function(){return this.aceDoc.getValue()}},{key:"getCursor",value:function(){var e,t;try{t=this.indexFromPos(this.aceSession.selection.getRange().start,this.aceDoc.$lines),e=this.indexFromPos(this.aceSession.selection.getRange().end,this.aceDoc.$lines)}catch(i){try{t=this.indexFromPos(this.lastCursorRange.start),e=this.indexFromPos(this.lastCursorRange.end)}catch(i){t=0,e=0}}if(t>e){var r=[e,t];t=r[0],e=r[1]}return new n.Cursor(t,e)}},{key:"setCursor",value:function(e){var t,r;if(r=this.posFromIndex(e.position),t=this.posFromIndex(e.selectionEnd),e.position>e.selectionEnd){var i=[t,r];r=i[0],t=i[1]}return this.aceSession.selection.setSelectionRange(new this.aceRange(r.row,r.column,t.row,t.column))}},{key:"setOtherCursor",value:function(e,t,r){var i,n,s,o,a,c,d,h=this;if(null==this.otherCursors&&(this.otherCursors={}),(s=this.otherCursors[r])&&(s.start.detach(),s.end.detach(),this.aceSession.removeMarker(s.id)),d=this.posFromIndex(e.position),o=this.posFromIndex(e.selectionEnd),e.selectionEnd<e.position){var l=[o,d];d=l[0],o=l[1]}return i="other-client-selection-".concat(t.replace("#","")),(a=e.position===e.selectionEnd)&&(i=i.replace("selection","cursor")),n=".".concat(i," {\n  position: absolute;\n  background-color: ").concat(a?"transparent":t,";\n  border-left: 2px solid ").concat(t,";\n}"),this.addStyleRule(n),this.otherCursors[r]=s=new this.aceRange(d.row,d.column,o.row,o.column),c=this,s.clipRows=function(){var e;return(e=c.aceRange.prototype.clipRows.apply(this,arguments)).isEmpty=function(){return!1},e},s.start=this.aceDoc.createAnchor(s.start),s.end=this.aceDoc.createAnchor(s.end),s.id=this.aceSession.addMarker(s,i,"text"),{clear:function(){return s.start.detach(),s.end.detach(),h.aceSession.removeMarker(s.id)}}}},{key:"addStyleRule",value:function(e){var t;if("undefined"!=typeof document&&null!==document&&(this.addedStyleRules||(this.addedStyleRules={},t=document.createElement("style"),document.documentElement.getElementsByTagName("head")[0].appendChild(t),this.addedStyleSheet=t.sheet),!this.addedStyleRules[e]))return this.addedStyleRules[e]=!0,this.addedStyleSheet.insertRule(e,0)}},{key:"registerCallbacks",value:function(e){this.callbacks=e}},{key:"trigger",value:function(e){for(var t,r,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];return null!=(t=this.callbacks)&&null!=(r=t[e])?r.apply(this,n):void 0}},{key:"applyOperation",value:function(e){return e.isNoop()||(this.ignoreChanges=!0),this.applyOperationToACE(e),this.ignoreChanges=!1}},{key:"registerUndo",value:function(e){return this.ace.undo=e}},{key:"registerRedo",value:function(e){return this.ace.redo=e}},{key:"invertOperation",value:function(e){return e.invert(this.getValue())}}],o&&i(s.prototype,o),a&&i(s,a),t}();return t.prototype.ignoreChanges=!1,t}).call(void 0);var n,s=function(e,t,r){return"."+e+" {\n  position: relative;\nbackground-color: "+t+";\nborder-left: 2px solid "+r+";\n}"},o=function(e,t){if("undefined"==typeof document||null===document)return!1;if(-1===this.addedStyleRules.indexOf(e)){var r=document.createElement("style"),i=document.createTextNode(t);r.appendChild(i),document.head.appendChild(r),this.addedStyleRules.push(e)}},a=function(){function e(e){if(!e||"function"!=typeof e.getModel)throw new Error("MonacoAdapter: Incorrect Parameter Recieved in constructor, expected valid Monaco Instance");this.monaco=e,this.monacoModel=this.monaco.getModel(),this.lastDocLines=this.monacoModel.getLinesContent(),this.lastCursorRange=this.monaco.getSelection(),this.callbacks={},this.otherCursors=[],this.addedStyleRules=[],this.ignoreChanges=!1,this.onChange=this.onChange.bind(this),this.onBlur=this.onBlur.bind(this),this.onFocus=this.onFocus.bind(this),this.onCursorActivity=this.onCursorActivity.bind(this),this.changeHandler=this.monaco.onDidChangeModelContent(this.onChange),this.didBlurHandler=this.monaco.onDidBlurEditorWidget(this.onBlur),this.didFocusHandler=this.monaco.onDidFocusEditorWidget(this.onFocus),this.didChangeCursorPositionHandler=this.monaco.onDidChangeCursorPosition(this.onCursorActivity)}return e.prototype.detach=function(){this.changeHandler.dispose(),this.didBlurHandler.dispose(),this.didFocusHandler.dispose(),this.didChangeCursorPositionHandler.dispose()},e.prototype.getCursor=function(){var e=this.monaco.getSelection();null==e&&(e=this.lastCursorRange);var t=e.getStartPosition(),r=e.getEndPosition(),i=this.monacoModel.getOffsetAt(t),s=this.monacoModel.getOffsetAt(r);if(i>s){var o=[s,i];i=o[0],s=o[1]}return new n.Cursor(i,s)},e.prototype.setCursor=function(e){var t=e.position,r=e.selectionEnd,i=this.monacoModel.getPositionAt(t),n=this.monacoModel.getPositionAt(r);if(t>r){var s=[n,i];i=s[0],n=s[1]}this.monaco.setSelection(new monaco.Range(i.lineNumber,i.column,n.lineNumber,n.column))},e.prototype.setOtherCursor=function(e,t,r){if("object"!=typeof e||"number"!=typeof e.position||"number"!=typeof e.selectionEnd)return!1;if("string"!=typeof t||!t.match(/^#[a-fA-F0-9]{3,6}$/))return!1;var i=e.position,n=e.selectionEnd;if(i<0||n<0)return!1;var a=this.otherCursors.find(function(e){return e.clientID===r});a||(a={clientID:r,decoration:[]},this.otherCursors.push(a)),a.decoration=this.monaco.deltaDecorations(a.decoration,[]);var c,d="other-client-selection-"+t.replace("#","");i===n?(d=d.replace("selection","cursor"),c=s(d,"transparent",t),o.call(this,d,c)):(c=s(d,t,t),o.call(this,d,c));var h=this.monacoModel.getPositionAt(i),l=this.monacoModel.getPositionAt(n);if(i>n){var u=[l,h];h=u[0],l=u[1]}a.decoration=this.monaco.deltaDecorations(a.decoration,[{range:new monaco.Range(h.lineNumber,h.column,l.lineNumber,l.column),options:{className:d}}]);var p=this;return{clear:function(){a.decoration=p.monaco.deltaDecorations(a.decoration,[])}}},e.prototype.registerCallbacks=function(e){this.callbacks=Object.assign({},this.callbacks,e)},e.prototype.registerUndo=function(e){if("function"!=typeof e)throw new Error("MonacoAdapter: registerUndo method expects a callback function in parameter");this.callbacks.undo=e},e.prototype.registerRedo=function(e){if("function"!=typeof e)throw new Error("MonacoAdapter: registerRedo method expects a callback function in parameter");this.callbacks.redo=e},e.prototype.operationFromMonacoChanges=function(e,t,r){var i,s,o,a=e.text,c=e.rangeLength,d=e.rangeOffset,h=t.length+r-d;return 0===a.length&&c>0?(o=t.slice(d,d+c),i=(new n.TextOperation).retain(d).delete(c).retain(h-c),s=(new n.TextOperation).retain(d).insert(o).retain(h-c)):a.length>0&&c>0?(o=t.slice(d,d+c),i=(new n.TextOperation).retain(d).delete(c).insert(a).retain(h-c),s=(new n.TextOperation).retain(d).delete(a.length).insert(o).retain(h-c)):(i=(new n.TextOperation).retain(d).insert(a).retain(h),s=(new n.TextOperation).retain(d).delete(a).retain(h)),[i,s]},e.prototype.onChange=function(e){var t=this;if(!this.ignoreChanges){var r=this.lastDocLines.join(this.monacoModel.getEOL()),i=0;if(!e.changes){var s=(new n.TextOperation).retain(r.length);this.trigger("change",s,s)}e.changes.forEach(function(e){var n=t.operationFromMonacoChanges(e,r,i);i+=n[0].targetLength-n[0].baseLength,t.trigger.apply(t,["change"].concat(n))}),this.lastDocLines=this.monacoModel.getLinesContent()}},e.prototype.trigger=function(e){if(this.callbacks.hasOwnProperty(e)){var t=this.callbacks[e],r=[];if(arguments.length>1)for(var i=1;i<arguments.length;i++)r.push(arguments[i]);t.apply(null,r)}},e.prototype.onBlur=function(){this.monaco.getSelection().isEmpty()&&this.trigger("blur")},e.prototype.onFocus=function(){this.trigger("focus")},e.prototype.onCursorActivity=function(){var e=this;setTimeout(function(){return e.trigger("cursorActivity")},1)},e.prototype.applyOperation=function(e){e.isNoop()||(this.ignoreChanges=!0);var t=e.ops,r=0,i=this;t.forEach(function(e){if(e.isRetain())r+=e.chars;else if(e.isInsert()){var t=i.monacoModel.getPositionAt(r);i.monaco.executeEdits("my-source",[{range:new monaco.Range(t.lineNumber,t.column,t.lineNumber,t.column),text:e.text,forceMoveMarkers:!0}]),r+=e.text.length}else if(e.isDelete()){var n=i.monacoModel.getPositionAt(r),s=i.monacoModel.getPositionAt(r+e.chars);i.monaco.executeEdits("my-source",[{range:new monaco.Range(n.lineNumber,n.column,s.lineNumber,s.column),text:"",forceMoveMarkers:!0}])}}),this.lastDocLines=this.monacoModel.getLinesContent(),this.ignoreChanges=!1},e.prototype.invertOperation=function(e){e.invert(this.getValue())},e}();return n.MonacoAdapter=a,(n=n||{}).AttributeConstants={BOLD:"b",ITALIC:"i",UNDERLINE:"u",STRIKE:"s",FONT:"f",FONT_SIZE:"fs",COLOR:"c",BACKGROUND_COLOR:"bc",ENTITY_SENTINEL:"ent",LINE_SENTINEL:"l",LINE_INDENT:"li",LINE_ALIGN:"la",LIST_TYPE:"lt"},n.sentinelConstants={LINE_SENTINEL_CHARACTER:"",ENTITY_SENTINEL_CHARACTER:""},(n=n||{}).EntityManager=function(){var e=n.utils;function t(){this.entities_={};var t=["src","alt","width","height","style","class"];this.register("img",{render:function(t){e.assert(t.src,"image entity should have 'src'!");for(var r=["src","alt","width","height","style","class"],i="<img ",n=0;n<r.length;n++){var s=r[n];s in t&&(i+=" "+s+'="'+t[s]+'"')}return i+=">"},fromElement:function(e){for(var r={},i=0;i<t.length;i++){var n=t[i];e.hasAttribute(n)&&(r[n]=e.getAttribute(n))}return r}})}return t.prototype.register=function(e,t){n.utils.assert(t.render,"Entity options should include a 'render' function!"),n.utils.assert(t.fromElement,"Entity options should include a 'fromElement' function!"),this.entities_[e]=t},t.prototype.renderToElement=function(e,t){return this.tryRenderToElement_(e,"render",t)},t.prototype.exportToElement=function(e){var t=this.tryRenderToElement_(e,"export")||this.tryRenderToElement_(e,"getHtml")||this.tryRenderToElement_(e,"render");return t.setAttribute("data-firepad-entity",e.type),t},t.prototype.updateElement=function(e,t){var r=e.type,i=e.info;this.entities_[r]&&void 0!==this.entities_[r].update&&this.entities_[r].update(i,t)},t.prototype.fromElement=function(e){var t=e.getAttribute("data-firepad-entity");if(t||(t=e.nodeName.toLowerCase()),t&&this.entities_[t]){var r=this.entities_[t].fromElement(e);return new n.Entity(t,r)}},t.prototype.tryRenderToElement_=function(e,t,r){var i=e.type,s=e.info;if(this.entities_[i]&&this.entities_[i][t]){var o=n.document||window&&window.document,a=this.entities_[i][t](s,r,o);if(a){if("string"==typeof a){var c=(n.document||document).createElement("div");return c.innerHTML=a,c.childNodes[0]}if("object"==typeof a)return n.utils.assert(void 0!==a.nodeType,"Error rendering "+i+" entity.  render() function must return an html string or a DOM element."),a}}},t.prototype.entitySupportsUpdate=function(e){return this.entities_[e]&&this.entities_[e].update},t}(),(n=n||{}).Entity=function(){var e=n.AttributeConstants.ENTITY_SENTINEL,t=e+"_";function r(e,t){if(!(this instanceof r))return new r(e,t);this.type=e,this.info=t||{}}return r.prototype.toAttributes=function(){var r={};for(var i in r[e]=this.type,this.info)r[t+i]=this.info[i];return r},r.fromAttributes=function(i){var n=i[e],s={};for(var o in i)0===o.indexOf(t)&&(s[o.substr(t.length)]=i[o]);return new r(n,s)},r}(),(n=n||{}).RichTextCodeMirror=function(){var e=n.AnnotationList,t=n.Span,r=n.utils,i=n.AttributeConstants,s={c:"color",bc:"background-color",fs:"font-size",li:function(e){return"padding-left: "+40*e+"px"}},o={};function a(t,r,i){this.codeMirror=t,this.options_=i||{},this.entityManager_=r,this.currentAttributes_=null;var n=this;this.annotationList_=new e(function(e,t){n.onAnnotationsChanged_(e,t)}),this.initAnnotationList_(),f(this,"onCodeMirrorBeforeChange_"),f(this,"onCodeMirrorChange_"),f(this,"onCursorActivity_"),parseInt(CodeMirror.version)>=4?this.codeMirror.on("changes",this.onCodeMirrorChange_):this.codeMirror.on("change",this.onCodeMirrorChange_),this.codeMirror.on("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.on("cursorActivity",this.onCursorActivity_),this.changeId_=0,this.outstandingChanges_={},this.dirtyLines_=[]}r.makeEventEmitter(a,["change","attributesChange","newLine"]);var c=n.sentinelConstants.LINE_SENTINEL_CHARACTER,d=n.sentinelConstants.ENTITY_SENTINEL_CHARACTER;function h(e,t){return e.line-t.line||e.ch-t.ch}function l(e,t){return h(e,t)<=0}function u(e){if(0===e.length)return 0;for(var t=0,r=0;r<e.length;r++)t+=e[r].length;return t+e.length-1}function p(e){this.attributes=e||{}}function f(e,t){var r=e[t];e[t]=function(){r.apply(e,arguments)}}return a.prototype.detach=function(){this.codeMirror.off("beforeChange",this.onCodeMirrorBeforeChange_),this.codeMirror.off("change",this.onCodeMirrorChange_),this.codeMirror.off("changes",this.onCodeMirrorChange_),this.codeMirror.off("cursorActivity",this.onCursorActivity_),this.clearAnnotations_()},a.prototype.toggleAttribute=function(e,t){var r=t||!0;if(this.emptySelection_()){var i=this.getCurrentAttributes_();i[e]===r?delete i[e]:i[e]=r,this.currentAttributes_=i}else{var n=this.getCurrentAttributes_()[e]!==r&&r;this.setAttribute(e,n)}},a.prototype.setAttribute=function(e,t){var r=this.codeMirror;if(this.emptySelection_()){var i=this.getCurrentAttributes_();!1===t?delete i[e]:i[e]=t,this.currentAttributes_=i}else this.updateTextAttributes(r.indexFromPos(r.getCursor("start")),r.indexFromPos(r.getCursor("end")),function(r){!1===t?delete r[e]:r[e]=t}),this.updateCurrentAttributes_()},a.prototype.updateTextAttributes=function(e,r,n,s,o){var a=[],c=e,d=this;this.annotationList_.updateSpan(new t(e,r-e),function(e,t){var r={};for(var h in e.attributes)r[h]=e.attributes[h];r[i.LINE_SENTINEL]&&!o||n(r);var l={},u={};return d.computeChangedAttributes_(e.attributes,r,l,u),function(e){for(var t in e)return!1;return!0}(l)||a.push({start:c,end:c+t,attributes:l,attributesInverse:u,origin:s}),c+=t,new p(r)}),a.length>0&&this.trigger("attributesChange",this,a)},a.prototype.computeChangedAttributes_=function(e,t,r,i){var n,s={};for(n in e)s[n]=!0;for(n in t)s[n]=!0;for(n in s)n in t?n in e?e[n]!==t[n]&&(r[n]=t[n],i[n]=e[n]):(r[n]=t[n],i[n]=!1):(r[n]=!1,i[n]=e[n])},a.prototype.toggleLineAttribute=function(e,t){var r,i=this.getCurrentLineAttributes_();r=(!(e in i)||i[e]!==t)&&t,this.setLineAttribute(e,r)},a.prototype.setLineAttribute=function(e,t){this.updateLineAttributesForSelection(function(r){!1===t?delete r[e]:r[e]=t})},a.prototype.updateLineAttributesForSelection=function(e){var t=this.codeMirror,r=t.getCursor("start"),i=t.getCursor("end"),n=r.line,s=i.line,o=t.getLine(s),a=this.areLineSentinelCharacters_(o.substr(0,i.ch));s>n&&a&&s--,this.updateLineAttributes(n,s,e)},a.prototype.updateLineAttributes=function(e,t,r){for(var n=e;n<=t;n++){var s=this.codeMirror.getLine(n),o=this.codeMirror.indexFromPos({line:n,ch:0});if(s[0]!==c){var a={};a[i.LINE_SENTINEL]=!0,r(a),this.insertText(o,c,a)}else this.updateTextAttributes(o,o+1,r,null,!0)}},a.prototype.replaceText=function(e,t,r,i,n){this.changeId_++;var s="cmrt-"+this.changeId_;this.outstandingChanges_[s]={origOrigin:n,attributes:i};var o=this.codeMirror,a=o.posFromIndex(e),c="number"==typeof t?o.posFromIndex(t):null;o.replaceRange(r,a,c,s)},a.prototype.insertText=function(e,t,r,i){var n=this.codeMirror,s=n.getCursor(),o="RTCMADAPTER"==i&&!n.somethingSelected()&&e==n.indexFromPos(s);this.replaceText(e,null,t,r,i),o&&n.setCursor(s)},a.prototype.removeText=function(e,t,r){var i=this.codeMirror;i.replaceRange("",i.posFromIndex(e),i.posFromIndex(t),r)},a.prototype.insertEntityAtCursor=function(e,t,r){var i=this.codeMirror,n=i.indexFromPos(i.getCursor("head"));this.insertEntityAt(n,e,t,r)},a.prototype.insertEntityAt=function(e,t,r,i){this.codeMirror,this.insertEntity_(e,new n.Entity(t,r),i)},a.prototype.insertEntity_=function(e,t,r){this.replaceText(e,null,d,t.toAttributes(),r)},a.prototype.getAttributeSpans=function(e,r){for(var i=[],n=this.annotationList_.getAnnotatedSpansForSpan(new t(e,r-e)),s=0;s<n.length;s++)i.push({length:n[s].length,attributes:n[s].annotation.attributes});return i},a.prototype.end=function(){var e=this.codeMirror.lineCount()-1;return this.codeMirror.indexFromPos({line:e,ch:this.codeMirror.getLine(e).length})},a.prototype.getRange=function(e,t){var r=this.codeMirror.posFromIndex(e),i=this.codeMirror.posFromIndex(t);return this.codeMirror.getRange(r,i)},a.prototype.initAnnotationList_=function(){var e=this.end();0!==e&&this.annotationList_.insertAnnotatedSpan(new t(0,e),new p)},a.prototype.onAnnotationsChanged_=function(e,t){var r,n={};this.tryToUpdateEntitiesInPlace(e,t);for(var s=0;s<e.length;s++){var o=e[s].annotation.attributes;i.LINE_SENTINEL in o&&(n[this.codeMirror.posFromIndex(e[s].pos).line]=!0),(r=e[s].getAttachedObject())&&r.clear()}for(s=0;s<t.length;s++){var a=t[s].annotation,c=i.LINE_SENTINEL in a.attributes,d=i.ENTITY_SENTINEL in a.attributes,h=this.codeMirror.posFromIndex(t[s].pos);if(c)n[h.line]=!0;else if(d)this.markEntity_(t[s]);else{var l=this.getClassNameForAttributes_(a.attributes);if(""!==l){var u=this.codeMirror.posFromIndex(t[s].pos+t[s].length);r=this.codeMirror.markText(h,u,{className:l}),t[s].attachObject(r)}}}for(var p in n)this.dirtyLines_.push(this.codeMirror.getLineHandle(Number(p))),this.queueLineMarking_()},a.prototype.tryToUpdateEntitiesInPlace=function(e,t){for(var r=e.length;r--;)for(var i=e[r],n=t.length;n--;){var s=t[n];if(i.pos==s.pos&&i.length==s.length&&i.annotation.attributes.ent&&i.annotation.attributes.ent==s.annotation.attributes.ent){var o=s.annotation.attributes.ent;if(this.entityManager_.entitySupportsUpdate(o)){e.splice(r,1),t.splice(n,1);var a=i.getAttachedObject();a.update(s.annotation.attributes),s.attachObject(a)}}}},a.prototype.queueLineMarking_=function(){if(null==this.lineMarkTimeout_){var e=this;this.lineMarkTimeout_=setTimeout(function(){e.lineMarkTimeout_=null;for(var t=[],r=0;r<e.dirtyLines_.length;r++){var i=e.codeMirror.getLineNumber(e.dirtyLines_[r]);t.push(Number(i))}e.dirtyLines_=[],t.sort(function(e,t){return e-t});var n=-1;for(r=0;r<t.length;r++){var s=t[r];s>n&&(n=e.markLineSentinelCharactersForChangedLines_(s,s))}},0)}},a.prototype.addStyleWithCSS_=function(e){var t=document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t.appendChild(r)},a.prototype.getClassNameForAttributes_=function(e){var t="";for(var r in e){var a=e[r];if(r===i.LINE_SENTINEL)n.utils.assert(!0===a,"LINE_SENTINEL attribute should be true if it exists.");else{var c=(this.options_.cssPrefix||"cmrt-")+r;if(!0!==a){r===i.FONT_SIZE&&"string"!=typeof a&&(a+="px");var d=a.toString().toLowerCase().replace(/[^a-z0-9-_]/g,"-");if(c+="-"+d,s[r]&&(o[r]||(o[r]={}),!o[r][d])){o[r][d]=!0;var h=s[r],l="function"==typeof h?h(a):h+": "+a,u=r==i.LINE_INDENT?"pre."+c:"."+c;this.addStyleWithCSS_(u+" { "+l+" }"),r===i.LINE_INDENT&&(u="pre.CodeMirror-line."+c,this.addStyleWithCSS_(u+" { "+l+" }"))}}t=t+" "+c}}return t},a.prototype.markEntity_=function(e){for(var t=e.annotation.attributes,r=n.Entity.fromAttributes(t),i=this.codeMirror,s=this,o=[],a=0;a<e.length;a++){var c=i.posFromIndex(e.pos+a),d=i.posFromIndex(e.pos+a+1),h={collapsed:!0,atomic:!0,inclusiveLeft:!1,inclusiveRight:!1},l=this.createEntityHandle_(r,e.pos),u=this.entityManager_.renderToElement(r,l);u&&(h.replacedWith=u);var p=i.markText(c,d,h);o.push(p),l.setMarker(p)}e.attachObject({clear:function(){for(var e=0;e<o.length;e++)o[e].clear()},update:function(e){for(var t=n.Entity.fromAttributes(e),r=0;r<o.length;r++)s.entityManager_.updateElement(t,o[r].replacedWith)}}),this.queueRefresh_()},a.prototype.queueRefresh_=function(){var e=this;this.refreshTimer_||(this.refreshTimer_=setTimeout(function(){e.codeMirror.refresh(),e.refreshTimer_=null},0))},a.prototype.createEntityHandle_=function(e,t){var r=null,i=this;function s(){if(r){var e=r.find();return e?i.codeMirror.indexFromPos(e.from):null}return t}return{find:s,remove:function(){var e=s();null!=e&&(i.codeMirror.focus(),i.removeText(e,e+1))},replace:function(t){var r=n.AttributeConstants.ENTITY_SENTINEL,o=r+"_",a=s();i.updateTextAttributes(a,a+1,function(i){for(var n in i)delete i[n];for(var s in i[r]=e.type,t)i[o+s]=t[s]})},setMarker:function(e){r=e}}},a.prototype.lineClassRemover_=function(e){var t=this.codeMirror,r=t.getLineHandle(e);return{clear:function(){t.removeLineClass(r,"text",".*")}}},a.prototype.emptySelection_=function(){var e=this.codeMirror.getCursor("start"),t=this.codeMirror.getCursor("end");return e.line===t.line&&e.ch===t.ch},a.prototype.onCodeMirrorBeforeChange_=function(e,t){if("+input"===t.origin||"paste"===t.origin){for(var r=[],i=0;i<t.text.length;i++){var n=t.text[i];n=n.replace(new RegExp("["+c+d+"]","g"),""),r.push(n)}t.update(t.from,t.to,r)}},a.prototype.onCodeMirrorChange_=function(e,r){if("object"==typeof r.from){for(var i=[];r;)i.push(r),r=r.next;r=i}for(var n=this.convertCoordinateSystemForChanges_(r),s=[],o=0;o<n.length;o++){var a,c=n[o],d=c.start,h=(c.end,c.text),l=c.removed,u=c.origin;if(l.length>0){for(var f=this.annotationList_.getAnnotatedSpansForSpan(new t(d,l.length)),_=0,g=0;g<f.length;g++){var m=f[g];s.push({start:d,end:d+m.length,removedAttributes:m.annotation.attributes,removed:l.substr(_,m.length),attributes:{},text:"",origin:c.origin}),_+=m.length}this.annotationList_.removeSpan(new t(d,l.length))}h.length>0&&("+input"===c.origin||"paste"===c.origin?a=this.currentAttributes_||{}:u in this.outstandingChanges_?(a=this.outstandingChanges_[u].attributes,u=this.outstandingChanges_[u].origOrigin,delete this.outstandingChanges_[u]):a={},this.annotationList_.insertAnnotatedSpan(new t(d,h.length),new p(a)),s.push({start:d,end:d,removedAttributes:{},removed:"",text:h,attributes:a,origin:u}))}this.markLineSentinelCharactersForChanges_(r),s.length>0&&this.trigger("change",this,s)},a.prototype.convertCoordinateSystemForChanges_=function(e){var t=this,r=function(e){return t.codeMirror.indexFromPos(e)};function i(e,t){return function(r){return l(r,t.from)?e(r):l(t.to,r)?e({line:r.line+t.text.length-1-(t.to.line-t.from.line),ch:t.to.line<r.line?r.ch:t.text.length<=1?r.ch-(t.to.ch-t.from.ch)+u(t.text):r.ch-t.to.ch+(i=t.text,i[i.length-1]).length})+u(t.removed)-u(t.text):t.from.line===r.line?e(t.from)+r.ch-t.from.ch:e(t.from)+u(t.removed.slice(0,r.line-t.from.line))+1+r.ch;var i}}for(var n=[],s=e.length-1;s>=0;s--){var o=e[s],a=(r=i(r,o))(o.from),c=o.removed.join("\n"),d=o.text.join("\n");n.unshift({start:a,end:a+c.length,removed:c,text:d,origin:o.origin})}return n},a.prototype.markLineSentinelCharactersForChanges_=function(e){for(var t=Number.MAX_VALUE,r=-1,i=0;i<e.length;i++){var n=e[i],s=n.from.line;n.from.ch,(n.removed.length>1||n.removed[0].indexOf(c)>=0)&&(t=Math.min(t,s),r=Math.max(r,s)),n.text.length>1?(t=Math.min(t,s),r=Math.max(r,s+n.text.length-1)):n.text[0].indexOf(c)>=0&&(t=Math.min(t,s),r=Math.max(r,s))}r=Math.min(r,this.codeMirror.lineCount()-1),this.markLineSentinelCharactersForChangedLines_(t,r)},a.prototype.markLineSentinelCharactersForChangedLines_=function(e,t){if(e<Number.MAX_VALUE)for(;e>0&&this.lineIsListItemOrIndented_(e-1);)e--;if(t>-1)for(var r=this.codeMirror.lineCount();t+1<r&&this.lineIsListItemOrIndented_(t+1);)t++;for(var i=[],n=this.codeMirror,s=e;s<=t;s++){var o=n.getLine(s),a=n.getLineHandle(s);if(n.removeLineClass(a,"text",".*"),o.length>0)for(var d=o.indexOf(c);d>=0;){for(var h=d;d<o.length&&o[d]===c;){for(var l=n.findMarksAt({line:s,ch:d}),u=0;u<l.length;u++)l[u].isForLineSentinel&&l[u].clear();d++}this.markLineSentinelCharacters_(s,h,d,i),d=o.indexOf(c,d)}else i=[]}return t},a.prototype.markLineSentinelCharacters_=function(e,t,r,n){var s=this.codeMirror,o=null,a=null,c=function(){var e=a.find();return e?e.from.line:null};if(0===t){var d=this.getLineAttributes_(e),h=d[i.LIST_TYPE],l=d[i.LINE_INDENT]||0;for(h&&0===l&&(l=1);l>=n.length;)n.push(1);"o"===h?(o=this.makeOrderedListElement_(n[l]),n[l]++):"u"===h?(o=this.makeUnorderedListElement_(),n[l]=1):"t"===h?(o=this.makeTodoListElement_(!1,c),n[l]=1):"tc"===h&&(o=this.makeTodoListElement_(!0,c),n[l]=1);var u=this.getClassNameForAttributes_(d);""!==u&&this.codeMirror.addLineClass(e,"text",u),n[l+1]=1}var p={inclusiveLeft:!0,collapsed:!0};o&&(p.replacedWith=o),(a=s.markText({line:e,ch:t},{line:e,ch:r},p)).isForLineSentinel=!0},a.prototype.makeOrderedListElement_=function(e){return r.elt("div",e+".",{class:"firepad-list-left"})},a.prototype.makeUnorderedListElement_=function(){return r.elt("div","•",{class:"firepad-list-left"})},a.prototype.toggleTodo=function(e){var t,r=i.LIST_TYPE,n=this.getCurrentLineAttributes_();!(r in n)||"t"!==n[r]&&"tc"!==n[r]?t="t":"t"===n[r]?t="tc":"tc"===n[r]&&(t=!!e&&"t"),this.setLineAttribute(r,t)},a.prototype.makeTodoListElement_=function(e,t){var i={type:"checkbox",class:"firepad-todo-left"};e&&(i.checked=!0);var n=r.elt("input",!1,i),s=this;return r.on(n,"click",r.stopEventAnd(function(e){s.codeMirror.setCursor({line:t(),ch:1}),s.toggleTodo(!0)})),n},a.prototype.lineIsListItemOrIndented_=function(e){var t=this.getLineAttributes_(e);return!1!==(t[i.LIST_TYPE]||!1)||0!==(t[i.LINE_INDENT]||0)},a.prototype.onCursorActivity_=function(){var e=this;setTimeout(function(){e.updateCurrentAttributes_()},1)},a.prototype.getCurrentAttributes_=function(){return this.currentAttributes_||this.updateCurrentAttributes_(),this.currentAttributes_},a.prototype.updateCurrentAttributes_=function(){var e=this.codeMirror,t=e.indexFromPos(e.getCursor("anchor")),r=e.indexFromPos(e.getCursor("head")),s=r;if(t>r){for(;s<this.end();){var o=this.getRange(s,s+1);if("\n"!==o&&o!==c)break;s++}s<this.end()&&s++}else for(;s>0&&("\n"===(o=this.getRange(s-1,s))||o===c);)s--;var a=this.annotationList_.getAnnotatedSpansForPos(s);this.currentAttributes_={};var d={};for(var h in a.length>0&&!(i.LINE_SENTINEL in a[0].annotation.attributes)?d=a[0].annotation.attributes:a.length>1&&(n.utils.assert(!(i.LINE_SENTINEL in a[1].annotation.attributes),"Cursor can't be between two line sentinel characters."),d=a[1].annotation.attributes),d)"l"!==h&&"lt"!==h&&"li"!==h&&0!==h.indexOf(i.ENTITY_SENTINEL)&&(this.currentAttributes_[h]=d[h])},a.prototype.getCurrentLineAttributes_=function(){var e=this.codeMirror,t=e.getCursor("anchor"),r=e.getCursor("head"),i=r.line;return 0===r.ch&&t.line<r.line&&i--,this.getLineAttributes_(i)},a.prototype.getLineAttributes_=function(e){var r={},i=this.codeMirror.getLine(e);if(i.length>0&&i[0]===c){var s=this.codeMirror.indexFromPos({line:e,ch:0}),o=this.annotationList_.getAnnotatedSpansForSpan(new t(s,1));for(var a in n.utils.assert(1===o.length),o[0].annotation.attributes)r[a]=o[0].annotation.attributes[a]}return r},a.prototype.clearAnnotations_=function(){this.annotationList_.updateSpan(new t(0,this.end()),function(e,t){return new p({})})},a.prototype.newline=function(){var e=this.codeMirror,t=this;if(this.emptySelection_()){var r=e.getCursor("head").line,n=this.getLineAttributes_(r),s=n[i.LIST_TYPE];s&&1===e.getLine(r).length?this.updateLineAttributes(r,r,function(e){delete e[i.LIST_TYPE],delete e[i.LINE_INDENT]}):(e.replaceSelection("\n","end","+input"),this.updateLineAttributes(r+1,r+1,function(e){for(var o in n)e[o]=n[o];"tc"===s&&(e[i.LIST_TYPE]="t"),t.trigger("newLine",{line:r+1,attr:e})}))}else e.replaceSelection("\n","end","+input")},a.prototype.deleteLeft=function(){var e=this.codeMirror,t=e.getCursor("head"),r=this.getLineAttributes_(t.line),n=r[i.LIST_TYPE],s=r[i.LINE_INDENT],o=this.emptySelection_()&&1===t.ch;o&&n?this.updateLineAttributes(t.line,t.line,function(e){delete e[i.LIST_TYPE],delete e[i.LINE_INDENT]}):o&&s&&s>0?this.unindent():e.deleteH(-1,"char")},a.prototype.deleteRight=function(){var e=this.codeMirror,t=e.getCursor("head"),r=e.getLine(t.line),i=this.areLineSentinelCharacters_(r),n=t.line+1<e.lineCount()?e.getLine(t.line+1):"";this.emptySelection_()&&i&&n[0]===c?(e.replaceRange("",{line:t.line,ch:0},{line:t.line+1,ch:0},"+input"),e.setCursor({line:t.line,ch:0})):e.deleteH(1,"char")},a.prototype.indent=function(){this.updateLineAttributesForSelection(function(e){var t=e[i.LINE_INDENT],r=e[i.LIST_TYPE];t?e[i.LINE_INDENT]++:e[i.LINE_INDENT]=r?2:1})},a.prototype.unindent=function(){this.updateLineAttributesForSelection(function(e){var t=e[i.LINE_INDENT];t&&t>1?e[i.LINE_INDENT]=t-1:(delete e[i.LIST_TYPE],delete e[i.LINE_INDENT])})},a.prototype.getText=function(){return this.codeMirror.getValue().replace(new RegExp(c,"g"),"")},a.prototype.areLineSentinelCharacters_=function(e){for(var t=0;t<e.length;t++)if(e[t]!==c)return!1;return!0},p.prototype.equals=function(e){if(!(e instanceof p))return!1;var t;for(t in this.attributes)if(e.attributes[t]!==this.attributes[t])return!1;for(t in e.attributes)if(e.attributes[t]!==this.attributes[t])return!1;return!0},a}(),(n=n||{}).RichTextCodeMirrorAdapter=function(){"use strict";var e=n.TextOperation,t=n.WrappedOperation,r=n.Cursor;function i(e){this.rtcm=e,this.cm=e.codeMirror,c(this,"onChange"),c(this,"onAttributesChange"),c(this,"onCursorActivity"),c(this,"onFocus"),c(this,"onBlur"),this.rtcm.on("change",this.onChange),this.rtcm.on("attributesChange",this.onAttributesChange),this.cm.on("cursorActivity",this.onCursorActivity),this.cm.on("focus",this.onFocus),this.cm.on("blur",this.onBlur)}function s(e,t){return e.line<t.line?-1:e.line>t.line?1:e.ch<t.ch?-1:e.ch>t.ch?1:0}function o(e){var t=e.lineCount()-1;return e.indexFromPos({line:t,ch:e.getLine(t).length})}function a(e,t){if(!e)throw new Error(t||"assertion error")}function c(e,t){var r=e[t];e[t]=function(){r.apply(e,arguments)}}function d(e){for(var t in e)return!1;return!0}function h(e,t){if("string"!=typeof e)throw new TypeError("Expected a string");3===(e=e.replace(/^#/,"")).length&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]);var r=parseInt(e,16),i=[r>>16,r>>8&255,255&r],n="rgb";return null!=t&&(n="rgba",i.push(t)),n+"("+i.join(",")+")"}return i.prototype.detach=function(){this.rtcm.off("change",this.onChange),this.rtcm.off("attributesChange",this.onAttributesChange),this.cm.off("cursorActivity",this.onCursorActivity),this.cm.off("focus",this.onFocus),this.cm.off("blur",this.onBlur)},i.operationFromCodeMirrorChanges=function(t,r){for(var i=o(r),n=(new e).retain(i),s=(new e).retain(i),a=t.length-1;a>=0;a--){var c=t[a],d=c.start,h=i-d-c.text.length;n=(new e).retain(d).delete(c.removed.length).insert(c.text,c.attributes).retain(h).compose(n),s=s.compose((new e).retain(d).delete(c.text.length).insert(c.removed,c.removedAttributes).retain(h)),i+=c.removed.length-c.text.length}return[n,s]},i.operationFromAttributesChanges=function(t,r){for(var i=o(r),n=new e,s=new e,c=0,d=0;d<t.length;d++){var h=t[d],l=h.start-c;a(l>=0),n.retain(l),s.retain(l);var u=h.end-h.start;n.retain(u,h.attributes),s.retain(u,h.attributesInverse),c=h.start+u}return n.retain(i-c),s.retain(i-c),[n,s]},i.prototype.registerCallbacks=function(e){this.callbacks=e},i.prototype.onChange=function(e,t){if("RTCMADAPTER"!==t[0].origin){var r=i.operationFromCodeMirrorChanges(t,this.cm);this.trigger("change",r[0],r[1])}},i.prototype.onAttributesChange=function(e,t){if("RTCMADAPTER"!==t[0].origin){var r=i.operationFromAttributesChanges(t,this.cm);this.trigger("change",r[0],r[1])}},i.prototype.onCursorActivity=function(){var e=this;setTimeout(function(){e.trigger("cursorActivity")},1)},i.prototype.onFocus=function(){this.trigger("focus")},i.prototype.onBlur=function(){this.cm.somethingSelected()||this.trigger("blur")},i.prototype.getValue=function(){return this.cm.getValue()},i.prototype.getCursor=function(){var e,t=this.cm,i=t.getCursor(),n=t.indexFromPos(i);if(t.somethingSelected()){var o=t.getCursor(!0),a=0===s(i,o)?t.getCursor(!1):o;e=t.indexFromPos(a)}else e=n;return new r(n,e)},i.prototype.setCursor=function(e){this.cm.setSelection(this.cm.posFromIndex(e.position),this.cm.posFromIndex(e.selectionEnd))},i.prototype.addStyleRule=function(e){if("undefined"!=typeof document&&null!==document){if(!this.addedStyleRules){this.addedStyleRules={};var t=document.createElement("style");document.documentElement.getElementsByTagName("head")[0].appendChild(t),this.addedStyleSheet=t.sheet}if(!this.addedStyleRules[e])return this.addedStyleRules[e]=!0,this.addedStyleSheet.insertRule(e,0)}},i.prototype.setOtherCursor=function(e,t,r){var i=this.cm.posFromIndex(e.position);if("string"==typeof t&&t.match(/^#[a-fA-F0-9]{3,6}$/)){var n=this.rtcm.end();if("object"==typeof e&&"number"==typeof e.position&&"number"==typeof e.selectionEnd&&!(e.position<0||e.position>n||e.selectionEnd<0||e.selectionEnd>n)){if(e.position===e.selectionEnd){var s=this.cm.cursorCoords(i),o=document.createElement("span");return o.className="other-client",o.style.borderLeftWidth="2px",o.style.borderLeftStyle="solid",o.style.borderLeftColor=t,o.style.marginLeft=o.style.marginRight="-1px",o.style.height=.9*(s.bottom-s.top)+"px",o.setAttribute("data-clientid",r),o.style.zIndex=0,this.cm.setBookmark(i,{widget:o,insertLeft:!0})}var a,c,d="selection-"+t.replace("#",""),l="."+d+" { background: "+h(t)+";\n background: "+h(t,.4)+";}";return this.addStyleRule(l),e.selectionEnd>e.position?(a=i,c=this.cm.posFromIndex(e.selectionEnd)):(a=this.cm.posFromIndex(e.selectionEnd),c=i),this.cm.markText(a,c,{className:d})}}},i.prototype.trigger=function(e){var t=Array.prototype.slice.call(arguments,1),r=this.callbacks&&this.callbacks[e];r&&r.apply(this,t)},i.prototype.applyOperation=function(e){e.ops.length>10&&this.rtcm.codeMirror.getWrapperElement().setAttribute("style","display: none");for(var t=e.ops,r=0,i=0,n=t.length;i<n;i++){var s=t[i];s.isRetain()?(d(s.attributes)||this.rtcm.updateTextAttributes(r,r+s.chars,function(e){for(var t in s.attributes)!1===s.attributes[t]?delete e[t]:e[t]=s.attributes[t]},"RTCMADAPTER",!0),r+=s.chars):s.isInsert()?(this.rtcm.insertText(r,s.text,s.attributes,"RTCMADAPTER"),r+=s.text.length):s.isDelete()&&this.rtcm.removeText(r,r+s.chars,"RTCMADAPTER")}e.ops.length>10&&(this.rtcm.codeMirror.getWrapperElement().setAttribute("style",""),this.rtcm.codeMirror.refresh())},i.prototype.registerUndo=function(e){this.cm.undo=e},i.prototype.registerRedo=function(e){this.cm.redo=e},i.prototype.invertOperation=function(r){for(var i,n,s=0,o=this.rtcm.codeMirror,a=new e,c=0;c<r.wrapped.ops.length;c++){var h=r.wrapped.ops[c];if(h.isRetain())if(d(h.attributes))a.retain(h.chars),s+=h.chars;else for(i=this.rtcm.getAttributeSpans(s,s+h.chars),n=0;n<i.length;n++){var l={};for(var u in h.attributes){var p=h.attributes[u],f=i[n].attributes[u];!1===p?f&&(l[u]=f):p!==f&&(l[u]=f||!1)}a.retain(i[n].length,l),s+=i[n].length}else if(h.isInsert())a.delete(h.text.length);else if(h.isDelete()){var _=o.getRange(o.posFromIndex(s),o.posFromIndex(s+h.chars));i=this.rtcm.getAttributeSpans(s,s+h.chars);var g=0;for(n=0;n<i.length;n++)a.insert(_.substr(g,i[n].length),i[n].attributes),g+=i[n].length;s+=h.chars}}return new t(a,r.meta.invert())},i}(),(n=n||{}).Formatting=function(){var e=n.AttributeConstants;function t(e){if(!(this instanceof t))return new t(e);this.attributes=e||{}}return t.prototype.cloneWithNewAttribute_=function(e,r){var i={};for(var n in this.attributes)i[n]=this.attributes[n];return!1===r?delete i[e]:i[e]=r,new t(i)},t.prototype.bold=function(t){return this.cloneWithNewAttribute_(e.BOLD,t)},t.prototype.italic=function(t){return this.cloneWithNewAttribute_(e.ITALIC,t)},t.prototype.underline=function(t){return this.cloneWithNewAttribute_(e.UNDERLINE,t)},t.prototype.strike=function(t){return this.cloneWithNewAttribute_(e.STRIKE,t)},t.prototype.font=function(t){return this.cloneWithNewAttribute_(e.FONT,t)},t.prototype.fontSize=function(t){return this.cloneWithNewAttribute_(e.FONT_SIZE,t)},t.prototype.color=function(t){return this.cloneWithNewAttribute_(e.COLOR,t)},t.prototype.backgroundColor=function(t){return this.cloneWithNewAttribute_(e.BACKGROUND_COLOR,t)},t}(),(n=n||{}).Text=function e(t,r){if(!(this instanceof e))return new e(t,r);this.text=t,this.formatting=r||n.Formatting()},(n=n||{}).LineFormatting=function(){var e=n.AttributeConstants;function t(r){if(!(this instanceof t))return new t(r);this.attributes=r||{},this.attributes[e.LINE_SENTINEL]=!0}return t.LIST_TYPE={NONE:!1,ORDERED:"o",UNORDERED:"u",TODO:"t",TODOCHECKED:"tc"},t.prototype.cloneWithNewAttribute_=function(e,r){var i={};for(var n in this.attributes)i[n]=this.attributes[n];return!1===r?delete i[e]:i[e]=r,new t(i)},t.prototype.indent=function(t){return this.cloneWithNewAttribute_(e.LINE_INDENT,t)},t.prototype.align=function(t){return this.cloneWithNewAttribute_(e.LINE_ALIGN,t)},t.prototype.listItem=function(t){return n.utils.assert(!1===t||"u"===t||"o"===t||"t"===t||"tc"===t),this.cloneWithNewAttribute_(e.LIST_TYPE,t)},t.prototype.getIndent=function(){return this.attributes[e.LINE_INDENT]||0},t.prototype.getAlign=function(){return this.attributes[e.LINE_ALIGN]||0},t.prototype.getListItem=function(){return this.attributes[e.LIST_TYPE]||!1},t}(),(n=n||{}).Line=function e(t,r){if(!(this instanceof e))return new e(t,r);"[object Array]"!==Object.prototype.toString.call(t)&&(t=void 0===t?[]:[t]),this.textPieces=t,this.formatting=r||n.LineFormatting()},(n=n||{}).ParseHtml=function(){var e,t=n.LineFormatting.LIST_TYPE;function r(e,r,i){this.listType=e||t.UNORDERED,this.lineFormatting=r||n.LineFormatting(),this.textFormatting=i||n.Formatting()}function i(){this.lines=[],this.currentLine=[],this.currentLineListItemType=null}r.prototype.withTextFormatting=function(e){return new r(this.listType,this.lineFormatting,e)},r.prototype.withLineFormatting=function(e){return new r(this.listType,e,this.textFormatting)},r.prototype.withListType=function(e){return new r(e,this.lineFormatting,this.textFormatting)},r.prototype.withIncreasedIndent=function(){var e=this.lineFormatting.indent(this.lineFormatting.getIndent()+1);return new r(this.listType,e,this.textFormatting)},r.prototype.withAlign=function(e){var t=this.lineFormatting.align(e);return new r(this.listType,t,this.textFormatting)},i.prototype.newlineIfNonEmpty=function(e){this.cleanLine_(),this.currentLine.length>0&&this.newline(e)},i.prototype.newlineIfNonEmptyOrListItem=function(e){this.cleanLine_(),(this.currentLine.length>0||null!==this.currentLineListItemType)&&this.newline(e)},i.prototype.newline=function(e){this.cleanLine_();var t=e.lineFormatting;null!==this.currentLineListItemType&&(t=t.listItem(this.currentLineListItemType),this.currentLineListItemType=null),this.lines.push(n.Line(this.currentLine,t)),this.currentLine=[]},i.prototype.makeListItem=function(e){this.currentLineListItemType=e},i.prototype.cleanLine_=function(){if(this.currentLine.length>0){var e=this.currentLine.length-1;this.currentLine[0].text=this.currentLine[0].text.replace(/^ +/,""),this.currentLine[e].text=this.currentLine[e].text.replace(/ +$/g,"");for(var t=0;t<this.currentLine.length;t++)this.currentLine[t].text=this.currentLine[t].text.replace(/\u00a0/g," ")}1===this.currentLine.length&&""===this.currentLine[0].text&&(this.currentLine=[])};var s=s||{ELEMENT_NODE:1,TEXT_NODE:3};function o(r,i,o){if(r.nodeType===s.ELEMENT_NODE){var c=e.fromElement(r);if(c)return void o.currentLine.push(new n.Text(n.sentinelConstants.ENTITY_SENTINEL_CHARACTER,new n.Formatting(c.toAttributes())))}switch(r.nodeType){case s.TEXT_NODE:var d=r.nodeValue.replace(/[ \n\t]+/g," ");o.currentLine.push(n.Text(d,i.textFormatting));break;case s.ELEMENT_NODE:switch(i=function(e,t){for(var r=e.textFormatting,i=e.lineFormatting,s=t.split(";"),o=0;o<s.length;o++){var a=s[o].split(":");if(2===a.length){var c=n.utils.trim(a[0]).toLowerCase(),d=n.utils.trim(a[1]).toLowerCase();switch(c){case"text-decoration":var h=d.indexOf("underline")>=0,l=d.indexOf("line-through")>=0;r=r.underline(h).strike(l);break;case"font-weight":var u="bold"===d||parseInt(d)>=600;r=r.bold(u);break;case"font-style":var p="italic"===d||"oblique"===d;r=r.italic(p);break;case"color":r=r.color(d);break;case"background-color":r=r.backgroundColor(d);break;case"text-align":i=i.align(d);break;case"font-size":var f=null,_=["px","pt","%","em","xx-small","x-small","small","medium","large","x-large","xx-large","smaller","larger"];n.utils.stringEndsWith(d,_)?f=d:parseInt(d)&&(f=parseInt(d)+"px"),f&&(r=r.fontSize(f));break;case"font-family":var g=n.utils.trim(d.split(",")[0]);g=(g=g.replace(/['"]/g,"")).replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}),r=r.font(g)}}}return e.withLineFormatting(i).withTextFormatting(r)}(i,r.getAttribute("style")||""),r.nodeName.toLowerCase()){case"div":case"h1":case"h2":case"h3":case"p":o.newlineIfNonEmpty(i),a(r,i,o),o.newlineIfNonEmpty(i);break;case"center":i=i.withAlign("center"),o.newlineIfNonEmpty(i),a(r,i.withAlign("center"),o),o.newlineIfNonEmpty(i);break;case"b":case"strong":a(r,i.withTextFormatting(i.textFormatting.bold(!0)),o);break;case"u":a(r,i.withTextFormatting(i.textFormatting.underline(!0)),o);break;case"i":case"em":a(r,i.withTextFormatting(i.textFormatting.italic(!0)),o);break;case"s":a(r,i.withTextFormatting(i.textFormatting.strike(!0)),o);break;case"font":var h=r.getAttribute("face"),l=r.getAttribute("color"),u=parseInt(r.getAttribute("size"));h&&(i=i.withTextFormatting(i.textFormatting.font(h))),l&&(i=i.withTextFormatting(i.textFormatting.color(l))),u&&(i=i.withTextFormatting(i.textFormatting.fontSize(u))),a(r,i,o);break;case"br":o.newline(i);break;case"ul":o.newlineIfNonEmptyOrListItem(i);var p="firepad-todo"===r.getAttribute("class")?t.TODO:t.UNORDERED;a(r,i.withListType(p).withIncreasedIndent(),o),o.newlineIfNonEmpty(i);break;case"ol":o.newlineIfNonEmptyOrListItem(i),a(r,i.withListType(t.ORDERED).withIncreasedIndent(),o),o.newlineIfNonEmpty(i);break;case"li":!function(e,r,i){i.newlineIfNonEmptyOrListItem(r);var n="firepad-checked"===e.getAttribute("class")?t.TODOCHECKED:r.listType;i.makeListItem(n);var s=i.currentLine;a(e,r,i),(s===i.currentLine||i.currentLine.length>0)&&i.newline(r)}(r,i,o);break;case"style":break;default:a(r,i,o)}}}function a(e,t,r){if(e.hasChildNodes())for(var i=0;i<e.childNodes.length;i++)o(e.childNodes[i],t,r)}return function(t,s){var a=(n.document||document).createElement("div");a.innerHTML=t,e=s;var c=new i;return o(a,new r,c),c.lines}}(),(n=n||{}).SerializeHtml=function(){var e=n.utils,t=n.AttributeConstants,r=n.LineFormatting.LIST_TYPE;function i(e){return e===r.ORDERED?"<ol>":e===r.UNORDERED?"<ul>":'<ul class="firepad-todo">'}function s(e){return e===r.ORDERED?"</ol>":"</ul>"}function o(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\u00a0/g,"&nbsp;")}return function(a,c){for(var d,h,l="",u=!0,p=[],f=!1,_=!0,g=!0,m=0,v=a.ops[m],y=!1;v;){e.assert(v.isInsert());var b=v.attributes;if(u){u=!1;var x=0,k=null,w="left";t.LINE_SENTINEL in b&&(x=b[t.LINE_INDENT]||0,k=b[t.LIST_TYPE]||null,w=b[t.LINE_ALIGN]||"left"),k&&(x=x||1),f?(l+="</li>",f=!1):_||(g&&(l+="<br/>"),l+="</div>"),_=!1,e.assert(x>=0,"Indent must not be negative.");for(;p.length>x||x===p.length&&null!==k&&(d=k,h=p[p.length-1],!(d===h||d===r.TODO&&h===r.TODOCHECKED||d===r.TODOCHECKED&&h===r.TODO));)l+=s(p.pop());for(;p.length<x;){var j=k||r.UNORDERED;y=k==r.TODO||k==r.TODOCHECKED||y,l+=i(j),p.push(j)}var C="left"!==w?' style="text-align:'+w+'"':"";if(k){var E="";switch(k){case r.TODOCHECKED:E=' class="firepad-checked"';break;case r.TODO:E=' class="firepad-unchecked"'}l+="<li"+E+C+">",f=!0}else l+="<div"+C+">";g=!0}if(t.LINE_SENTINEL in b)v=a.ops[++m];else if(t.ENTITY_SENTINEL in b){for(var A=0;A<v.text.length;A++){var T=n.Entity.fromAttributes(b);l+=c.exportToElement(T).outerHTML}v=a.ops[++m]}else{var L="",S="";for(var N in b){var O,I,M=b[N];N===t.BOLD||N===t.ITALIC||N===t.UNDERLINE||N===t.STRIKE?(e.assert(!0===M),O=I=N):N===t.FONT_SIZE?(O='span style="font-size: '+M,O+="string"!=typeof M||-1===M.indexOf("px",M.length-2)?'px"':'"',I="span"):N===t.FONT?(O='span style="font-family: '+M+'"',I="span"):N===t.COLOR?(O='span style="color: '+M+'"',I="span"):N===t.BACKGROUND_COLOR?(O='span style="background-color: '+M+'"',I="span"):e.log(!1,"Encountered unknown attribute while rendering html: "+N),O&&(L+="<"+O+">"),I&&(S="</"+I+">"+S)}var R=v.text,F=R.indexOf("\n");F>=0?(u=!0,v=F<R.length-1?new n.TextOp("insert",R.substr(F+1),b):a.ops[++m],R=R.substr(0,F)):v=a.ops[++m],(R=R.replace(/  +/g,function(e){return new Array(e.length+1).join(" ")}).replace(/^ /," ").replace(/ $/," ")).length>0&&(g=!1),l+=L+o(R)+S}}for(f?l+="</li>":_||(g&&(l+="&nbsp;"),l+="</div>");p.length>0;)l+=s(p.pop());return y&&(l='<style>ul.firepad-todo { list-style: none; margin-left: 0; padding-left: 0; } ul.firepad-todo > li { padding-left: 1em; text-indent: -1em; } ul.firepad-todo > li:before { content: "\\2610"; padding-right: 5px; } ul.firepad-todo > li.firepad-checked:before { content: "\\2611"; padding-right: 5px; }</style>\n'+l),l}}(),(n=n||{}).textPiecesToInserts=function(e,t){var r=[];function i(t,i){t instanceof n.Text&&(i=t.formatting.attributes,t=t.text),r.push({string:t,attributes:i}),e="\n"===t[t.length-1]}function s(t,r){e&&i(n.sentinelConstants.LINE_SENTINEL_CHARACTER,t.formatting.attributes);for(var s=0;s<t.textPieces.length;s++)i(t.textPieces[s]);r&&i("\n")}for(var o=0;o<t.length;o++)t[o]instanceof n.Line?s(t[o],o<t.length-1):i(t[o]);return r},(n=n||{}).Headless=function(){var e=n.TextOperation,t=n.FirebaseAdapter,i=n.EntityManager,s=n.ParseHtml;function o(e){if(!(this instanceof o))return new o(e);var n,s;"string"==typeof e?(void 0===window.firebase&&"object"!=typeof n?(n=r("./node_modules/firebase/app/dist/index.esm.js"),r("./node_modules/firebase/database/dist/index.esm.js")):n=window.firebase,s=n.database().refFromURL(e)):s=e,this.entityManager_=new i,this.firebaseAdapter_=new t(s),this.ready_=!1,this.zombie_=!1}return o.prototype.getDocument=function(e){var t=this;if(t.ready_)return e(t.firebaseAdapter_.getDocument());t.firebaseAdapter_.on("ready",function(){t.ready_=!0,e(t.firebaseAdapter_.getDocument())})},o.prototype.getText=function(e){if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");this.getDocument(function(t){var r=t.apply("");for(var i in n.sentinelConstants)r=r.replace(new RegExp(n.sentinelConstants[i],"g"),"");e(r)})},o.prototype.setText=function(t,r){if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");var i=e().insert(t);this.sendOperationWithRetry(i,r)},o.prototype.initializeFakeDom=function(e){if("object"==typeof document||"object"==typeof n.document)e();else{const t=r(0),{JSDOM:i}=t,{window:s}=new i("<head></head><body></body>");if(n.document)return s.close(),e();n.document=s.document,e()}},o.prototype.getHtml=function(e){var t=this;if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");t.initializeFakeDom(function(){t.getDocument(function(r){e(n.SerializeHtml(r,t.entityManager_))})})},o.prototype.setHtml=function(t,r){var i=this;if(this.zombie_)throw new Error("You can't use a firepad.Headless after calling dispose()!");i.initializeFakeDom(function(){for(var o=s(t,i.entityManager_),a=n.textPiecesToInserts(!0,o),c=new e,d=0;d<a.length;d++)c.insert(a[d].string,a[d].attributes);i.sendOperationWithRetry(c,r)})},o.prototype.sendOperationWithRetry=function(e,t){var r=this;r.getDocument(function(i){var n=e.clone().delete(i.targetLength);r.firebaseAdapter_.sendOperation(n,function(i,n){n?void 0!==t&&t(null,n):r.sendOperationWithRetry(e,t)})})},o.prototype.dispose=function(){this.zombie_=!0,this.firebaseAdapter_.dispose()},o}(),(n=n||{}).Firepad=function(e){if(!n.RichTextCodeMirrorAdapter)throw new Error("Oops! It looks like you're trying to include lib/firepad.js directly.  This is actually one of many source files that make up firepad.  You want dist/firepad.js instead.");var t=n.RichTextCodeMirrorAdapter,r=n.RichTextCodeMirror,i=n.RichTextToolbar,s=n.ACEAdapter,o=n.MonacoAdapter,a=n.FirebaseAdapter,c=n.EditorClient,d=n.EntityManager,h=n.AttributeConstants,l=n.utils,u=(n.LineFormatting.LIST_TYPE,e.CodeMirror),p=e.ace;function f(i,n,h){if(!(this instanceof f))return new f(i,n,h);if(!u&&!p&&!e.monaco)throw new Error("Couldn't find CodeMirror, ACE or Monaco.  Did you forget to include codemirror.js/ace.js or import monaco?");if(this.zombie_=!1,u&&n instanceof u){this.codeMirror_=this.editor_=n;var g=this.codeMirror_.getValue();if(""!==g)throw new Error("Can't initialize Firepad with a CodeMirror instance that already contains text.")}else if(p&&n&&n.session instanceof p.EditSession){if(this.ace_=this.editor_=n,""!==(g=this.ace_.getValue()))throw new Error("Can't initialize Firepad with an ACE instance that already contains text.")}else if(e.monaco&&n&&n instanceof e.monaco.constructor){if(e.monaco,this.monaco_=this.editor_=n,""!==(g=this.monaco_.getValue()))throw new Error("Can't initialize Firepad with a Monaco instance that already contains text.")}else this.codeMirror_=this.editor_=new u(n);var m;m=this.codeMirror_?this.codeMirror_.getWrapperElement():this.ace_?this.ace_.container:this.monaco_.getDomNode(),this.firepadWrapper_=l.elt("div",null,{class:"firepad"}),m.parentNode.replaceChild(this.firepadWrapper_,m),this.firepadWrapper_.appendChild(m),this.editor_.firepad=this,this.options_=h||{},this.getOption("richTextShortcuts",!1)&&(u.keyMap.richtext||this.initializeKeyMap_(),this.codeMirror_.setOption("keyMap","richtext"),this.firepadWrapper_.className+=" firepad-richtext"),this.imageInsertionUI=this.getOption("imageInsertionUI",!0),this.getOption("richTextToolbar",!1)&&(this.addToolbar_(),this.firepadWrapper_.className+=" firepad-richtext firepad-with-toolbar"),this.addPoweredByLogo_(),this.codeMirror_&&this.codeMirror_.refresh();var v=this.getOption("userId",i.push().key),y=this.getOption("userColor",function(e){for(var t=1,r=0;r<e.length;r++)t=17*(t+e.charCodeAt(r))%360;return function(e,t,r){if(0===t)return _(r,r,r);var i=r<.5?r*(1+t):r+t-t*r,n=2*r-i,s=function(e){return e<0&&(e+=1),e>1&&(e-=1),6*e<1?n+6*(i-n)*e:2*e<1?i:3*e<2?n+6*(i-n)*(2/3-e):n};return _(s(e+1/3),s(e),s(e-1/3))}(t/360,1,.75)}(v));this.entityManager_=new d,this.firebaseAdapter_=new a(i,v,y),this.codeMirror_?(this.richTextCodeMirror_=new r(this.codeMirror_,this.entityManager_,{cssPrefix:"firepad-"}),this.editorAdapter_=new t(this.richTextCodeMirror_)):this.ace_?this.editorAdapter_=new s(this.ace_):this.editorAdapter_=new o(this.monaco_),this.client_=new c(this.firebaseAdapter_,this.editorAdapter_);var b=this;this.firebaseAdapter_.on("cursor",function(){b.trigger.apply(b,["cursor"].concat([].slice.call(arguments)))}),this.codeMirror_&&this.richTextCodeMirror_.on("newLine",function(){b.trigger.apply(b,["newLine"].concat([].slice.call(arguments)))}),this.firebaseAdapter_.on("ready",function(){b.ready_=!0,this.ace_&&this.editorAdapter_.grabDocumentState(),this.monaco_&&this.editorAdapter_.grabDocumentState();var e=b.getOption("defaultText",null);e&&b.isHistoryEmpty()&&b.setText(e),b.trigger("ready")}),this.client_.on("synced",function(e){b.trigger("synced",e)}),"Microsoft Internet Explorer"==navigator.appName&&navigator.userAgent.match(/MSIE 8\./)&&(window.onload=function(){var e=document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.styleSheet.cssText=":before,:after{content:none !important;}",e.appendChild(t),setTimeout(function(){e.removeChild(t)},0)})}function _(e,t,r){function i(e){var t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t}return"#"+i(e)+i(t)+i(r)}return e.monaco,l.makeEventEmitter(f),f.fromCodeMirror=f,f.fromACE=f,f.fromMonaco=f,f.prototype.dispose=function(){this.zombie_=!0,this.codeMirror_?editorWrapper=this.codeMirror_.getWrapperElement():this.ace_?editorWrapper=this.ace_.container:editorWrapper=this.monaco_.getDomNode(),this.firepadWrapper_.removeChild(editorWrapper),this.firepadWrapper_.parentNode.replaceChild(editorWrapper,this.firepadWrapper_),this.editor_.firepad=null,this.codeMirror_&&"richtext"===this.codeMirror_.getOption("keyMap")&&this.codeMirror_.setOption("keyMap","default"),this.firebaseAdapter_.dispose(),this.editorAdapter_.detach(),this.richTextCodeMirror_&&this.richTextCodeMirror_.detach()},f.prototype.setUserId=function(e){this.firebaseAdapter_.setUserId(e)},f.prototype.setUserColor=function(e){this.firebaseAdapter_.setColor(e)},f.prototype.getText=function(){return this.assertReady_("getText"),this.codeMirror_?this.richTextCodeMirror_.getText():this.ace_?this.ace_.getSession().getDocument().getValue():this.monaco_.getModel().getValue()},f.prototype.setText=function(e){return this.assertReady_("setText"),this.monaco_?this.monaco_.getModel().setValue(e):this.ace_?this.ace_.getSession().getDocument().setValue(e):(this.codeMirror_.getWrapperElement().style.display="none",this.codeMirror_.setValue(""),this.insertText(0,e),this.codeMirror_.getWrapperElement().style.display="",this.codeMirror_.refresh(),void this.editorAdapter_.setCursor({position:0,selectionEnd:0}))},f.prototype.insertTextAtCursor=function(e){this.insertText(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),e)},f.prototype.insertText=function(e,t){l.assert(!this.ace_,"Not supported for ace yet."),l.assert(!this.monaco_,"Not supported for monaco yet."),this.assertReady_("insertText"),"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var r=this;r.codeMirror_.operation(function(){for(var i=0===e,s=n.textPiecesToInserts(i,t),o=0;o<s.length;o++){var a=s[o].string,c=s[o].attributes;r.richTextCodeMirror_.insertText(e,a,c),e+=a.length}})},f.prototype.getOperationForSpan=function(e,t){for(var r=this.richTextCodeMirror_.getRange(e,t),i=this.richTextCodeMirror_.getAttributeSpans(e,t),s=0,o=new n.TextOperation,a=0;a<i.length;a++)o.insert(r.substr(s,i[a].length),i[a].attributes),s+=i[a].length;return o},f.prototype.getHtml=function(){return this.getHtmlFromRange(null,null)},f.prototype.getHtmlFromSelection=function(){var e=this.codeMirror_.getCursor("start"),t=this.codeMirror_.getCursor("end"),r=this.codeMirror_.indexFromPos(e),i=this.codeMirror_.indexFromPos(t);return this.getHtmlFromRange(r,i)},f.prototype.getHtmlFromRange=function(e,t){this.assertReady_("getHtmlFromRange");var r=null!=e&&null!=t?this.getOperationForSpan(e,t):this.getOperationForSpan(0,this.codeMirror_.getValue().length);return n.SerializeHtml(r,this.entityManager_)},f.prototype.insertHtml=function(e,t){var r=n.ParseHtml(t,this.entityManager_);this.insertText(e,r)},f.prototype.insertHtmlAtCursor=function(e){this.insertHtml(this.codeMirror_.indexFromPos(this.codeMirror_.getCursor()),e)},f.prototype.setHtml=function(e){var t=n.ParseHtml(e,this.entityManager_);this.setText(t)},f.prototype.isHistoryEmpty=function(){return this.assertReady_("isHistoryEmpty"),this.firebaseAdapter_.isHistoryEmpty()},f.prototype.bold=function(){this.richTextCodeMirror_.toggleAttribute(h.BOLD),this.codeMirror_.focus()},f.prototype.italic=function(){this.richTextCodeMirror_.toggleAttribute(h.ITALIC),this.codeMirror_.focus()},f.prototype.underline=function(){this.richTextCodeMirror_.toggleAttribute(h.UNDERLINE),this.codeMirror_.focus()},f.prototype.strike=function(){this.richTextCodeMirror_.toggleAttribute(h.STRIKE),this.codeMirror_.focus()},f.prototype.fontSize=function(e){this.richTextCodeMirror_.setAttribute(h.FONT_SIZE,e),this.codeMirror_.focus()},f.prototype.font=function(e){this.richTextCodeMirror_.setAttribute(h.FONT,e),this.codeMirror_.focus()},f.prototype.color=function(e){this.richTextCodeMirror_.setAttribute(h.COLOR,e),this.codeMirror_.focus()},f.prototype.highlight=function(){this.richTextCodeMirror_.toggleAttribute(h.BACKGROUND_COLOR,"rgba(255,255,0,.65)"),this.codeMirror_.focus()},f.prototype.align=function(e){if("left"!==e&&"center"!==e&&"right"!==e)throw new Error('align() must be passed "left", "center", or "right".');this.richTextCodeMirror_.setLineAttribute(h.LINE_ALIGN,e),this.codeMirror_.focus()},f.prototype.orderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(h.LIST_TYPE,"o"),this.codeMirror_.focus()},f.prototype.unorderedList=function(){this.richTextCodeMirror_.toggleLineAttribute(h.LIST_TYPE,"u"),this.codeMirror_.focus()},f.prototype.todo=function(){this.richTextCodeMirror_.toggleTodo(),this.codeMirror_.focus()},f.prototype.newline=function(){this.richTextCodeMirror_.newline()},f.prototype.deleteLeft=function(){this.richTextCodeMirror_.deleteLeft()},f.prototype.deleteRight=function(){this.richTextCodeMirror_.deleteRight()},f.prototype.indent=function(){this.richTextCodeMirror_.indent(),this.codeMirror_.focus()},f.prototype.unindent=function(){this.richTextCodeMirror_.unindent(),this.codeMirror_.focus()},f.prototype.undo=function(){this.codeMirror_.undo()},f.prototype.redo=function(){this.codeMirror_.redo()},f.prototype.insertEntity=function(e,t,r){this.richTextCodeMirror_.insertEntityAtCursor(e,t,r)},f.prototype.insertEntityAt=function(e,t,r,i){this.richTextCodeMirror_.insertEntityAt(e,t,r,i)},f.prototype.registerEntity=function(e,t){this.entityManager_.register(e,t)},f.prototype.getOption=function(e,t){return e in this.options_?this.options_[e]:t},f.prototype.assertReady_=function(e){if(!this.ready_)throw new Error('You must wait for the "ready" event before calling '+e+".");if(this.zombie_)throw new Error("You can't use a Firepad after calling dispose()!  [called "+e+"]")},f.prototype.makeImageDialog_=function(){this.makeDialog_("img","Insert image url")},f.prototype.makeDialog_=function(e,t){var r=this,i=l.elt("input",null,{class:"firepad-dialog-input",id:e,type:"text",placeholder:t,autofocus:"autofocus"}),n=l.elt("a","Submit",{class:"firepad-btn",id:"submitbtn"});l.on(n,"click",l.stopEventAnd(function(){var t=document.getElementById("overlay");t.style.visibility="hidden";var i=document.getElementById(e).value;null!==i&&r.insertEntity(e,{src:i}),r.firepadWrapper_.removeChild(t)}));var s=l.elt("a","Cancel",{class:"firepad-btn"});l.on(s,"click",l.stopEventAnd(function(){var e=document.getElementById("overlay");e.style.visibility="hidden",r.firepadWrapper_.removeChild(e)}));var o=l.elt("div",[n,s],{class:"firepad-btn-group"}),a=l.elt("div",[i,o],{class:"firepad-dialog-div"}),c=l.elt("div",[a],{class:"firepad-dialog",id:"overlay"});this.firepadWrapper_.appendChild(c)},f.prototype.addToolbar_=function(){this.toolbar=new i(this.imageInsertionUI),this.toolbar.on("undo",this.undo,this),this.toolbar.on("redo",this.redo,this),this.toolbar.on("bold",this.bold,this),this.toolbar.on("italic",this.italic,this),this.toolbar.on("underline",this.underline,this),this.toolbar.on("strike",this.strike,this),this.toolbar.on("font-size",this.fontSize,this),this.toolbar.on("font",this.font,this),this.toolbar.on("color",this.color,this),this.toolbar.on("left",function(){this.align("left")},this),this.toolbar.on("center",function(){this.align("center")},this),this.toolbar.on("right",function(){this.align("right")},this),this.toolbar.on("ordered-list",this.orderedList,this),this.toolbar.on("unordered-list",this.unorderedList,this),this.toolbar.on("todo-list",this.todo,this),this.toolbar.on("indent-increase",this.indent,this),this.toolbar.on("indent-decrease",this.unindent,this),this.toolbar.on("insert-image",this.makeImageDialog_,this),this.firepadWrapper_.insertBefore(this.toolbar.element(),this.firepadWrapper_.firstChild)},f.prototype.addPoweredByLogo_=function(){var e=l.elt("a",null,{class:"powered-by-firepad"});e.setAttribute("href","http://www.firepad.io/"),e.setAttribute("target","_blank"),this.firepadWrapper_.appendChild(e)},f.prototype.initializeKeyMap_=function(){function e(e){return function(t){setTimeout(function(){e.call(t.firepad)},0)}}u.keyMap.richtext={"Ctrl-B":e(this.bold),"Cmd-B":e(this.bold),"Ctrl-I":e(this.italic),"Cmd-I":e(this.italic),"Ctrl-U":e(this.underline),"Cmd-U":e(this.underline),"Ctrl-H":e(this.highlight),"Cmd-H":e(this.highlight),Enter:e(this.newline),Delete:e(this.deleteRight),Backspace:e(this.deleteLeft),Tab:e(this.indent),"Shift-Tab":e(this.unindent),fallthrough:["default"]}},f}(this),n.Firepad.Formatting=n.Formatting,n.Firepad.Text=n.Text,n.Firepad.Entity=n.Entity,n.Firepad.LineFormatting=n.LineFormatting,n.Firepad.Line=n.Line,n.Firepad.TextOperation=n.TextOperation,n.Firepad.Headless=n.Headless,n.Firepad.RichTextCodeMirrorAdapter=n.RichTextCodeMirrorAdapter,n.Firepad.ACEAdapter=n.ACEAdapter,n.Firepad.MonacoAdapter=n.MonacoAdapter,n.Firepad},o=this,e.exports?e.exports=s():"function"==typeof o.define&&o.define.amd?void 0===(n="function"==typeof(i=s)?i.call(t,r,t,e):i)||(e.exports=n):o.Firepad=s()},"./node_modules/jstree/dist/jstree.js":function(e,t,r){var i,n,s;!function(o){"use strict";n=[r("./node_modules/jquery/dist/jquery.js")],i=function(e,t){if(e.jstree)return;var r,i,n=0,s=!1,o=!1,a=!1,c=[],d=e("script:last").attr("src"),h=window.document,l=h.createElement("LI");l.setAttribute("role","treeitem"),(r=h.createElement("I")).className="jstree-icon jstree-ocl",r.setAttribute("role","presentation"),l.appendChild(r),(r=h.createElement("A")).className="jstree-anchor",r.setAttribute("href","#"),r.setAttribute("tabindex","-1"),(i=h.createElement("I")).className="jstree-icon jstree-themeicon",i.setAttribute("role","presentation"),r.appendChild(i),l.appendChild(r),r=i=null,e.jstree={version:"3.1.1",defaults:{plugins:[]},plugins:{},path:d&&-1!==d.indexOf("/")?d.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%?`]/g},e.jstree.create=function(t,r){var i=new e.jstree.core(++n),s=r;return r=e.extend(!0,{},e.jstree.defaults,r),s&&s.plugins&&(r.plugins=s.plugins),e.each(r.plugins,function(e,t){"core"!==e&&(i=i.plugin(t,r[t]))}),e(t).data("jstree",i),i.init(t,r),i},e.jstree.destroy=function(){e(".jstree:jstree").jstree("destroy"),e(h).off(".jstree")},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[],focused:null}}},e.jstree.reference=function(t){var r=null,i=null;if(!t||!t.id||t.tagName&&t.nodeType||(t=t.id),!i||!i.length)try{i=e(t)}catch(n){}if(!i||!i.length)try{i=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(n){}return i&&i.length&&(i=i.closest(".jstree")).length&&(i=i.data("jstree"))?r=i:e(".jstree").each(function(){var i=e(this).data("jstree");if(i&&i._model.data[t])return r=i,!1}),r},e.fn.jstree=function(r){var i="string"==typeof r,n=Array.prototype.slice.call(arguments,1),s=null;return!(!0===r&&!this.length)&&(this.each(function(){var o=e.jstree.reference(this),a=i&&o?o[r]:null;if(s=i&&a?a.apply(o,n):null,o||i||r!==t&&!e.isPlainObject(r)||e.jstree.create(this,r),(o&&!i||!0===r)&&(s=o||!1),null!==s&&s!==t)return!1}),null!==s&&s!==t?s:this)},e.expr[":"].jstree=e.expr.createPseudo(function(r){return function(r){return e(r).hasClass("jstree")&&e(r).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1,dblclick_toggle:!0},e.jstree.core.prototype={plugin:function(t,r){var i=e.jstree.plugins[t];return i?(this._data[t]={},i.prototype=this,new i(r,this)):this},init:function(t,r){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=r,this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.settings.core.multiple&&this.element.attr("aria-multiselectable",!0),this.element.attr("tabindex")||this.element.attr("tabindex","0"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children' role='group'><li id='j"+this._id+"_loading' class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='tree-item'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading"),this._data.core.li_height=this.get_container_ul().children("li").first().height()||24,this.trigger("loading"),this.load_node("#")},destroy:function(e){if(this._wrk)try{window.URL.revokeObjectURL(this._wrk),this._wrk=null}catch(t){}e||this.element.empty(),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){var t="",r=null,i=0;this.element.on("dblclick.jstree",function(){if(h.selection&&h.selection.empty)h.selection.empty();else if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(t){}}}).on("mousedown.jstree",e.proxy(function(e){e.target===this.element[0]&&(e.preventDefault(),i=+new Date)},this)).on("mousedown.jstree",".jstree-ocl",function(e){e.preventDefault()}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("dblclick.jstree",".jstree-anchor",e.proxy(function(e){this.settings.core.dblclick_toggle&&this.toggle_node(e.target)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),t.currentTarget!==h.activeElement&&e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if("INPUT"===t.target.tagName)return!0;if(32!==t.which&&13!==t.which&&(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey))return!0;var r=null;switch(this._data.core.rtl&&(37===t.which?t.which=39:39===t.which&&(t.which=37)),t.which){case 32:t.ctrlKey&&(t.type="click",e(t.currentTarget).trigger(t));break;case 13:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(r=this.get_parent(t.currentTarget))&&"#"!==r.id&&this.get_node(r,!0).children(".jstree-anchor").focus();break;case 38:t.preventDefault(),(r=this.get_prev_dom(t.currentTarget))&&r.length&&r.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):this.is_open(t.currentTarget)&&(r=this.get_node(t.currentTarget,!0).children(".jstree-children")[0])&&e(this._firstChild(r)).children(".jstree-anchor").focus();break;case 40:t.preventDefault(),(r=this.get_next_dom(t.currentTarget))&&r.length&&r.children(".jstree-anchor").focus();break;case 106:this.open_all();break;case 36:t.preventDefault(),(r=this._firstChild(this.get_container_ul()[0]))&&e(r).children(".jstree-anchor").filter(":visible").focus();break;case 35:t.preventDefault(),this.element.find(".jstree-anchor").filter(":visible").last().focus()}},this)).on("load_node.jstree",e.proxy(function(t,r){r.status&&("#"!==r.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.trigger("loaded")),this._data.core.ready||setTimeout(e.proxy(function(){if(this.element&&!this.get_container_ul().find(".jstree-loading").length){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var t,r,i=[];for(t=0,r=this._data.core.selected.length;t<r;t++)i=i.concat(this._model.data[this._data.core.selected[t]].parents);for(t=0,r=(i=e.vakata.array_unique(i)).length;t<r;t++)this.open_node(i[t],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}this.trigger("ready")}},this),0))},this)).on("keypress.jstree",e.proxy(function(i){if("INPUT"===i.target.tagName)return!0;r&&clearTimeout(r),r=setTimeout(function(){t=""},500);var n=String.fromCharCode(i.which).toLowerCase(),s=this.element.find(".jstree-anchor").filter(":visible"),o=s.index(h.activeElement)||0,a=!1;if((t+=n).length>1){if(s.slice(o).each(e.proxy(function(r,i){if(0===e(i).text().toLowerCase().indexOf(t))return e(i).focus(),a=!0,!1},this)),a)return;if(s.slice(0,o).each(e.proxy(function(r,i){if(0===e(i).text().toLowerCase().indexOf(t))return e(i).focus(),a=!0,!1},this)),a)return}if(new RegExp("^"+n+"+$").test(t)){if(s.slice(o+1).each(e.proxy(function(t,r){if(e(r).text().toLowerCase().charAt(0)===n)return e(r).focus(),a=!0,!1},this)),a)return;if(s.slice(0,o+1).each(e.proxy(function(t,r){if(e(r).text().toLowerCase().charAt(0)===n)return e(r).focus(),a=!0,!1},this)),a)return}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){this._data.core.focused=null,e(t.currentTarget).filter(".jstree-hovered").mouseleave(),this.element.attr("tabindex","0")},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){var r=this.get_node(t.currentTarget);r&&r.id&&(this._data.core.focused=r.id),this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter(),this.element.attr("tabindex","-1")},this)).on("focus.jstree",e.proxy(function(){if(+new Date-i>500&&!this._data.core.focused){i=0;var e=this.get_node(this.element.attr("aria-activedescendant"),!0);e&&e.find("> .jstree-anchor").focus()}},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(h).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children").first()},get_string:function(t){var r=this.settings.core.strings;return e.isFunction(r)?r.call(this,t):r&&r[t]?r[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,r){var i;t&&t.id&&(t=t.id);try{if(this._model.data[t])t=this._model.data[t];else if("string"==typeof t&&this._model.data[t.replace(/^#/,"")])t=this._model.data[t.replace(/^#/,"")];else if("string"==typeof t&&(i=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length&&this._model.data[i.closest(".jstree-node").attr("id")])t=this._model.data[i.closest(".jstree-node").attr("id")];else if((i=e(t,this.element)).length&&this._model.data[i.closest(".jstree-node").attr("id")])t=this._model.data[i.closest(".jstree-node").attr("id")];else{if(!(i=e(t,this.element)).length||!i.hasClass("jstree"))return!1;t=this._model.data["#"]}return r&&(t="#"===t.id?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(n){return!1}},get_path:function(e,t,r){if(!(e=e.parents?e:this.get_node(e))||"#"===e.id||!e.parents)return!1;var i,n,s=[];for(s.push(r?e.id:e.text),i=0,n=e.parents.length;i<n;i++)s.push(r?e.parents[i]:this.get_text(e.parents[i]));return s=s.reverse().slice(1),t?s.join(t):s},get_next_dom:function(t,r){var i;if((t=this.get_node(t,!0))[0]===this.element[0]){for(i=this._firstChild(this.get_container_ul()[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);return!!i&&e(i)}if(!t||!t.length)return!1;if(r){i=t[0];do{i=this._nextSibling(i)}while(i&&0===i.offsetHeight);return!!i&&e(i)}if(t.hasClass("jstree-open")){for(i=this._firstChild(t.children(".jstree-children")[0]);i&&0===i.offsetHeight;)i=this._nextSibling(i);if(null!==i)return e(i)}i=t[0];do{i=this._nextSibling(i)}while(i&&0===i.offsetHeight);return null!==i?e(i):t.parentsUntil(".jstree",".jstree-node").nextAll(".jstree-node:visible").first()},get_prev_dom:function(t,r){var i;if((t=this.get_node(t,!0))[0]===this.element[0]){for(i=this.get_container_ul()[0].lastChild;i&&0===i.offsetHeight;)i=this._previousSibling(i);return!!i&&e(i)}if(!t||!t.length)return!1;if(r){i=t[0];do{i=this._previousSibling(i)}while(i&&0===i.offsetHeight);return!!i&&e(i)}i=t[0];do{i=this._previousSibling(i)}while(i&&0===i.offsetHeight);if(null!==i){for(t=e(i);t.hasClass("jstree-open");)t=t.children(".jstree-children").first().children(".jstree-node:visible:last");return t}return!(!(i=t[0].parentNode.parentNode)||!i.className||-1===i.className.indexOf("jstree-node"))&&e(i)},get_parent:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.parent},get_children_dom:function(e){return(e=this.get_node(e,!0))[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,r){var i,n,s,o,a;if(e.isArray(t))return this._load_nodes(t.slice(),r),!0;if(!(t=this.get_node(t)))return r&&r.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,i=0,n=t.children_d.length;i<n;i++){for(s=0,o=t.parents.length;s<o;s++)this._model.data[t.parents[s]].children_d=e.vakata.array_remove_item(this._model.data[t.parents[s]].children_d,t.children_d[i]);this._model.data[t.children_d[i]].state.selected&&(a=!0,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.children_d[i])),delete this._model.data[t.children_d[i]]}t.children=[],t.children_d=[],a&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.failed=!1,t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading").attr("aria-busy",!0),this._load_node(t,e.proxy(function(e){(t=this._model.data[t.id]).state.loading=!1,t.state.loaded=e,t.state.failed=!t.state.loaded;var i=this.get_node(t,!0);t.state.loaded&&!t.children.length&&i&&i.length&&!i.hasClass("jstree-leaf")&&i.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),i.removeClass("jstree-loading").attr("aria-busy",!1),this.trigger("load_node",{node:t,status:e}),r&&r.call(this,t,e)},this)),!0},_load_nodes:function(e,t,r){var i,n,s=!0,o=function(){this._load_nodes(e,t,!0)},a=this._model.data,c=[];for(i=0,n=e.length;i<n;i++)!a[e[i]]||(a[e[i]].state.loaded||a[e[i]].state.failed)&&r||(this.is_loading(e[i])||this.load_node(e[i],o),s=!1);if(s){for(i=0,n=e.length;i<n;i++)a[e[i]]&&a[e[i]].state.loaded&&c.push(e[i]);t&&!t.done&&(t.call(this,c),t.done=!0)}},load_all:function(e,t){if(e||(e="#"),!(e=this.get_node(e)))return!1;var r,i,n=[],s=this._model.data,o=s[e.id].children_d;for(e.state&&!e.state.loaded&&n.push(e.id),r=0,i=o.length;r<i;r++)s[o[r]]&&s[o[r]].state&&!s[o[r]].state.loaded&&n.push(o[r]);n.length?this._load_nodes(n,function(){this.load_all(e,t)}):(t&&t.call(this,e),this.trigger("load_all",{node:e}))},_load_node:function(t,r){var i,n=this.settings.core.data;return n?e.isFunction(n)?n.call(this,t,e.proxy(function(i){!1===i&&r.call(this,!1),this["string"==typeof i?"_append_html_data":"_append_json_data"](t,"string"==typeof i?e(e.parseHTML(i)).filter(function(){return 3!==this.nodeType}):i,function(e){r.call(this,e)})},this)):"object"==typeof n?n.url?(n=e.extend(!0,{},n),e.isFunction(n.url)&&(n.url=n.url.call(this,t)),e.isFunction(n.data)&&(n.data=n.data.call(this,t)),e.ajax(n).done(e.proxy(function(i,n,s){var o=s.getResponseHeader("Content-Type");return o&&-1!==o.indexOf("json")||"object"==typeof i?this._append_json_data(t,i,function(e){r.call(this,e)}):o&&-1!==o.indexOf("html")||"string"==typeof i?this._append_html_data(t,e(e.parseHTML(i)).filter(function(){return 3!==this.nodeType}),function(e){r.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:s})},this.settings.core.error.call(this,this._data.core.last_error),r.call(this,!1))},this)).fail(e.proxy(function(e){r.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(i=e.isArray(n)||e.isPlainObject(n)?JSON.parse(JSON.stringify(n)):n,"#"===t.id?this._append_json_data(t,i,function(e){r.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),r.call(this,!1))):"string"==typeof n?"#"===t.id?this._append_html_data(t,e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}),function(e){r.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),r.call(this,!1)):r.call(this,!1):"#"===t.id?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){r.call(this,e)}):r.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,r,i){(t=this.get_node(t)).children=[],t.children_d=[];var n,s,o,a=r.is("ul")?r.children():r,c=t.id,d=[],h=[],l=this._model.data,u=l[c],p=this._data.core.selected.length;for(a.each(e.proxy(function(t,r){(n=this._parse_model_from_html(e(r),c,u.parents.concat()))&&(d.push(n),h.push(n),l[n].children_d.length&&(h=h.concat(l[n].children_d)))},this)),u.children=d,u.children_d=h,s=0,o=u.parents.length;s<o;s++)l[u.parents[s]].children_d=l[u.parents[s]].children_d.concat(h);this.trigger("model",{nodes:h,parent:c}),"#"!==c?(this._node_changed(c),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==p&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)},_append_json_data:function(t,r,i,n){if(null!==this.element){(t=this.get_node(t)).children=[],t.children_d=[],r.d&&"string"==typeof(r=r.d)&&(r=JSON.parse(r)),e.isArray(r)||(r=[r]);var s=null,o={df:this._model.default_state,dat:r,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},a=function(e,t){e.data&&(e=e.data);var r,i,n,s,o=e.dat,a=e.par,c=[],d=[],h=[],l=e.df,u=e.t_id,p=e.t_cnt,f=e.m,_=f[a],g=e.sel,m=function(e,r,i){i=i?i.concat():[],r&&i.unshift(r);var n,s,o,a,c=e.id.toString(),d={id:c,text:e.text||"",icon:e.icon===t||e.icon,parent:r,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in l)l.hasOwnProperty(n)&&(d.state[n]=l[n]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),d.icon!==t&&null!==d.icon&&""!==d.icon||(d.icon=!0),e&&e.data&&(d.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(d.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(d.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(d.li_attr[n]=e.li_attr[n]);if(d.li_attr.id||(d.li_attr.id=c),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(d.a_attr[n]=e.a_attr[n]);for(e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),f[d.id]=d,n=0,s=d.children.length;n<s;n++)o=m(f[d.children[n]],d.id,i),a=f[o],d.children_d.push(o),a.children_d.length&&(d.children_d=d.children_d.concat(a.children_d));return delete e.data,delete e.children,f[d.id].original=e,d.state.selected&&h.push(d.id),d.id},v=function(e,r,i){i=i?i.concat():[],r&&i.unshift(r);var n,s,o,a,c,d=!1;do{d="j"+u+"_"+ ++p}while(f[d]);for(n in c={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:r,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},l)l.hasOwnProperty(n)&&(c.state[n]=l[n]);if(e&&e.id&&(c.id=e.id.toString()),e&&e.text&&(c.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),c.icon!==t&&null!==c.icon&&""!==c.icon||(c.icon=!0),e&&e.data&&(c.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(c.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(c.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(c.li_attr[n]=e.li_attr[n]);if(c.li_attr.id&&!c.id&&(c.id=c.li_attr.id.toString()),c.id||(c.id=d),c.li_attr.id||(c.li_attr.id=c.id),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(c.a_attr[n]=e.a_attr[n]);if(e&&e.children&&e.children.length){for(n=0,s=e.children.length;n<s;n++)o=v(e.children[n],c.id,i),a=f[o],c.children.push(o),a.children_d.length&&(c.children_d=c.children_d.concat(a.children_d));c.children_d=c.children_d.concat(c.children)}return e&&e.children&&!0===e.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]),delete e.data,delete e.children,c.original=e,f[c.id]=c,c.state.selected&&h.push(c.id),c.id};if(o.length&&o[0].id!==t&&o[0].parent!==t){for(i=0,n=o.length;i<n;i++)o[i].children||(o[i].children=[]),f[o[i].id.toString()]=o[i];for(i=0,n=o.length;i<n;i++)f[o[i].parent.toString()].children.push(o[i].id.toString()),_.children_d.push(o[i].id.toString());for(i=0,n=_.children.length;i<n;i++)r=m(f[_.children[i]],a,_.parents.concat()),d.push(r),f[r].children_d.length&&(d=d.concat(f[r].children_d));for(i=0,n=_.parents.length;i<n;i++)f[_.parents[i]].children_d=f[_.parents[i]].children_d.concat(d);s={cnt:p,mod:f,sel:g,par:a,dpc:d,add:h}}else{for(i=0,n=o.length;i<n;i++)(r=v(o[i],a,_.parents.concat()))&&(c.push(r),d.push(r),f[r].children_d.length&&(d=d.concat(f[r].children_d)));for(_.children=c,_.children_d=d,i=0,n=_.parents.length;i<n;i++)f[_.parents[i]].children_d=f[_.parents[i]].children_d.concat(d);s={cnt:p,mod:f,sel:g,par:a,dpc:d,add:h}}if("undefined"!=typeof window&&void 0!==window.document)return s;postMessage(s)},c=function(t,r){if(null!==this.element){if(this._cnt=t.cnt,this._model.data=t.mod,r){var n,s,o=t.add,a=t.sel,c=this._data.core.selected.slice(),d=this._model.data;if(a.length!==c.length||e.vakata.array_unique(a.concat(c)).length!==a.length){for(n=0,s=a.length;n<s;n++)-1===e.inArray(a[n],o)&&-1===e.inArray(a[n],c)&&(d[a[n]].state.selected=!1);for(n=0,s=c.length;n<s;n++)-1===e.inArray(c[n],a)&&(d[c[n]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),"#"!==t.par?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),i.call(this,!0)}};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+a.toString()],{type:"text/javascript"}))),!this._data.core.working||n?(this._data.core.working=!0,(s=new window.Worker(this._wrk)).onmessage=e.proxy(function(e){c.call(this,e.data,!0);try{s.terminate(),s=null}catch(t){}this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1},this),o.par?s.postMessage(o):this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1):this._data.core.worker_queue.push([t,r,i,!0])}catch(d){c.call(this,a(o),!1),this._data.core.worker_queue.length?this._append_json_data.apply(this,this._data.core.worker_queue.shift()):this._data.core.working=!1}else c.call(this,a(o),!1)}},_parse_model_from_html:function(r,i,n){n=n?[].concat(n):[],i&&n.unshift(i);var s,o,a,c,d,h=this._model.data,l={id:!1,text:!1,icon:!0,parent:i,parents:n,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(a in this._model.default_state)this._model.default_state.hasOwnProperty(a)&&(l.state[a]=this._model.default_state[a]);if(c=e.vakata.attributes(r,!0),e.each(c,function(t,r){if(!(r=e.trim(r)).length)return!0;l.li_attr[t]=r,"id"===t&&(l.id=r.toString())}),(c=r.children("a").first()).length&&(c=e.vakata.attributes(c,!0),e.each(c,function(t,r){(r=e.trim(r)).length&&(l.a_attr[t]=r)})),(c=r.children("a").first().length?r.children("a").first().clone():r.clone()).children("ins, i, ul").remove(),c=c.html(),c=e("<div />").html(c),l.text=this.settings.core.force_text?c.text():c.html(),c=r.data(),l.data=c?e.extend(!0,{},c):null,l.state.opened=r.hasClass("jstree-open"),l.state.selected=r.children("a").hasClass("jstree-clicked"),l.state.disabled=r.children("a").hasClass("jstree-disabled"),l.data&&l.data.jstree)for(a in l.data.jstree)l.data.jstree.hasOwnProperty(a)&&(l.state[a]=l.data.jstree[a]);(c=r.children("a").children(".jstree-themeicon")).length&&(l.icon=!c.hasClass("jstree-themeicon-hidden")&&c.attr("rel")),l.state.icon!==t&&(l.icon=l.state.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),c=r.children("ul").children("li");do{d="j"+this._id+"_"+ ++this._cnt}while(h[d]);return l.id=l.li_attr.id?l.li_attr.id.toString():d,c.length?(c.each(e.proxy(function(t,r){s=this._parse_model_from_html(e(r),l.id,n),o=this._model.data[s],l.children.push(s),o.children_d.length&&(l.children_d=l.children_d.concat(o.children_d))},this)),l.children_d=l.children_d.concat(l.children)):r.hasClass("jstree-closed")&&(l.state.loaded=!1),l.li_attr.class&&(l.li_attr.class=l.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),l.a_attr.class&&(l.a_attr.class=l.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),h[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_flat_json:function(e,r,i){i=i?i.concat():[],r&&i.unshift(r);var n,s,o,a,c=e.id.toString(),d=this._model.data,h=this._model.default_state,l={id:c,text:e.text||"",icon:e.icon===t||e.icon,parent:r,parents:i,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in h)h.hasOwnProperty(n)&&(l.state[n]=h[n]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),l.icon!==t&&null!==l.icon&&""!==l.icon||(l.icon=!0),e&&e.data&&(l.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(l.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(l.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(l.li_attr[n]=e.li_attr[n]);if(l.li_attr.id||(l.li_attr.id=c),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(l.a_attr[n]=e.a_attr[n]);for(e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),d[l.id]=l,n=0,s=l.children.length;n<s;n++)a=d[o=this._parse_model_from_flat_json(d[l.children[n]],l.id,i)],l.children_d.push(o),a.children_d.length&&(l.children_d=l.children_d.concat(a.children_d));return delete e.data,delete e.children,d[l.id].original=e,l.state.selected&&this._data.core.selected.push(l.id),l.id},_parse_model_from_json:function(e,r,i){i=i?i.concat():[],r&&i.unshift(r);var n,s,o,a,c,d=!1,h=this._model.data,l=this._model.default_state;do{d="j"+this._id+"_"+ ++this._cnt}while(h[d]);for(n in c={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:r,parents:i,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1},l)l.hasOwnProperty(n)&&(c.state[n]=l[n]);if(e&&e.id&&(c.id=e.id.toString()),e&&e.text&&(c.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(c.icon=e.data.jstree.icon),c.icon!==t&&null!==c.icon&&""!==c.icon||(c.icon=!0),e&&e.data&&(c.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(c.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(c.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(c.li_attr[n]=e.li_attr[n]);if(c.li_attr.id&&!c.id&&(c.id=c.li_attr.id.toString()),c.id||(c.id=d),c.li_attr.id||(c.li_attr.id=c.id),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(c.a_attr[n]=e.a_attr[n]);if(e&&e.children&&e.children.length){for(n=0,s=e.children.length;n<s;n++)a=h[o=this._parse_model_from_json(e.children[n],c.id,i)],c.children.push(o),a.children_d.length&&(c.children_d=c.children_d.concat(a.children_d));c.children_d=c.children_d.concat(c.children)}return e&&e.children&&!0===e.children&&(c.state.loaded=!1,c.children=[],c.children_d=[]),delete e.data,delete e.children,c.original=e,h[c.id]=c,c.state.selected&&this._data.core.selected.push(c.id),c.id},_redraw:function(){var e,t,r,i=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),n=h.createElement("UL"),s=this._data.core.focused;for(t=0,r=i.length;t<r;t++)(e=this.redraw_node(i[t],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&n.appendChild(e);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,n.setAttribute("role","group"),this.element.empty().append(n)),null!==s&&((e=this.get_node(s,!0))&&e.length&&e.children(".jstree-anchor")[0]!==h.activeElement?e.children(".jstree-anchor").focus():this._data.core.focused=null),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:i})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},draw_children:function(e){var t=this.get_node(e),r=!1,i=!1,n=!1,s=h;if(!t)return!1;if("#"===t.id)return this.redraw(!0);if(!(e=this.get_node(e,!0))||!e.length)return!1;if(e.children(".jstree-children").remove(),e=e[0],t.children.length&&t.state.loaded){for((n=s.createElement("UL")).setAttribute("role","group"),n.className="jstree-children",r=0,i=t.children.length;r<i;r++)n.appendChild(this.redraw_node(t.children[r],!0,!0));e.appendChild(n)}},redraw_node:function(t,r,i,n){var s=this.get_node(t),o=!1,a=!1,c=!1,d=!1,u=!1,p=!1,f="",_=h,g=this._model.data,m=!1,v=null,y=0,b=0;if(!s)return!1;if("#"===s.id)return this.redraw(!0);if(r=r||0===s.children.length,t=h.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(s.id[0])?"\\3"+s.id[0]+" "+s.id.substr(1).replace(e.jstree.idregex,"\\$&"):s.id.replace(e.jstree.idregex,"\\$&"))):h.getElementById(s.id))t=e(t),i||((o=t.parent().parent()[0])===this.element[0]&&(o=null),a=t.index()),r||!s.children.length||t.children(".jstree-children").length||(r=!0),r||(c=t.children(".jstree-children")[0]),m=t.children(".jstree-anchor")[0]===h.activeElement,t.remove();else if(r=!0,!i){if(!(null===(o="#"!==s.parent?e("#"+s.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||o&&g[s.parent].state.opened))return!1;a=e.inArray(s.id,null===o?g["#"].children:g[s.parent].children)}for(d in t=l.cloneNode(!0),f="jstree-node ",s.li_attr)if(s.li_attr.hasOwnProperty(d)){if("id"===d)continue;"class"!==d?t.setAttribute(d,s.li_attr[d]):f+=s.li_attr[d]}for(u in s.a_attr.id||(s.a_attr.id=s.id+"_anchor"),t.setAttribute("aria-selected",!!s.state.selected),t.setAttribute("aria-level",s.parents.length),t.setAttribute("aria-labelledby",s.a_attr.id),s.state.disabled&&t.setAttribute("aria-disabled",!0),s.state.loaded&&!s.children.length?f+=" jstree-leaf":(f+=s.state.opened&&s.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",s.state.opened&&s.state.loaded)),null!==s.parent&&g[s.parent].children[g[s.parent].children.length-1]===s.id&&(f+=" jstree-last"),t.id=s.id,t.className=f,f=(s.state.selected?" jstree-clicked":"")+(s.state.disabled?" jstree-disabled":""),s.a_attr)if(s.a_attr.hasOwnProperty(u)){if("href"===u&&"#"===s.a_attr[u])continue;"class"!==u?t.childNodes[1].setAttribute(u,s.a_attr[u]):f+=" "+s.a_attr[u]}if(f.length&&(t.childNodes[1].className="jstree-anchor "+f),(s.icon&&!0!==s.icon||!1===s.icon)&&(!1===s.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===s.icon.indexOf("/")&&-1===s.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+s.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage="url("+s.icon+")",t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(_.createTextNode(s.text)):t.childNodes[1].innerHTML+=s.text,r&&s.children.length&&(s.state.opened||n)&&s.state.loaded){for((p=_.createElement("UL")).setAttribute("role","group"),p.className="jstree-children",d=0,u=s.children.length;d<u;d++)p.appendChild(this.redraw_node(s.children[d],r,!0));t.appendChild(p)}if(c&&t.appendChild(c),!i){for(o||(o=this.element[0]),d=0,u=o.childNodes.length;d<u;d++)if(o.childNodes[d]&&o.childNodes[d].className&&-1!==o.childNodes[d].className.indexOf("jstree-children")){v=o.childNodes[d];break}v||((v=_.createElement("UL")).setAttribute("role","group"),v.className="jstree-children",o.appendChild(v)),a<(o=v).childNodes.length?o.insertBefore(t,o.childNodes[a]):o.appendChild(t),m&&(y=this.element[0].scrollTop,b=this.element[0].scrollLeft,t.childNodes[1].focus(),this.element[0].scrollTop=y,this.element[0].scrollLeft=b)}return s.state.opened&&!s.state.loaded&&(s.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(s.id,!1,0)},this),0)),t},open_node:function(r,i,n){var s,o,a,c;if(e.isArray(r)){for(s=0,o=(r=r.slice()).length;s<o;s++)this.open_node(r[s],i,n);return!0}if(!(r=this.get_node(r))||"#"===r.id)return!1;if(n=n===t?this.settings.core.animation:n,!this.is_closed(r))return i&&i.call(this,r,!1),!1;if(this.is_loaded(r))a=this.get_node(r,!0),c=this,a.length&&(n&&a.children(".jstree-children").length&&a.children(".jstree-children").stop(!0,!0),r.children.length&&!this._firstChild(a.children(".jstree-children")[0])&&this.draw_children(r),n?(this.trigger("before_open",{node:r}),a.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(n,function(){this.style.display="",c.trigger("after_open",{node:r})})):(this.trigger("before_open",{node:r}),a[0].className=a[0].className.replace("jstree-closed","jstree-open"),a[0].setAttribute("aria-expanded",!0))),r.state.opened=!0,i&&i.call(this,r,!0),a.length||this.trigger("before_open",{node:r}),this.trigger("open_node",{node:r}),n&&a.length||this.trigger("after_open",{node:r});else{if(this.is_loading(r))return setTimeout(e.proxy(function(){this.open_node(r,i,n)},this),500);this.load_node(r,function(e,t){return t?this.open_node(e,i,n):!!i&&i.call(this,e,!1)})}},_open_to:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var r,i,n=t.parents;for(r=0,i=n.length;r<i;r+=1)"#"!==r&&this.open_node(n[r],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(r,i){var n,s,o,a;if(e.isArray(r)){for(n=0,s=(r=r.slice()).length;n<s;n++)this.close_node(r[n],i);return!0}return!(!(r=this.get_node(r))||"#"===r.id)&&(!this.is_closed(r)&&(i=i===t?this.settings.core.animation:i,o=this,(a=this.get_node(r,!0)).length&&(i?a.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(i,function(){this.style.display="",a.children(".jstree-children").remove(),o.trigger("after_close",{node:r})}):(a[0].className=a[0].className.replace("jstree-open","jstree-closed"),a.attr("aria-expanded",!1).children(".jstree-children").remove())),r.state.opened=!1,this.trigger("close_node",{node:r}),void(i&&a.length||this.trigger("after_close",{node:r}))))},toggle_node:function(t){var r,i;if(e.isArray(t)){for(r=0,i=(t=t.slice()).length;r<i;r++)this.toggle_node(t[r]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(e,t,r){if(e||(e="#"),!(e=this.get_node(e)))return!1;var i,n,s,o="#"===e.id?this.get_container_ul():this.get_node(e,!0);if(!o.length){for(i=0,n=e.children_d.length;i<n;i++)this.is_closed(this._model.data[e.children_d[i]])&&(this._model.data[e.children_d[i]].state.opened=!0);return this.trigger("open_all",{node:e})}r=r||o,s=this,(o=this.is_closed(e)?o.find(".jstree-closed").addBack():o.find(".jstree-closed")).each(function(){s.open_node(this,function(e,i){i&&this.is_parent(e)&&this.open_all(e,t,r)},t||0)}),0===r.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(r)})},close_all:function(t,r){if(t||(t="#"),!(t=this.get_node(t)))return!1;var i,n,s="#"===t.id?this.get_container_ul():this.get_node(t,!0),o=this;if(!s.length){for(i=0,n=t.children_d.length;i<n;i++)this._model.data[t.children_d[i]].state.opened=!1;return this.trigger("close_all",{node:t})}s=this.is_open(t)?s.find(".jstree-open").addBack():s.find(".jstree-open"),e(s.get().reverse()).each(function(){o.close_node(this,r||0)}),this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var r,i;if(e.isArray(t)){for(r=0,i=(t=t.slice()).length;r<i;r++)this.enable_node(t[r]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled").attr("aria-disabled",!1),this.trigger("enable_node",{node:t})},disable_node:function(t){var r,i;if(e.isArray(t)){for(r=0,i=(t=t.slice()).length;r<i;r++)this.disable_node(t[r]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled").attr("aria-disabled",!0),this.trigger("disable_node",{node:t})},activate_node:function(e,r){if(this.is_disabled(e))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(r.metaKey||r.ctrlKey||r.shiftKey)&&(!r.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(r.shiftKey){var i,n,s=this.get_node(e).id,o=this._data.core.last_clicked.id,a=this.get_node(this._data.core.last_clicked.parent).children,c=!1;for(i=0,n=a.length;i<n;i+=1)a[i]===s&&(c=!c),a[i]===o&&(c=!c),this.is_disabled(a[i])||!c&&a[i]!==s&&a[i]!==o?this.deselect_node(a[i],!0,r):this.select_node(a[i],!0,!1,r);this.trigger("changed",{action:"select_node",node:this.get_node(e),selected:this._data.core.selected,event:r})}else this.is_selected(e)?this.deselect_node(e,!1,r):this.select_node(e,!1,!1,r);else!this.settings.core.multiple&&(r.metaKey||r.ctrlKey||r.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,r):(this.deselect_all(!0),this.select_node(e,!1,!1,r),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),r=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){r.attr("aria-activedescendant",e[0].id)},0)},dehover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||!e.children(".jstree-hovered").length)return!1;e.children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(t,r,i,n){var s,o,a;if(e.isArray(t)){for(o=0,a=(t=t.slice()).length;o<a;o++)this.select_node(t[o],r,i,n);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;s=this.get_node(t,!0),t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),i||(s=this._open_to(t)),s&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:n}),r||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:n}))},deselect_node:function(t,r,i){var n,s,o;if(e.isArray(t)){for(n=0,s=(t=t.slice()).length;n<s;n++)this.deselect_node(t[n],r,i);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;o=this.get_node(t,!0),t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),o.length&&o.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:i}),r||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:i}))},select_all:function(e){var t,r,i=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data["#"].children_d.concat(),t=0,r=this._data.core.selected.length;t<r;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),e||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:i})},deselect_all:function(e){var t,r,i=this._data.core.selected.concat([]);for(t=0,r=this._data.core.selected.length;t<r;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked").parent().attr("aria-selected",!1),this.trigger("deselect_all",{selected:this._data.core.selected,node:i}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:i})},is_selected:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var r,i,n,s,o=this.get_selected(!0),a={};for(r=0,i=o.length;r<i;r++)a[o[r].id]=o[r];for(r=0,i=o.length;r<i;r++)for(n=0,s=o[r].children_d.length;n<s;n++)a[o[r].children_d[n]]&&delete a[o[r].children_d[n]];for(r in o=[],a)a.hasOwnProperty(r)&&o.push(r);return t?e.map(o,e.proxy(function(e){return this.get_node(e)},this)):o},get_bottom_selected:function(t){var r,i,n=this.get_selected(!0),s=[];for(r=0,i=n.length;r<i;r++)n[r].children.length||s.push(n[r].id);return t?e.map(s,e.proxy(function(e){return this.get_node(e)},this)):s},get_state:function(){var e,t={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},selected:[]}};for(e in this._model.data)this._model.data.hasOwnProperty(e)&&"#"!==e&&(this._model.data[e].state.opened&&t.core.open.push(e),this._model.data[e].state.selected&&t.core.selected.push(e));return t},set_state:function(r,i){if(r){if(r.core){var n,s;if(r.core.open)return e.isArray(r.core.open)&&r.core.open.length?this._load_nodes(r.core.open,function(e){this.open_node(e,!1,0),delete r.core.open,this.set_state(r,i)},!0):(delete r.core.open,this.set_state(r,i)),!1;if(r.core.scroll)return r.core.scroll&&r.core.scroll.left!==t&&this.element.scrollLeft(r.core.scroll.left),r.core.scroll&&r.core.scroll.top!==t&&this.element.scrollTop(r.core.scroll.top),delete r.core.scroll,this.set_state(r,i),!1;if(r.core.selected)return n=this,this.deselect_all(),e.each(r.core.selected,function(e,t){n.select_node(t,!1,!0)}),delete r.core.selected,this.set_state(r,i),!1;for(s in r)r.hasOwnProperty(s)&&"core"!==s&&-1===e.inArray(s,this.settings.plugins)&&delete r[s];if(e.isEmptyObject(r.core))return delete r.core,this.set_state(r,i),!1}return!e.isEmptyObject(r)||(r=null,i&&i.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,r){this._data.core.state=!0===r?{}:this.get_state(),r&&e.isFunction(r)&&(this._data.core.state=r.call(this,this._data.core.state)),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var i=this.get_container_ul()[0].className;t||(this.element.html("<ul class='"+i+"' role='group'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last' role='treeitem' id='j"+this._id+"_loading'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.element.attr("aria-activedescendant","j"+this._id+"_loading")),this.load_node("#",function(t,r){r&&(this.get_container_ul()[0].className=i,this._firstChild(this.get_container_ul()[0])&&this.element.attr("aria-activedescendant",this._firstChild(this.get_container_ul()[0]).id),this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var r=[],i=[];this._data.core.selected.concat([]);i.push(t.id),!0===t.state.opened&&r.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){r.push(this.id)}),this._load_nodes(i,e.proxy(function(e){this.open_node(r,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(t,r){if(!(t=this.get_node(t))||"#"===t.id)return!1;var i,n,s=this._model.data;for(r=r.toString(),s[t.parent].children[e.inArray(t.id,s[t.parent].children)]=r,i=0,n=t.parents.length;i<n;i++)s[t.parents[i]].children_d[e.inArray(t.id,s[t.parents[i]].children_d)]=r;for(i=0,n=t.children.length;i<n;i++)s[t.children[i]].parent=r;for(i=0,n=t.children_d.length;i<n;i++)s[t.children_d[i]].parents[e.inArray(t.id,s[t.children_d[i]].parents)]=r;return-1!==(i=e.inArray(t.id,this._data.core.selected))&&(this._data.core.selected[i]=r),(i=this.get_node(t.id,!0))&&(i.attr("id",r).children(".jstree-anchor").attr("id",r+"_anchor").end().attr("aria-labelledby",r+"_anchor"),this.element.attr("aria-activedescendant")===t.id&&this.element.attr("aria-activedescendant",r)),delete s[t.id],t.id=r,t.li_attr.id=r,s[r]=t,!0},get_text:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.text},set_text:function(t,r){var i,n;if(e.isArray(t)){for(i=0,n=(t=t.slice()).length;i<n;i++)this.set_text(t[i],r);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(t.text=r,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:r}),!0)},get_json:function(t,r,i){if(!(t=this.get_node(t||"#")))return!1;r&&r.flat&&!i&&(i=[]);var n,s,o={id:t.id,text:t.text,icon:this.get_icon(t),li_attr:e.extend(!0,{},t.li_attr),a_attr:e.extend(!0,{},t.a_attr),state:{},data:(!r||!r.no_data)&&e.extend(!0,{},t.data)};if(r&&r.flat?o.parent=t.parent:o.children=[],!r||!r.no_state)for(n in t.state)t.state.hasOwnProperty(n)&&(o.state[n]=t.state[n]);if(r&&r.no_id&&(delete o.id,o.li_attr&&o.li_attr.id&&delete o.li_attr.id,o.a_attr&&o.a_attr.id&&delete o.a_attr.id),r&&r.flat&&"#"!==t.id&&i.push(o),!r||!r.no_children)for(n=0,s=t.children.length;n<s;n++)r&&r.flat?this.get_json(t.children[n],r,i):o.children.push(this.get_json(t.children[n],r));return r&&r.flat?i:"#"===t.id?o.children:o},create_node:function(r,i,n,s,o){if(null===r&&(r="#"),!(r=this.get_node(r)))return!1;if(!(n=n===t?"last":n).toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(r))return this.load_node(r,function(){this.create_node(r,i,n,s,!0)});var a,c,d,h;switch(i||(i={text:this.get_string("New node")}),"string"==typeof i&&(i={text:i}),i.text===t&&(i.text=this.get_string("New node")),"#"===r.id&&("before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":a=this.get_node(r.parent),n=e.inArray(r.id,a.children),r=a;break;case"after":a=this.get_node(r.parent),n=e.inArray(r.id,a.children)+1,r=a;break;case"inside":case"first":n=0;break;case"last":n=r.children.length;break;default:n||(n=0)}if(n>r.children.length&&(n=r.children.length),i.id||(i.id=!0),!this.check("create_node",i,r,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===i.id&&delete i.id,!(i=this._parse_model_from_json(i,r.id,r.parents.concat())))return!1;for(a=this.get_node(i),(c=[]).push(i),c=c.concat(a.children_d),this.trigger("model",{nodes:c,parent:r.id}),r.children_d=r.children_d.concat(c),d=0,h=r.parents.length;d<h;d++)this._model.data[r.parents[d]].children_d=this._model.data[r.parents[d]].children_d.concat(c);for(i=a,a=[],d=0,h=r.children.length;d<h;d++)a[d>=n?d+1:d]=r.children[d];return a[n]=i.id,r.children=a,this.redraw_node(r,!0),s&&s.call(this,this.get_node(i)),this.trigger("create_node",{node:this.get_node(i),parent:r.id,position:n}),i.id},rename_node:function(t,r){var i,n,s;if(e.isArray(t)){for(i=0,n=(t=t.slice()).length;i<n;i++)this.rename_node(t[i],r);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(s=t.text,this.check("rename_node",t,this.get_parent(t),r)?(this.set_text(t,r),this.trigger("rename_node",{node:t,text:r,old:s}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var r,i,n,s,o,a,c,d,h,l;if(e.isArray(t)){for(r=0,i=(t=t.slice()).length;r<i;r++)this.delete_node(t[r]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;if(n=this.get_node(t.parent),s=e.inArray(t.id,n.children),l=!1,!this.check("delete_node",t,n,s))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==s&&(n.children=e.vakata.array_remove(n.children,s)),(o=t.children_d.concat([])).push(t.id),d=0,h=o.length;d<h;d++){for(a=0,c=t.parents.length;a<c;a++)-1!==(s=e.inArray(o[d],this._model.data[t.parents[a]].children_d))&&(this._model.data[t.parents[a]].children_d=e.vakata.array_remove(this._model.data[t.parents[a]].children_d,s));this._model.data[o[d]].state.selected&&(l=!0,-1!==(s=e.inArray(o[d],this._data.core.selected))&&(this._data.core.selected=e.vakata.array_remove(this._data.core.selected,s)))}for(this.trigger("delete_node",{node:t,parent:n.id}),l&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:n.id}),d=0,h=o.length;d<h;d++)delete this._model.data[o[d]];return this.redraw_node(n,!0),!0},check:function(t,r,i,n,s){r=r&&r.id?r:this.get_node(r),i=i&&i.id?i:this.get_node(i);var o=t.match(/^move_node|copy_node|create_node$/i)?i:r,a=this.settings.core.check_callback;return"move_node"!==t&&"copy_node"!==t||s&&s.is_multi||r.id!==i.id&&e.inArray(r.id,i.children)!==n&&-1===e.inArray(i.id,r.children_d)?(o&&o.data&&(o=o.data),o&&o.functions&&(!1===o.functions[t]||!0===o.functions[t])?(!1===o.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!r||!r.id)&&r.id,par:!(!i||!i.id)&&i.id})}),o.functions[t]):!(!1===a||e.isFunction(a)&&!1===a.call(this,t,r,i,n,s)||a&&!1===a[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!r||!r.id)&&r.id,par:!(!i||!i.id)&&i.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:n,obj:!(!r||!r.id)&&r.id,par:!(!i||!i.id)&&i.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(r,i,n,s,o,a,c){var d,h,l,u,p,f,_,g,m,v,y,b,x,k;if(i=this.get_node(i),n=n===t?0:n,!i)return!1;if(!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return this.load_node(i,function(){this.move_node(r,i,n,s,!0,!1,c)});if(e.isArray(r)){if(1!==r.length){for(d=0,h=r.length;d<h;d++)(m=this.move_node(r[d],i,n,s,o,!1,c))&&(i=m,n="after");return this.redraw(),!0}r=r[0]}if(!(r=r&&r.id?r:this.get_node(r))||"#"===r.id)return!1;if(l=(r.parent||"#").toString(),p=n.toString().match(/^(before|after)$/)&&"#"!==i.id?this.get_node(i.parent):i,_=!(f=c||(this._model.data[r.id]?this:e.jstree.reference(r.id)))||!f._id||this._id!==f._id,u=f&&f._id&&l&&f._model.data[l]&&f._model.data[l].children?e.inArray(r.id,f._model.data[l].children):-1,f&&f._id&&(r=f._model.data[r.id]),_)return!!(m=this.copy_node(r,i,n,s,o,!1,c))&&(f&&f.delete_node(r),m);switch("#"===i.id&&("before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":n=e.inArray(i.id,p.children);break;case"after":n=e.inArray(i.id,p.children)+1;break;case"inside":case"first":n=0;break;case"last":n=p.children.length;break;default:n||(n=0)}if(n>p.children.length&&(n=p.children.length),!this.check("move_node",r,p,n,{core:!0,origin:c,is_multi:f&&f._id&&f._id!==this._id,is_foreign:!f||!f._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(r.parent===p.id){for(g=p.children.concat(),-1!==(m=e.inArray(r.id,g))&&(g=e.vakata.array_remove(g,m),n>m&&n--),m=[],v=0,y=g.length;v<y;v++)m[v>=n?v+1:v]=g[v];m[n]=r.id,p.children=m,this._node_changed(p.id),this.redraw("#"===p.id)}else{for((m=r.children_d.concat()).push(r.id),v=0,y=r.parents.length;v<y;v++){for(g=[],b=0,x=(k=f._model.data[r.parents[v]].children_d).length;b<x;b++)-1===e.inArray(k[b],m)&&g.push(k[b]);f._model.data[r.parents[v]].children_d=g}for(f._model.data[l].children=e.vakata.array_remove_item(f._model.data[l].children,r.id),v=0,y=p.parents.length;v<y;v++)this._model.data[p.parents[v]].children_d=this._model.data[p.parents[v]].children_d.concat(m);for(g=[],v=0,y=p.children.length;v<y;v++)g[v>=n?v+1:v]=p.children[v];for(g[n]=r.id,p.children=g,p.children_d.push(r.id),p.children_d=p.children_d.concat(r.children_d),r.parent=p.id,(m=p.parents.concat()).unshift(p.id),k=r.parents.length,r.parents=m,m=m.concat(),v=0,y=r.children_d.length;v<y;v++)this._model.data[r.children_d[v]].parents=this._model.data[r.children_d[v]].parents.slice(0,-1*k),Array.prototype.push.apply(this._model.data[r.children_d[v]].parents,m);"#"!==l&&"#"!==p.id||(this._model.force_full_redraw=!0),this._model.force_full_redraw||(this._node_changed(l),this._node_changed(p.id)),a||this.redraw()}return s&&s.call(this,r,p,n),this.trigger("move_node",{node:r,parent:p.id,position:n,old_parent:l,old_position:u,is_multi:f&&f._id&&f._id!==this._id,is_foreign:!f||!f._id,old_instance:f,new_instance:this}),r.id},copy_node:function(r,i,n,s,o,a,c){var d,h,l,u,p,f,_,g,m,v;if(i=this.get_node(i),n=n===t?0:n,!i)return!1;if(!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return this.load_node(i,function(){this.copy_node(r,i,n,s,!0,!1,c)});if(e.isArray(r)){if(1!==r.length){for(d=0,h=r.length;d<h;d++)(u=this.copy_node(r[d],i,n,s,o,!0,c))&&(i=u,n="after");return this.redraw(),!0}r=r[0]}if(!(r=r&&r.id?r:this.get_node(r))||"#"===r.id)return!1;switch(g=(r.parent||"#").toString(),m=n.toString().match(/^(before|after)$/)&&"#"!==i.id?this.get_node(i.parent):i,!(v=c||(this._model.data[r.id]?this:e.jstree.reference(r.id)))||!v._id||this._id!==v._id,v&&v._id&&(r=v._model.data[r.id]),"#"===i.id&&("before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":n=e.inArray(i.id,m.children);break;case"after":n=e.inArray(i.id,m.children)+1;break;case"inside":case"first":n=0;break;case"last":n=m.children.length;break;default:n||(n=0)}if(n>m.children.length&&(n=m.children.length),!this.check("copy_node",r,m,n,{core:!0,origin:c,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(_=v?v.get_json(r,{no_id:!0,no_data:!0,no_state:!0}):r))return!1;if(!0===_.id&&delete _.id,!(_=this._parse_model_from_json(_,m.id,m.parents.concat())))return!1;for(u=this.get_node(_),r&&r.state&&!1===r.state.loaded&&(u.state.loaded=!1),(l=[]).push(_),l=l.concat(u.children_d),this.trigger("model",{nodes:l,parent:m.id}),p=0,f=m.parents.length;p<f;p++)this._model.data[m.parents[p]].children_d=this._model.data[m.parents[p]].children_d.concat(l);for(l=[],p=0,f=m.children.length;p<f;p++)l[p>=n?p+1:p]=m.children[p];return l[n]=u.id,m.children=l,m.children_d.push(u.id),m.children_d=m.children_d.concat(u.children_d),"#"===m.id&&(this._model.force_full_redraw=!0),this._model.force_full_redraw||this._node_changed(m.id),a||this.redraw("#"===m.id),s&&s.call(this,u,m,n),this.trigger("copy_node",{node:u,original:r,parent:m.id,position:n,old_parent:g,old_position:v&&v._id&&g&&v._model.data[g]&&v._model.data[g].children?e.inArray(r.id,v._model.data[g].children):-1,is_multi:v&&v._id&&v._id!==this._id,is_foreign:!v||!v._id,old_instance:v,new_instance:this}),u.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var r,i,n,c=[];for(i=0,n=t.length;i<n;i++)(r=this.get_node(t[i]))&&r.id&&"#"!==r.id&&c.push(r);if(!c.length)return!1;s=c,a=this,o="move_node",this.trigger("cut",{node:t})},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var r,i,n,c=[];for(i=0,n=t.length;i<n;i++)(r=this.get_node(t[i]))&&r.id&&"#"!==r.id&&c.push(r);if(!c.length)return!1;s=c,a=this,o="copy_node",this.trigger("copy",{node:t})},get_buffer:function(){return{mode:o,node:s,inst:a}},can_paste:function(){return!1!==o&&!1!==s},paste:function(e,t){if(!((e=this.get_node(e))&&o&&o.match(/^(copy_node|move_node)$/)&&s))return!1;this[o](s,e,t,!1,!1,!1,a)&&this.trigger("paste",{parent:e.id,node:s,mode:o}),s=!1,o=!1,a=!1},clear_buffer:function(){s=!1,o=!1,a=!1,this.trigger("clear_buffer")},edit:function(t,r,i){var n,s,o,a,c,d,h,l,u;return!!(t=this.get_node(t))&&(!1===this.settings.core.check_callback?(this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1):(u=t,r="string"==typeof r?r:t.text,this.set_text(t,""),t=this._open_to(t),u.text=r,n=this._data.core.rtl,s=this.element.width(),o=t.children(".jstree-anchor"),a=e("<span>"),c=r,d=e("<div />",{css:{position:"absolute",top:"-200px",left:n?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),h=e("<input />",{value:c,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var r,n=a.children(".jstree-rename-input").val(),s=this.settings.core.force_text;""===n&&(n=c),d.remove(),a.replaceWith(o),a.remove(),c=s?c:e("<div></div>").append(e.parseHTML(c)).html(),this.set_text(t,c),(r=!!this.rename_node(t,s?e("<div></div>").text(n).text():e("<div></div>").append(e.parseHTML(n)).html()))||this.set_text(t,c),i&&i.call(this,u,r)},this),keydown:function(e){var t=e.which;27===t&&(this.value=c),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){h.width(Math.min(d.text("pW"+this.value).width(),s))},keypress:function(e){if(13===e.which)return!1}}),l={fontFamily:o.css("fontFamily")||"",fontSize:o.css("fontSize")||"",fontWeight:o.css("fontWeight")||"",fontStyle:o.css("fontStyle")||"",fontStretch:o.css("fontStretch")||"",fontVariant:o.css("fontVariant")||"",letterSpacing:o.css("letterSpacing")||"",wordSpacing:o.css("wordSpacing")||""},a.attr("class",o.attr("class")).append(o.contents().clone()).append(h),o.replaceWith(a),d.css(l),void h.css(l).width(Math.min(d.text("pW"+h[0].value).width(),s))[0].select()))},set_theme:function(t,r){if(!t)return!1;if(!0===r){var i=this.settings.core.themes.dir;i||(i=e.jstree.path+"/themes"),r=i+"/"+t+"/style.css"}r&&-1===e.inArray(r,c)&&(e("head").append('<link rel="stylesheet" href="'+r+'" type="text/css" />'),c.push(r)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(r,i){var n,s,o,a;if(e.isArray(r)){for(n=0,s=(r=r.slice()).length;n<s;n++)this.set_icon(r[n],i);return!0}return!(!(r=this.get_node(r))||"#"===r.id)&&(a=r.icon,r.icon=!0===i||null===i||i===t||""===i||i,o=this.get_node(r,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===i?this.hide_icon(r):!0===i||null===i||i===t||""===i?(o.removeClass("jstree-themeicon-custom "+a).css("background","").removeAttr("rel"),!1===a&&this.show_icon(r)):-1===i.indexOf("/")&&-1===i.indexOf(".")?(o.removeClass(a).css("background",""),o.addClass(i+" jstree-themeicon-custom").attr("rel",i),!1===a&&this.show_icon(r)):(o.removeClass(a).css("background",""),o.addClass("jstree-themeicon-custom").css("background","url('"+i+"') center center no-repeat").attr("rel",i),!1===a&&this.show_icon(r)),!0)},get_icon:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.icon},hide_icon:function(t){var r,i;if(e.isArray(t)){for(r=0,i=(t=t.slice()).length;r<i;r++)this.hide_icon(t[r]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var r,i,n;if(e.isArray(t)){for(r=0,i=(t=t.slice()).length;r<i;r++)this.show_icon(t[r]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(n=this.get_node(t,!0),t.icon=!n.length||n.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),n.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,r){t=e(t)[0];var i=r?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,n){-1===e.inArray(n.name.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==n.value&&""!==e.trim(n.value)&&(r?i[n.name]=n.value:i.push(n.name))}),i},e.vakata.array_unique=function(e){var r,i,n=[],s={};for(r=0,i=e.length;r<i;r++)s[e[r]]===t&&(n.push(e[r]),s[e[r]]=!0);return n},e.vakata.array_remove=function(e,t,r){var i=e.slice((r||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,i),e},e.vakata.array_remove_item=function(t,r){var i=e.inArray(r,t);return-1!==i?e.vakata.array_remove(t,i):t};var u=h.createElement("I");u.className="jstree-icon jstree-checkbox",u.setAttribute("role","presentation"),e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(r,i){this.bind=function(){i.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var r,i,n=this._model.data,s=(n[t.parent],t.nodes);for(r=0,i=s.length;r<i;r++)n[s[r]].state.checked=n[s[r]].original&&n[s[r]].original.state&&n[s[r]].original.state.checked,n[s[r]].state.checked&&this._data.checkbox.selected.push(s[r])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,r){var i,n,s,o,a,c,d=this._model.data,h=d[r.parent],l=r.nodes,u=[],p=this.settings.checkbox.cascade,f=this.settings.checkbox.tie_selection;if(-1!==p.indexOf("down"))if(h.state[f?"selected":"checked"]){for(n=0,s=l.length;n<s;n++)d[l[n]].state[f?"selected":"checked"]=!0;this._data[f?"core":"checkbox"].selected=this._data[f?"core":"checkbox"].selected.concat(l)}else for(n=0,s=l.length;n<s;n++)if(d[l[n]].state[f?"selected":"checked"]){for(o=0,a=d[l[n]].children_d.length;o<a;o++)d[d[l[n]].children_d[o]].state[f?"selected":"checked"]=!0;this._data[f?"core":"checkbox"].selected=this._data[f?"core":"checkbox"].selected.concat(d[l[n]].children_d)}if(-1!==p.indexOf("up")){for(n=0,s=h.children_d.length;n<s;n++)d[h.children_d[n]].children.length||u.push(d[h.children_d[n]].parent);for(o=0,a=(u=e.vakata.array_unique(u)).length;o<a;o++)for(h=d[u[o]];h&&"#"!==h.id;){for(i=0,n=0,s=h.children.length;n<s;n++)i+=d[h.children[n]].state[f?"selected":"checked"];if(i!==s)break;h.state[f?"selected":"checked"]=!0,this._data[f?"core":"checkbox"].selected.push(h.id),(c=this.get_node(h,!0))&&c.length&&c.attr("aria-selected",!0).children(".jstree-anchor").addClass(f?"jstree-clicked":"jstree-checked"),h=this.get_node(h.parent)}}this._data[f?"core":"checkbox"].selected=e.vakata.array_unique(this._data[f?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,r){var i,n,s,o,a=r.node,c=this._model.data,d=this.get_node(a.parent),h=this.get_node(a,!0),l=this.settings.checkbox.cascade,u=this.settings.checkbox.tie_selection;if(-1!==l.indexOf("down"))for(this._data[u?"core":"checkbox"].selected=e.vakata.array_unique(this._data[u?"core":"checkbox"].selected.concat(a.children_d)),i=0,n=a.children_d.length;i<n;i++)(o=c[a.children_d[i]]).state[u?"selected":"checked"]=!0,o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(;d&&"#"!==d.id;){for(s=0,i=0,n=d.children.length;i<n;i++)s+=c[d.children[i]].state[u?"selected":"checked"];if(s!==n)break;d.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(d.id),(o=this.get_node(d,!0))&&o.length&&o.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}-1!==l.indexOf("down")&&h.length&&h.find(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!0)},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(e,t){var r,i,n,s=this.get_node("#"),o=this._model.data;for(r=0,i=s.children_d.length;r<i;r++)(n=o[s.children_d[r]])&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,r){var i,n,s,o=r.node,a=this.get_node(o,!0),c=this.settings.checkbox.cascade,d=this.settings.checkbox.tie_selection;if(o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1),-1!==c.indexOf("down"))for(i=0,n=o.children_d.length;i<n;i++)(s=this._model.data[o.children_d[i]]).state[d?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1);if(-1!==c.indexOf("up"))for(i=0,n=o.parents.length;i<n;i++)(s=this._model.data[o.parents[i]]).state[d?"selected":"checked"]=!1,s&&s.original&&s.original.state&&s.original.state.undetermined&&(s.original.state.undetermined=!1),(s=this.get_node(o.parents[i],!0))&&s.length&&s.attr("aria-selected",!1).children(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked");for(s=[],i=0,n=this._data[d?"core":"checkbox"].selected.length;i<n;i++)-1!==c.indexOf("down")&&-1!==e.inArray(this._data[d?"core":"checkbox"].selected[i],o.children_d)||-1!==c.indexOf("up")&&-1!==e.inArray(this._data[d?"core":"checkbox"].selected[i],o.parents)||s.push(this._data[d?"core":"checkbox"].selected[i]);this._data[d?"core":"checkbox"].selected=e.vakata.array_unique(s),-1!==c.indexOf("down")&&a.length&&a.find(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked").parent().attr("aria-selected",!1)},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(e,t){for(var r,i,n,s,o=this.get_node(t.parent),a=this._model.data,c=this.settings.checkbox.tie_selection;o&&"#"!==o.id;){for(n=0,r=0,i=o.children.length;r<i;r++)n+=a[o.children[r]].state[c?"selected":"checked"];if(n!==i)break;o.state[c?"selected":"checked"]=!0,this._data[c?"core":"checkbox"].selected.push(o.id),(s=this.get_node(o,!0))&&s.length&&s.attr("aria-selected",!0).children(".jstree-anchor").addClass(c?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,r){var i,n,s,o,a,c=r.is_multi,d=r.old_parent,h=this.get_node(r.parent),l=this._model.data,u=this.settings.checkbox.tie_selection;if(!c)for(i=this.get_node(d);i&&"#"!==i.id;){for(n=0,s=0,o=i.children.length;s<o;s++)n+=l[i.children[s]].state[u?"selected":"checked"];if(n!==o)break;i.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(i.id),(a=this.get_node(i,!0))&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),i=this.get_node(i.parent)}for(i=h;i&&"#"!==i.id;){for(n=0,s=0,o=i.children.length;s<o;s++)n+=l[i.children[s]].state[u?"selected":"checked"];if(n===o)i.state[u?"selected":"checked"]||(i.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(i.id),(a=this.get_node(i,!0))&&a.length&&a.attr("aria-selected",!0).children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"));else{if(!i.state[u?"selected":"checked"])break;i.state[u?"selected":"checked"]=!1,this._data[u?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[u?"core":"checkbox"].selected,i.id),(a=this.get_node(i,!0))&&a.length&&a.attr("aria-selected",!1).children(".jstree-anchor").removeClass(u?"jstree-clicked":"jstree-checked")}i=this.get_node(i.parent)}},this))},this._undetermined=function(){if(null!==this.element){var e,r,i,n,s={},o=this._model.data,a=this.settings.checkbox.tie_selection,c=this._data[a?"core":"checkbox"].selected,d=[],h=this;for(e=0,r=c.length;e<r;e++)if(o[c[e]]&&o[c[e]].parents)for(i=0,n=o[c[e]].parents.length;i<n;i++)s[o[c[e]].parents[i]]===t&&"#"!==o[c[e]].parents[i]&&(s[o[c[e]].parents[i]]=!0,d.push(o[c[e]].parents[i]));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var a,c=h.get_node(this);if(c.state.loaded){for(e=0,r=c.children_d.length;e<r;e++)if(!(a=o[c.children_d[e]]).state.loaded&&a.original&&a.original.state&&a.original.state.undetermined&&!0===a.original.state.undetermined)for(s[a.id]===t&&"#"!==a.id&&(s[a.id]=!0,d.push(a.id)),i=0,n=a.parents.length;i<n;i++)s[a.parents[i]]===t&&"#"!==a.parents[i]&&(s[a.parents[i]]=!0,d.push(a.parents[i]))}else if(c.original&&c.original.state&&c.original.state.undetermined&&!0===c.original.state.undetermined)for(s[c.id]===t&&"#"!==c.id&&(s[c.id]=!0,d.push(c.id)),i=0,n=c.parents.length;i<n;i++)s[c.parents[i]]===t&&"#"!==c.parents[i]&&(s[c.parents[i]]=!0,d.push(c.parents[i]))}),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),e=0,r=d.length;e<r;e++)o[d[e]].state[a?"selected":"checked"]||(c=this.get_node(d[e],!0))&&c.length&&c.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")}},this.redraw_node=function(t,r,n,s){if(t=i.redraw_node.apply(this,arguments)){var o,a,c=null;for(o=0,a=t.childNodes.length;o<a;o++)if(t.childNodes[o]&&t.childNodes[o].className&&-1!==t.childNodes[o].className.indexOf("jstree-anchor")){c=t.childNodes[o];break}c&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(c.className+=" jstree-checked"),c.insertBefore(u.cloneNode(!1),c.childNodes[0]))}return n||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var r,i,n=this.settings.checkbox.cascade,s=this.settings.checkbox.tie_selection,o=this._data[s?"core":"checkbox"].selected,a=this._model.data;if(!t||!0===t.state[s?"selected":"checked"]||-1===n.indexOf("undetermined")||-1===n.indexOf("down")&&-1===n.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(r=0,i=t.children_d.length;r<i;r++)if(-1!==e.inArray(t.children_d[r],o)||!a[t.children_d[r]].state.loaded&&a[t.children_d[r]].original.state.undetermined)return!0;return!1},this.activate_node=function(t,r){return this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(r.target).hasClass("jstree-checkbox"))&&(r.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(r.target).hasClass("jstree-checkbox")?i.activate_node.call(this,t,r):!this.is_disabled(t)&&(this.is_checked(t)?this.uncheck_node(t,r):this.check_node(t,r),void this.trigger("activate_node",{node:this.get_node(t)}))},this.check_node=function(t,r){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,r);var i,n,s;if(e.isArray(t)){for(n=0,s=(t=t.slice()).length;n<s;n++)this.check_node(t[n],r);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;i=this.get_node(t,!0),t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),i&&i.length&&i.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:r}))},this.uncheck_node=function(t,r){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,r);var i,n,s;if(e.isArray(t)){for(i=0,n=(t=t.slice()).length;i<n;i++)this.uncheck_node(t[i],r);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;s=this.get_node(t,!0),t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),s.length&&s.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:r}))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var e,t;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data["#"].children_d.concat(),e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,r=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:r})},this.is_checked=function(e){return this.settings.checkbox.tie_selection?this.is_selected(e):!(!(e=this.get_node(e))||"#"===e.id)&&e.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var r,i,n,s,o=this.get_checked(!0),a={};for(r=0,i=o.length;r<i;r++)a[o[r].id]=o[r];for(r=0,i=o.length;r<i;r++)for(n=0,s=o[r].children_d.length;n<s;n++)a[o[r].children_d[n]]&&delete a[o[r].children_d[n]];for(r in o=[],a)a.hasOwnProperty(r)&&o.push(r);return t?e.map(o,e.proxy(function(e){return this.get_node(e)},this)):o},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var r,i,n=this.get_checked(!0),s=[];for(r=0,i=n.length;r<i;r++)n[r].children.length||s.push(n[r].id);return t?e.map(s,e.proxy(function(e){return this.get_node(e)},this)):s},this.load_node=function(t,r){var n,s,o;if(!e.isArray(t)&&!this.settings.checkbox.tie_selection&&(o=this.get_node(t))&&o.state.loaded)for(n=0,s=o.children_d.length;n<s;n++)this._model.data[o.children_d[n]].state.checked&&(!0,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,o.children_d[n]));return i.load_node.apply(this,arguments)},this.get_state=function(){var e=i.get_state.apply(this,arguments);return this.settings.checkbox.tie_selection||(e.checkbox=this._data.checkbox.selected.slice()),e},this.set_state=function(t,r){var n=i.set_state.apply(this,arguments);if(n&&t.checkbox){if(!this.settings.checkbox.tie_selection){this.uncheck_all();var s=this;e.each(t.checkbox,function(e,t){s.check_node(t)})}return delete t.checkbox,this.set_state(t,r),!1}return n}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,r){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var r=e.jstree.reference(t.reference),i=r.get_node(t.reference);r.create_node(i,{},"last",function(e){setTimeout(function(){r.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var r=e.jstree.reference(t.reference),i=r.get_node(t.reference);r.edit(i)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var r=e.jstree.reference(t.reference),i=r.get_node(t.reference);r.is_selected(i)?r.delete_node(r.get_selected()):r.delete_node(i)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var r=e.jstree.reference(t.reference),i=r.get_node(t.reference);r.is_selected(i)?r.cut(r.get_top_selected()):r.cut(i)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var r=e.jstree.reference(t.reference),i=r.get_node(t.reference);r.is_selected(i)?r.copy(r.get_top_selected()):r.copy(i)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var r=e.jstree.reference(t.reference),i=r.get_node(t.reference);r.paste(i)}}}}}}},e.jstree.plugins.contextmenu=function(r,i){this.bind=function(){i.bind.call(this);var t,r,n=0,s=null;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e,t){e.preventDefault(),n=e.ctrlKey?+new Date:0,(t||s)&&(n=+new Date+1e4),s&&clearTimeout(s),this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){this._data.contextmenu.visible&&(!n||+new Date-n>250)&&e.vakata.context.hide(),n=0},this)).on("touchstart.jstree",".jstree-anchor",function(i){i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(t=i.pageX,r=i.pageY,s=setTimeout(function(){e(i.currentTarget).trigger("contextmenu",!0)},750))}).on("touchmove.vakata.jstree",function(e){s&&e.originalEvent&&e.originalEvent.changedTouches&&e.originalEvent.changedTouches[0]&&(Math.abs(t-e.pageX)>50||Math.abs(r-e.pageY)>50)&&clearTimeout(s)}).on("touchend.vakata.jstree",function(e){s&&clearTimeout(s)}),e(h).on("context_hide.vakata.jstree",e.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),i.teardown.call(this)},this.show_contextmenu=function(r,i,n,s){if(!(r=this.get_node(r))||"#"===r.id)return!1;var o=this.settings.contextmenu,a=this.get_node(r,!0).children(".jstree-anchor"),c=!1,d=!1;(o.show_at_node||i===t||n===t)&&(c=a.offset(),i=c.left,n=c.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(r)&&this.activate_node(r,s),d=o.items,e.isFunction(d)&&(d=d.call(this,r,e.proxy(function(e){this._show_contextmenu(r,i,n,e)},this))),e.isPlainObject(d)&&this._show_contextmenu(r,i,n,d)},this._show_contextmenu=function(t,r,i,n){var s=this.get_node(t,!0).children(".jstree-anchor");e(h).one("context_show.vakata.jstree",e.proxy(function(t,r){var i="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(r.element).addClass(i)},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(s,{x:r,y:i},n),this.trigger("show_contextmenu",{node:t,x:r,y:i})}},function(e){var t=!1,r={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(h).triggerHandler("context_"+t+".vakata",{reference:r.reference,element:r.element,position:{x:r.position_x,y:r.position_y}})},_execute:function(t){return!(!(t=r.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:r.reference,element:r.element}))||!t.action)&&t.action.call(null,{item:t,reference:r.reference,element:r.element,position:{x:r.position_x,y:r.position_y}})},_parse:function(t,i){if(!t)return!1;i||(r.html="",r.items=[]);var n,s="",o=!1;return i&&(s+="<ul>"),e.each(t,function(t,i){if(!i)return!0;r.items.push(i),!o&&i.separator_before&&(s+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),o=!1,s+="<li class='"+(i._class||"")+(!0===i._disabled||e.isFunction(i._disabled)&&i._disabled({item:i,reference:r.reference,element:r.element})?" vakata-contextmenu-disabled ":"")+"' "+(i.shortcut?" data-shortcut='"+i.shortcut+"' ":"")+">",s+="<a href='#' rel='"+(r.items.length-1)+"'>",e.vakata.context.settings.icons&&(s+="<i ",i.icon&&(-1!==i.icon.indexOf("/")||-1!==i.icon.indexOf(".")?s+=" style='background:url(\""+i.icon+"\") center center no-repeat' ":s+=" class='"+i.icon+"' "),s+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),s+=(e.isFunction(i.label)?i.label({item:t,reference:r.reference,element:r.element}):i.label)+(i.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+i.shortcut+'">'+(i.shortcut_label||"")+"</span>":"")+"</a>",i.submenu&&(n=e.vakata.context._parse(i.submenu,!0))&&(s+=n),s+="</li>",i.separator_after&&(s+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",o=!0)}),s=s.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),i&&(s+="</ul>"),i||(r.html=s,e.vakata.context._trigger("parse")),s.length>10&&s},_show_submenu:function(r){if((r=e(r)).length&&r.children("ul").length){var i=r.children("ul"),n=r.offset().left+r.outerWidth(),s=r.offset().top,o=i.width(),a=i.height(),c=e(window).width()+e(window).scrollLeft(),d=e(window).height()+e(window).scrollTop();t?r[n-(o+10+r.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):r[n+o+10>c?"addClass":"removeClass"]("vakata-context-right"),s+a+10>d&&i.css("bottom","-1px"),i.show()}},show:function(i,n,s){var o,a,c,d,h,l,u,p,f=!0;switch(r.element&&r.element.length&&r.element.width(""),f){case!n&&!i:return!1;case!!n&&!!i:r.reference=i,r.position_x=n.x,r.position_y=n.y;break;case!n&&!!i:r.reference=i,o=i.offset(),r.position_x=o.left+i.outerHeight(),r.position_y=o.top;break;case!!n&&!i:r.position_x=n.x,r.position_y=n.y}i&&!s&&e(i).data("vakata_contextmenu")&&(s=e(i).data("vakata_contextmenu")),e.vakata.context._parse(s)&&r.element.html(r.html),r.items.length&&(r.element.appendTo("body"),a=r.element,c=r.position_x,d=r.position_y,h=a.width(),l=a.height(),u=e(window).width()+e(window).scrollLeft(),p=e(window).height()+e(window).scrollTop(),t&&(c-=a.outerWidth()-e(i).outerWidth())<e(window).scrollLeft()+20&&(c=e(window).scrollLeft()+20),c+h+20>u&&(c=u-(h+20)),d+l+20>p&&(d=p-(l+20)),r.element.css({left:c,top:d}).show().find("a").first().focus().parent().addClass("vakata-context-hover"),r.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){r.is_visible&&(r.element.hide().find("ul").hide().end().find(":focus").blur().end().detach(),r.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var i=!1;r.element=e("<ul class='vakata-context'></ul>"),r.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(i&&clearTimeout(i),r.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(i=setTimeout(function(){e.vakata.context.hide()},e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var i=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:r.is_visible&&(r.element.find(".vakata-context-hover").last().closest("li").first().find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:r.is_visible&&((i=r.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first()).length||(i=r.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),i.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:r.is_visible&&(r.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:r.is_visible&&((i=r.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first()).length||(i=r.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),i.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=r.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.click()}),e(h).on("mousedown.vakata.jstree",function(t){r.is_visible&&!e.contains(r.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata.jstree",function(e,i){r.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&r.element.addClass("vakata-context-rtl").css("direction","rtl"),r.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0,drag_selection:!0,touch:!0,large_drop_target:!1,large_drag_target:!1},e.jstree.plugins.dnd=function(t,r){this.bind=function(){r.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",this.settings.dnd.large_drag_target?".jstree-node":".jstree-anchor",e.proxy(function(t){if(this.settings.dnd.large_drag_target&&e(t.target).closest(".jstree-node")[0]!==t.currentTarget)return!0;if("touchstart"===t.type&&(!this.settings.dnd.touch||"selected"===this.settings.dnd.touch&&!e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").hasClass("jstree-clicked")))return!0;var r=this.get_node(t.target),i=this.is_selected(r)&&this.settings.dnd.drag_selection?this.get_top_selected().length:1,n=i>1?i+" "+this.get_string("nodes"):this.get_text(t.currentTarget);return this.settings.core.force_text&&(n=e.vakata.html.escape(n)),r&&r.id&&"#"!==r.id&&(1===t.which||"touchstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,i>1?this.get_top_selected(!0):[r]))?(this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,{jstree:!0,origin:this,obj:this.get_node(r,!0),nodes:i>1?this.get_top_selected():[r.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+" jstree-"+this.get_theme()+"-"+this.get_theme_variant()+" "+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+n+'<ins class="jstree-copy" style="display:none;">+</ins></div>')):void 0},this))}},e(function(){var t=!1,r=!1,i=!1,n=e('<div id="jstree-marker">&#160;</div>').hide();e(h).on("dnd_start.vakata.jstree",function(e,r){t=!1,r&&r.data&&r.data.jstree&&n.appendTo("body")}).on("dnd_move.vakata.jstree",function(s,o){if(i&&clearTimeout(i),o&&o.data&&o.data.jstree&&(!o.event.target.id||"jstree-marker"!==o.event.target.id)){var a,c,d,h,l,u,p,f,_,g,m,v,y,b,x=e.jstree.reference(o.event.target),k=!1,w=!1,j=!1;if(x&&x._data&&x._data.dnd)if(n.attr("class","jstree-"+x.get_theme()+(x.settings.core.themes.responsive?" jstree-dnd-responsive":"")),o.helper.children().attr("class","jstree-"+x.get_theme()+" jstree-"+x.get_theme()+"-"+x.get_theme_variant()+" "+(x.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy").first()[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"show":"hide"](),o.event.target!==x.element[0]&&o.event.target!==x.get_container_ul()[0]||0!==x.get_container_ul().children().length){if((k=x.settings.dnd.large_drop_target?e(o.event.target).closest(".jstree-node").children(".jstree-anchor"):e(o.event.target).closest(".jstree-anchor"))&&k.length&&k.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(w=k.offset(),j=o.event.pageY-w.top,d=k.outerHeight(),u=j<d/3?["b","i","a"]:j>d-d/3?["a","i","b"]:j>d/2?["i","a","b"]:["i","b","a"],e.each(u,function(s,j){switch(j){case"b":a=w.left-6,c=w.top,h=x.get_parent(k),l=k.parent().index();break;case"i":y=x.settings.dnd.inside_pos,b=x.get_node(k.parent()),a=w.left-2,c=w.top+d/2+1,h=b.id,l="first"===y?0:"last"===y?b.children.length:Math.min(y,b.children.length);break;case"a":a=w.left-6,c=w.top+d,h=x.get_parent(k),l=k.parent().index()+1}for(p=!0,f=0,_=o.data.nodes.length;f<_;f++)if(g=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",m=l,"move_node"===g&&"a"===j&&o.data.origin&&o.data.origin===x&&h===x.get_parent(o.data.nodes[f])&&(v=x.get_node(h),m>e.inArray(o.data.nodes[f],v.children)&&(m-=1)),!(p=p&&(x&&x.settings&&x.settings.dnd&&!1===x.settings.dnd.check_while_dragging||x.check(g,o.data.origin&&o.data.origin!==x?o.data.origin.get_node(o.data.nodes[f]):o.data.nodes[f],h,m,{dnd:!0,ref:x.get_node(k.parent()),pos:j,origin:o.data.origin,is_multi:o.data.origin&&o.data.origin!==x,is_foreign:!o.data.origin})))){x&&x.last_error&&(r=x.last_error());break}var C,E;if("i"===j&&k.parent().is(".jstree-closed")&&x.settings.dnd.open_timeout&&(i=setTimeout((C=x,E=k,function(){C.open_node(E)}),x.settings.dnd.open_timeout)),p)return t={ins:x,par:h,pos:"i"!==j||"last"!==y||0!==l||x.is_loaded(b)?l:"last"},n.css({left:a+"px",top:c+"px"}).show(),o.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok"),r={},u=!0,!1}),!0===u))return}else{for(p=!0,f=0,_=o.data.nodes.length;f<_&&(p=p&&x.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==x?o.data.origin.get_node(o.data.nodes[f]):o.data.nodes[f],"#","last",{dnd:!0,ref:x.get_node("#"),pos:"i",origin:o.data.origin,is_multi:o.data.origin&&o.data.origin!==x,is_foreign:!o.data.origin}));f++);if(p)return t={ins:x,par:"#",pos:"last"},n.hide(),void o.helper.find(".jstree-icon").first().removeClass("jstree-er").addClass("jstree-ok")}t=!1,o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),n.hide()}}).on("dnd_scroll.vakata.jstree",function(e,r){r&&r.data&&r.data.jstree&&(n.hide(),t=!1,r.helper.find(".jstree-icon").first().removeClass("jstree-ok").addClass("jstree-er"))}).on("dnd_stop.vakata.jstree",function(s,o){if(i&&clearTimeout(i),o&&o.data&&o.data.jstree){n.hide().detach();var a,c,d=[];if(t){for(a=0,c=o.data.nodes.length;a<c;a++)d[a]=o.data.origin?o.data.origin.get_node(o.data.nodes[a]):o.data.nodes[a];t.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](d,t.par,t.pos,!1,!1,!1,o.data.origin)}else(a=e(o.event.target).closest(".jstree")).length&&r&&r.error&&"check"===r.error&&(a=a.jstree(!0))&&a.settings.core.error.call(this,r)}}).on("keyup.jstree keydown.jstree",function(t,r){(r=e.vakata.dnd._get())&&r.data&&r.data.jstree&&r.helper.find(".jstree-copy").first()[r.data.origin&&(r.data.origin.settings.dnd.always_copy||r.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"]()})}),function(e){e.vakata.html={div:e("<div />"),escape:function(t){return e.vakata.html.div.text(t).html()},strip:function(t){return e.vakata.html.div.empty().append(e.parseHTML(t)).text()}};var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,r){var i=e.vakata.dnd._get();i.event=r,e(h).triggerHandler("dnd_"+t+".vakata",i)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove(),t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(h).off("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(h).off("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop)},_scroll:function(r){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1;if(!t.scroll_i)return t.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===r)return!1;var i=t.scroll_e.scrollTop(),n=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(i+t.scroll_t*e.vakata.dnd.settings.scroll_speed),t.scroll_e.scrollLeft(n+t.scroll_l*e.vakata.dnd.settings.scroll_speed),i===t.scroll_e.scrollTop()&&n===t.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(r,i,n){"touchstart"===r.type&&r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(r.pageX=r.originalEvent.changedTouches[0].pageX,r.pageY=r.originalEvent.changedTouches[0].pageY,r.target=h.elementFromPoint(r.originalEvent.changedTouches[0].pageX-window.pageXOffset,r.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag&&e.vakata.dnd.stop({});try{r.currentTarget.unselectable="on",r.currentTarget.onselectstart=function(){return!1},r.currentTarget.style&&(r.currentTarget.style.MozUserSelect="none")}catch(s){}return t.init_x=r.pageX,t.init_y=r.pageY,t.data=i,t.is_down=!0,t.element=r.currentTarget,t.target=r.target,t.is_touch="touchstart"===r.type,!1!==n&&(t.helper=e("<div id='vakata-dnd'></div>").html(n).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(h).on("mousemove.vakata.jstree touchmove.vakata.jstree",e.vakata.dnd.drag),e(h).on("mouseup.vakata.jstree touchend.vakata.jstree",e.vakata.dnd.stop),!1},drag:function(r){if("touchmove"===r.type&&r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(r.pageX=r.originalEvent.changedTouches[0].pageX,r.pageY=r.originalEvent.changedTouches[0].pageY,r.target=h.elementFromPoint(r.originalEvent.changedTouches[0].pageX-window.pageXOffset,r.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_down){if(!t.is_drag){if(!(Math.abs(r.pageX-t.init_x)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(r.pageY-t.init_y)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;t.helper&&(t.helper.appendTo("body"),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,e.vakata.dnd._trigger("start",r)}var i=!1,n=!1,s=!1,o=!1,a=!1,c=!1,d=!1,l=!1,u=!1,p=!1;return t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,e(e(r.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var i=e(this),n=i.offset();if(this.scrollHeight>this.offsetHeight&&(n.top+i.height()-r.pageY<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),r.pageY-n.top<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(n.left+i.width()-r.pageX<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),r.pageX-n.left<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1)),t.scroll_t||t.scroll_l)return t.scroll_e=e(this),!1}),t.scroll_e||(i=e(h),n=e(window),s=i.height(),o=n.height(),a=i.width(),c=n.width(),d=i.scrollTop(),l=i.scrollLeft(),s>o&&r.pageY-d<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),s>o&&o-(r.pageY-d)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),a>c&&r.pageX-l<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),a>c&&c-(r.pageX-l)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),(t.scroll_t||t.scroll_l)&&(t.scroll_e=i)),t.scroll_e&&e.vakata.dnd._scroll(!0),t.helper&&(u=parseInt(r.pageY+e.vakata.dnd.settings.helper_top,10),p=parseInt(r.pageX+e.vakata.dnd.settings.helper_left,10),s&&u+25>s&&(u=s-50),a&&p+t.helper_w>a&&(p=a-(t.helper_w+2)),t.helper.css({left:p+"px",top:u+"px"})),e.vakata.dnd._trigger("move",r),!1}},stop:function(r){if("touchend"===r.type&&r.originalEvent&&r.originalEvent.changedTouches&&r.originalEvent.changedTouches[0]&&(r.pageX=r.originalEvent.changedTouches[0].pageX,r.pageY=r.originalEvent.changedTouches[0].pageY,r.target=h.elementFromPoint(r.originalEvent.changedTouches[0].pageX-window.pageXOffset,r.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag)e.vakata.dnd._trigger("stop",r);else if("touchend"===r.type&&r.target===t.target){var i=setTimeout(function(){e(r.target).click()},100);e(r.target).one("click",function(){i&&clearTimeout(i)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.massload=null,e.jstree.plugins.massload=function(t,r){this.init=function(e,t){r.init.call(this,e,t),this._data.massload={}},this._load_nodes=function(t,i,n){var s=this.settings.massload;return n&&!e.isEmptyObject(this._data.massload)?r._load_nodes.call(this,t,i,n):e.isFunction(s)?s.call(this,t,e.proxy(function(e){if(e)for(var s in e)e.hasOwnProperty(s)&&(this._data.massload[s]=e[s]);r._load_nodes.call(this,t,i,n)},this)):"object"==typeof s&&s&&s.url?(s=e.extend(!0,{},s),e.isFunction(s.url)&&(s.url=s.url.call(this,t)),e.isFunction(s.data)&&(s.data=s.data.call(this,t)),e.ajax(s).done(e.proxy(function(e,s,o){if(e)for(var a in e)e.hasOwnProperty(a)&&(this._data.massload[a]=e[a]);r._load_nodes.call(this,t,i,n)},this)).fail(e.proxy(function(e){r._load_nodes.call(this,t,i,n)},this))):r._load_nodes.call(this,t,i,n)},this._load_node=function(t,i){var n=this._data.massload[t.id];return n?this["string"==typeof n?"_append_html_data":"_append_json_data"](t,"string"==typeof n?e(e.parseHTML(n)).filter(function(){return 3!==this.nodeType}):n,function(e){i.call(this,e),delete this._data.massload[t.id]}):r._load_node.call(this,t,i)}},e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,show_only_matches_children:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(r,i){this.bind=function(){i.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=!1,this._data.search.smc=!1,this.element.on("before_open.jstree",e.proxy(function(t,r){var i,n,s=this._data.search.res,o=[],a=e();if(s&&s.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(s,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this._data.search.som&&this._data.search.res.length)){for(i=0,n=s.length;i<n;i++)o=o.concat(this.get_node(s[i]).parents);a=(o=e.vakata.array_remove_item(e.vakata.array_unique(o),"#")).length?e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))):e(),this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),a=a.add(this._data.search.dom),this._data.search.smc&&this._data.search.dom.children(".jstree-children").find(".jstree-node").show(),a.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)).on("search.jstree",e.proxy(function(t,r){this._data.search.som&&r.nodes.length&&(this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),this._data.search.smc&&r.nodes.children(".jstree-children").find(".jstree-node").show(),r.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))},this)).on("clear_search.jstree",e.proxy(function(e,t){this._data.search.som&&t.nodes.length&&this.element.find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")},this))},this.search=function(r,i,n,s,o,a){if(!1===r||""===e.trim(r.toString()))return this.clear_search();s=(s=this.get_node(s))&&s.id?s.id:null,r=r.toString();var c=this.settings.search,d=!!c.ajax&&c.ajax,h=this._model.data,l=null,u=[],p=[];if(this._data.search.res.length&&!o&&this.clear_search(),n===t&&(n=c.show_only_matches),a===t&&(a=c.show_only_matches_children),!i&&!1!==d)return e.isFunction(d)?d.call(this,r,e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(r,!0,n,s,o)},!0)},this),s):((d=e.extend({},d)).data||(d.data={}),d.data.str=r,s&&(d.data.inside=s),e.ajax(d).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(d)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(t){t&&t.d&&(t=t.d),this._load_nodes(e.isArray(t)?e.vakata.array_unique(t):[],function(){this.search(r,!0,n,s,o)},!0)},this)));o||(this._data.search.str=r,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this._data.search.som=n,this._data.search.smc=a),l=new e.vakata.search(r,!0,{caseSensitive:c.case_sensitive,fuzzy:c.fuzzy}),e.each(h[s||"#"].children_d,function(e,t){var i=h[t];i.text&&(c.search_callback&&c.search_callback.call(this,r,i)||!c.search_callback&&l.search(i.text).isMatch)&&(!c.search_leaves_only||i.state.loaded&&0===i.children.length)&&(u.push(t),p=p.concat(i.parents))}),u.length&&(p=e.vakata.array_unique(p),this._search_open(p),o?(this._data.search.dom=this._data.search.dom.add(e(this.element[0].querySelectorAll("#"+e.map(u,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #")))),this._data.search.res=e.vakata.array_unique(this._data.search.res.concat(u))):(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(u,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=u),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")),this.trigger("search",{nodes:this._data.search.dom,str:r,res:this._data.search.res,show_only_matches:n})},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this._search_open=function(t){var r=this;e.each(t.concat([]),function(i,n){if("#"===n)return!0;try{n=e("#"+n.replace(e.jstree.idregex,"\\$&"),r.element)}catch(s){}n&&n.length&&r.is_closed(n)&&(r._data.search.opn.push(n[0].id),r.open_node(n,function(){r._search_open(t)},0))})}},function(e){e.vakata.search=function(t,r,i){i=i||{},!1!==(i=e.extend({},e.vakata.search.defaults,i)).fuzzy&&(i.fuzzy=!0),t=i.caseSensitive?t:t.toLowerCase();var n,s,o,a,c=i.location,d=i.distance,h=i.threshold,l=t.length;return l>32&&(i.fuzzy=!1),i.fuzzy&&(n=1<<l-1,s=function(){var e={},r=0;for(r=0;r<l;r++)e[t.charAt(r)]=0;for(r=0;r<l;r++)e[t.charAt(r)]|=1<<l-r-1;return e}(),o=function(e,t){var r=e/l,i=Math.abs(c-t);return d?r+i/d:i?1:r}),a=function(e){if(e=i.caseSensitive?e:e.toLowerCase(),t===e||-1!==e.indexOf(t))return{isMatch:!0,score:0};if(!i.fuzzy)return{isMatch:!1,score:1};var r,a,d,u,p,f,_,g,m,v=e.length,y=h,b=e.indexOf(t,c),x=l+v,k=1,w=[];for(-1!==b&&(y=Math.min(o(0,b),y),-1!==(b=e.lastIndexOf(t,c+l))&&(y=Math.min(o(0,b),y))),b=-1,r=0;r<l;r++){for(d=0,u=x;d<u;)o(r,c+u)<=y?d=u:x=u,u=Math.floor((x-d)/2+d);for(x=u,f=Math.max(1,c-u+1),_=Math.min(c+u,v)+l,(g=new Array(_+2))[_+1]=(1<<r)-1,a=_;a>=f;a--)if(m=s[e.charAt(a-1)],g[a]=0===r?(g[a+1]<<1|1)&m:(g[a+1]<<1|1)&m|(p[a+1]|p[a])<<1|1|p[a+1],g[a]&n&&(k=o(r,a-1))<=y){if(y=k,b=a-1,w.push(b),!(b>c))break;f=Math.max(1,2*c-b)}if(o(r+1,c)>y)break;p=g}return{isMatch:b>=0,score:k}},!0===r?{search:a}:a(r)},e.vakata.search.defaults={location:0,distance:100,threshold:.6,fuzzy:!1,caseSensitive:!1}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,r){this.bind=function(){r.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,r){var i,n;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),r))for(i=0,n=t.children_d.length;i<n;i++)this.sort(t.children_d[i],!1)}};var p=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree check_node.jstree uncheck_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,r){this.bind=function(){r.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){p&&clearTimeout(p),p=setTimeout(e.proxy(function(){this.save_state()},this),100)},this)),this.trigger("state_ready")},this);this.element.on("ready.jstree",e.proxy(function(e,r){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(r){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(r,i){i.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"#":{},default:{}},e.jstree.plugins.types=function(r,i){this.init=function(e,r){var n,s;if(r&&r.types&&r.types.default)for(n in r.types)if("default"!==n&&"#"!==n&&r.types.hasOwnProperty(n))for(s in r.types.default)r.types.default.hasOwnProperty(s)&&r.types[n][s]===t&&(r.types[n][s]=r.types.default[s]);i.init.call(this,e,r),this._model.data["#"].type="#"},this.refresh=function(e,t){i.refresh.call(this,e,t),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",e.proxy(function(e,r){var i,n,s=this._model.data,o=r.nodes,a=this.settings.types,c="default";for(i=0,n=o.length;i<n;i++)c="default",s[o[i]].original&&s[o[i]].original.type&&a[s[o[i]].original.type]&&(c=s[o[i]].original.type),s[o[i]].data&&s[o[i]].data.jstree&&s[o[i]].data.jstree.type&&a[s[o[i]].data.jstree.type]&&(c=s[o[i]].data.jstree.type),s[o[i]].type=c,!0===s[o[i]].icon&&a[c].icon!==t&&(s[o[i]].icon=a[c].icon);s["#"].type="#"},this)),i.bind.call(this)},this.get_json=function(t,r,n){var s,o,a=this._model.data,c=r?e.extend(!0,{},r,{no_id:!1}):{},d=i.get_json.call(this,t,c,n);if(!1===d)return!1;if(e.isArray(d))for(s=0,o=d.length;s<o;s++)d[s].type=d[s].id&&a[d[s].id]&&a[d[s].id].type?a[d[s].id].type:"default",r&&r.no_id&&(delete d[s].id,d[s].li_attr&&d[s].li_attr.id&&delete d[s].li_attr.id,d[s].a_attr&&d[s].a_attr.id&&delete d[s].a_attr.id);else d.type=d.id&&a[d.id]&&a[d.id].type?a[d.id].type:"default",r&&r.no_id&&(d=this._delete_ids(d));return d},this._delete_ids=function(t){if(e.isArray(t)){for(var r=0,i=t.length;r<i;r++)t[r]=this._delete_ids(t[r]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.a_attr&&t.a_attr.id&&delete t.a_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(r,n,s,o,a){if(!1===i.check.call(this,r,n,s,o,a))return!1;n=n&&n.id?n:this.get_node(n),s=s&&s.id?s:this.get_node(s);var c,d,h,l,u=n&&n.id?a&&a.origin?a.origin:e.jstree.reference(n.id):null;switch(u=u&&u._model&&u._model.data?u._model.data:null,r){case"create_node":case"move_node":case"copy_node":if("move_node"!==r||-1===e.inArray(n.id,s.children)){if((c=this.get_rules(s)).max_children!==t&&-1!==c.max_children&&c.max_children===s.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+r,data:JSON.stringify({chk:r,pos:o,obj:!(!n||!n.id)&&n.id,par:!(!s||!s.id)&&s.id})},!1;if(c.valid_children!==t&&-1!==c.valid_children&&-1===e.inArray(n.type||"default",c.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+r,data:JSON.stringify({chk:r,pos:o,obj:!(!n||!n.id)&&n.id,par:!(!s||!s.id)&&s.id})},!1;if(u&&n.children_d&&n.parents){for(d=0,h=0,l=n.children_d.length;h<l;h++)d=Math.max(d,u[n.children_d[h]].parents.length);d=d-n.parents.length+1}(d<=0||d===t)&&(d=1);do{if(c.max_depth!==t&&-1!==c.max_depth&&c.max_depth<d)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+r,data:JSON.stringify({chk:r,pos:o,obj:!(!n||!n.id)&&n.id,par:!(!s||!s.id)&&s.id})},!1;s=this.get_node(s.parent),c=this.get_rules(s),d++}while(s)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var r=this.get_type(e,!0);return r.max_depth===t&&(r.max_depth=-1),r.max_children===t&&(r.max_children=-1),r.valid_children===t&&(r.valid_children=-1),r},this.get_type=function(t,r){return!!(t=this.get_node(t))&&(r?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(r,i){var n,s,o,a,c;if(e.isArray(r)){for(s=0,o=(r=r.slice()).length;s<o;s++)this.set_type(r[s],i);return!0}return n=this.settings.types,r=this.get_node(r),!(!n[i]||!r)&&(a=r.type,c=this.get_icon(r),r.type=i,(!0===c||n[a]&&n[a].icon!==t&&c===n[a].icon)&&this.set_icon(r,n[i].icon===t||n[i].icon),!0)}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(r,i){this.check=function(t,r,n,s,o){if(!1===i.check.call(this,t,r,n,s,o))return!1;if(r=r&&r.id?r:this.get_node(r),!(n=n&&n.id?n:this.get_node(n))||!n.children)return!0;var a,c,d="rename_node"===t?s:r.text,h=[],l=this.settings.unique.case_sensitive,u=this._model.data;for(a=0,c=n.children.length;a<c;a++)h.push(l?u[n.children[a]].text:u[n.children[a]].text.toLowerCase());switch(l||(d=d.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return(a=-1===e.inArray(d,h)||r.text&&r.text[l?"toString":"toLowerCase"]()===d)||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!r||!r.id)&&r.id,par:!(!n||!n.id)&&n.id})}),a;case"create_node":return(a=-1===e.inArray(d,h))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!r||!r.id)&&r.id,par:!(!n||!n.id)&&n.id})}),a;case"copy_node":return(a=-1===e.inArray(d,h))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!r||!r.id)&&r.id,par:!(!n||!n.id)&&n.id})}),a;case"move_node":return(a=r.parent===n.id&&(!o||!o.is_multi)||-1===e.inArray(d,h))||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:s,obj:!(!r||!r.id)&&r.id,par:!(!n||!n.id)&&n.id})}),a}return!0},this.create_node=function(r,n,s,o,a){if(!n||n.text===t){if(null===r&&(r="#"),!(r=this.get_node(r)))return i.create_node.call(this,r,n,s,o,a);if(!(s=s===t?"last":s).toString().match(/^(before|after)$/)&&!a&&!this.is_loaded(r))return i.create_node.call(this,r,n,s,o,a);n||(n={});var c,d,h,l,u,p=this._model.data,f=this.settings.unique.case_sensitive,_=this.settings.unique.duplicate;for(d=c=this.get_string("New node"),h=[],l=0,u=r.children.length;l<u;l++)h.push(f?p[r.children[l]].text:p[r.children[l]].text.toLowerCase());for(l=1;-1!==e.inArray(f?d:d.toLowerCase(),h);)d=_.call(this,c,++l).toString();n.text=d}return i.create_node.call(this,r,n,s,o,a)}};var f=h.createElement("DIV");if(f.setAttribute("unselectable","on"),f.setAttribute("role","presentation"),f.className="jstree-wholerow",f.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,r){this.bind=function(){r.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var r,i,n=!1;for(r=0,i=t.selected.length;r<i;r++)(n=this.get_node(t.selected[r],!0))&&n.length&&n.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){"hover_node"===e.type&&this.is_disabled(t.node)||this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){t.preventDefault();var r=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(r)},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var r=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(r).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var r=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor").first().trigger(r).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.is_disabled(e.currentTarget)||this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),r.teardown.call(this)},this.redraw_node=function(t,i,n,s){if(t=r.redraw_node.apply(this,arguments)){var o=f.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(o.className+=" jstree-wholerow-clicked"),this._data.core.focused&&this._data.core.focused===t.id&&(o.className+=" jstree-wholerow-hovered"),t.insertBefore(o,t.childNodes[0])}return t}},h.registerElement&&Object&&Object.create){var _=Object.create(HTMLElement.prototype);_.createdCallback=function(){var t,r={core:{},plugins:[]};for(t in e.jstree.plugins)e.jstree.plugins.hasOwnProperty(t)&&this.attributes[t]&&(r.plugins.push(t),this.getAttribute(t)&&JSON.parse(this.getAttribute(t))&&(r[t]=JSON.parse(this.getAttribute(t))));for(t in e.jstree.defaults.core)e.jstree.defaults.core.hasOwnProperty(t)&&this.attributes[t]&&(r.core[t]=JSON.parse(this.getAttribute(t))||this.getAttribute(t));e(this).jstree(r)};try{h.registerElement("vakata-jstree",{prototype:_})}catch(g){}}},void 0===(s="function"==typeof i?i.apply(t,n):i)||(e.exports=s)}()},"./node_modules/lodash/_baseMap.js":function(e,t,r){var i=r("./node_modules/lodash/_baseEach.js"),n=r("./node_modules/lodash/isArrayLike.js");e.exports=function(e,t){var r=-1,s=n(e)?Array(e.length):[];return i(e,function(e,i,n){s[++r]=t(e,i,n)}),s}},"./node_modules/lodash/_createFind.js":function(e,t,r){var i=r("./node_modules/lodash/_baseIteratee.js"),n=r("./node_modules/lodash/isArrayLike.js"),s=r("./node_modules/lodash/keys.js");e.exports=function(e){return function(t,r,o){var a=Object(t);if(!n(t)){var c=i(r,3);t=s(t),r=function(e){return c(a[e],e,a)}}var d=e(t,r,o);return d>-1?a[c?t[d]:d]:void 0}}},"./node_modules/lodash/find.js":function(e,t,r){var i=r("./node_modules/lodash/_createFind.js")(r("./node_modules/lodash/findIndex.js"));e.exports=i},"./node_modules/lodash/findIndex.js":function(e,t,r){var i=r("./node_modules/lodash/_baseFindIndex.js"),n=r("./node_modules/lodash/_baseIteratee.js"),s=r("./node_modules/lodash/toInteger.js"),o=Math.max;e.exports=function(e,t,r){var a=null==e?0:e.length;if(!a)return-1;var c=null==r?0:s(r);return c<0&&(c=o(a+c,0)),i(e,n(t,3),c)}},"./node_modules/lodash/isEmpty.js":function(e,t,r){var i=r("./node_modules/lodash/_baseKeys.js"),n=r("./node_modules/lodash/_getTag.js"),s=r("./node_modules/lodash/isArguments.js"),o=r("./node_modules/lodash/isArray.js"),a=r("./node_modules/lodash/isArrayLike.js"),c=r("./node_modules/lodash/isBuffer.js"),d=r("./node_modules/lodash/_isPrototype.js"),h=r("./node_modules/lodash/isTypedArray.js"),l=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(a(e)&&(o(e)||"string"==typeof e||"function"==typeof e.splice||c(e)||h(e)||s(e)))return!e.length;var t=n(e);if("[object Map]"==t||"[object Set]"==t)return!e.size;if(d(e))return!i(e).length;for(var r in e)if(l.call(e,r))return!1;return!0}},"./node_modules/lodash/map.js":function(e,t,r){var i=r("./node_modules/lodash/_arrayMap.js"),n=r("./node_modules/lodash/_baseIteratee.js"),s=r("./node_modules/lodash/_baseMap.js"),o=r("./node_modules/lodash/isArray.js");e.exports=function(e,t){return(o(e)?i:s)(e,n(t,3))}},"./node_modules/lodash/uniqueId.js":function(e,t,r){var i=r("./node_modules/lodash/toString.js"),n=0;e.exports=function(e){var t=++n;return i(e)+t}}}]);